<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>Tank Iberica - Vehículos Industriales</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Venta y alquiler de cisternas, semirremolques y vehículos industriales">
    <meta name="theme-color" content="#0f2a2e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Tank Ibérica">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=yes">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Favicon e iconos -->
    <link rel="icon" type="image/svg+xml" href="icons/icon-32.svg">
    <link rel="apple-touch-icon" href="icons/icon-152.svg">
    <link rel="apple-touch-icon" sizes="180x180" href="icons/icon-180.svg">
    
    <!-- Splash screens para iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* ============================================
               DESIGN SYSTEM TOKENS
               Tokens oficiales según DESIGN_SYSTEM.md
               ============================================ */
            
            /* Tokens base */
            --ds-petrol-blue: #0F2A2E;
            --ds-white: #FFFFFF;
            
            /* Tokens de texto - Fondo oscuro */
            --ds-text-dark-primary: #E6ECEC;
            --ds-text-dark-secondary: #C9D4D4;
            --ds-text-dark-auxiliary: #9FB1B1;
            --ds-text-dark-accent: #7FD1C8;
            
            /* Tokens de texto - Fondo claro */
            --ds-text-light-primary: #1F2A2A;
            --ds-text-light-secondary: #4A5A5A;
            --ds-text-light-auxiliary: #7A8A8A;
            --ds-text-light-accent: #0F2A2E;
            
            /* ============================================
               VARIABLES LEGACY (compatibilidad temporal)
               Estas coinciden con los tokens DS pero se
               mantienen para no romper estilos existentes
               ============================================ */
            --petrol-blue: #0F2A2E;        /* = ds-petrol-blue */
            --white: #FFFFFF;              /* = ds-white */
            --text-dark: #1F2A2A;          /* = ds-text-light-primary */
            --text-secondary: #4A5A5A;     /* = ds-text-light-secondary */
            --text-auxiliary: #7A8A8A;     /* = ds-text-light-auxiliary */
            --text-light-bg: #1F2A2A;      /* = ds-text-light-primary */
            --text-dark-bg: #E6ECEC;       /* = ds-text-dark-primary */
            --text-dark-secondary: #C9D4D4;/* = ds-text-dark-secondary */
            --text-dark-auxiliary: #9FB1B1;/* = ds-text-dark-auxiliary */
            --accent: #7FD1C8;             /* = ds-text-dark-accent */
            
            /* ============================================
               COLORES AUXILIARES PERMITIDOS
               No están en Design System base pero son
               auxiliares válidos para UI/gradientes
               ============================================ */
            --petrol-dark: #0A1F22;        /* Gradientes header */
            --petrol-light: #1A4248;       /* Gradientes botones */
            --light-gray: #F3F4F6;         /* Fondos UI */
            --medium-gray: #E5E7EB;        /* Separadores */
            --border: #D1D5DB;             /* Bordes */
            --disabled-gray: #9CA3AF;      /* Estados deshabilitados */
            --orange: #F59E0B;             /* Notificación sticky */
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            font-size: 18px;
            font-weight: 400;
            line-height: 1.6;
            letter-spacing: 0.01em;
            color: var(--text-dark);
            background: var(--light-gray);
        }

        /* ============================================
           0d: TOOLTIPS PARA PALABRAS ACORTADAS
           ============================================ */
        .truncated-text {
            position: relative;
            display: inline-block;
            cursor: help;
        }

        .truncated-text::after {
            content: attr(data-full-text);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(-8px);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 0.5rem 0.75rem;
            border-radius: 6px;
            font-size: 0.875rem;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            z-index: 10000;
        }

        .truncated-text:hover::after {
            opacity: 1;
            transition-delay: 1s;
        }

        .truncated-text::before {
            content: '';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(-2px);
            border: 6px solid transparent;
            border-top-color: rgba(0, 0, 0, 0.9);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            z-index: 10000;
        }

        .truncated-text:hover::before {
            opacity: 1;
            transition-delay: 1s;
        }

        /* ============================================
           ANNOUNCEMENT BANNER
           ============================================ */
        .announcement-banner {
            background: linear-gradient(135deg, #D4A017 0%, #B8860B 100%);
            color: var(--white);
            padding: 0.38rem 2rem;  /* 1a: Reducido 20% (0.47 → 0.38) */
            text-align: center;
            font-size: 14px;
            line-height: 1.4;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1001;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        .announcement-banner.hidden {
            display: none;
        }

        .announcement-banner a {
            color: var(--white);
            text-decoration: underline;
            font-weight: 600;
            cursor: pointer;
        }

        .announcement-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: var(--white);
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            line-height: 1;
            flex-shrink: 0;
        }

        .announcement-close:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        body.banner-visible {
            padding-top: 25.38px;
        }

        /* ============================================
           HEADER
           ============================================ */
        /* Header z-index original */
        header {
            background: linear-gradient(135deg, var(--petrol-blue) 0%, var(--petrol-dark) 100%);
            color: var(--white);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;  /* 2: Restaurado valor original */
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
        }

        body.banner-visible header {
            top: 25.38px;
        }

        header.scrolled {
            padding: 0.3rem 0;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        .header-content {
            max-width: 100%;
            margin: 0 auto;
            padding: 0.6rem 3rem;  /* 1a: Reducido 20% (0.75 → 0.6) */
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: padding 0.4s ease;
            gap: 1.5rem;
        }

        header.scrolled .header-content {
            padding: 0.24rem 3rem;  /* 1a: Reducido 20% (0.3 → 0.24) */
        }

        .logo {
            font-size: 1.8rem;
            font-weight: 300;
            letter-spacing: 3px;
            transition: font-size 0.4s ease;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            white-space: nowrap;
            flex-shrink: 0;
            font-family: 'Helvetica Neue', Arial, sans-serif;
            text-transform: uppercase;
        }

        header.scrolled .logo {
            font-size: 1.2rem;
        }

        .header-right {
            display: flex;
            gap: 1.5rem;
            align-items: center;
            flex-shrink: 0;
        }

        .social-links {
            display: flex;
            gap: 0.6rem;
            align-items: center;
            flex-shrink: 0;
        }

        .social-links a,
        .social-links .contact-icon {
            width: 38px;
            height: 38px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 50%;
            color: var(--white);
            text-decoration: none;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            cursor: pointer;
            flex-shrink: 0;
        }

        header.scrolled .social-links a,
        header.scrolled .social-links .contact-icon {
            width: 28px;
            height: 28px;
        }

        .social-links a:hover,
        .social-links .contact-icon:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-3px) scale(1.05);
        }

        .social-links svg {
            transition: all 0.3s ease;
        }

        header.scrolled .social-links svg {
            width: 14px;
            height: 14px;
        }

        .lang-switch {
            display: flex;
            gap: 0.3rem;
            background: rgba(255, 255, 255, 0.15);
            padding: 0.4rem;
            border-radius: 24px;
            backdrop-filter: blur(10px);
            flex-shrink: 0;
        }

        .lang-switch button {
            background: none;
            border: none;
            color: var(--white);
            cursor: pointer;
            padding: 0.4rem 0.9rem;
            border-radius: 18px;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 0.85rem;
            white-space: nowrap;
        }

        header.scrolled .lang-switch button {
            padding: 0.3rem 0.7rem;
            font-size: 0.75rem;
        }

        .lang-switch button.active {
            background: var(--white);
            color: var(--petrol-blue);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }


        .account-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(255, 255, 255, 0.15);
            padding: 0.4rem 1rem;
            border-radius: 24px;
            backdrop-filter: blur(10px);
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            color: var(--white);
            font-size: 0.85rem;
            font-weight: 600;
            white-space: nowrap;
        }

        header.scrolled .account-btn {
            padding: 0.3rem 0.8rem;
            font-size: 0.75rem;
        }

        .account-btn:hover {
            background: rgba(255, 255, 255, 0.25);
        }

        .account-btn svg {
            width: 18px;
            height: 18px;
        }

        header.scrolled .account-btn svg {
            width: 14px;
            height: 14px;
        }

        /* ============================================
           RESPONSIVE: MÓVILES PEQUEÑOS (<360px)
           P0-01: Sin scroll horizontal crítico
           ============================================ */
        @media (max-width: 360px) {
            /* HEADER - Touch targets seguros (32×32px mínimo) */
            .header-content {
                padding: 0.8rem 1rem;
                gap: 0.5rem;
            }
            
            .logo {
                font-size: 1.2rem;
                letter-spacing: 0.5px;
            }
            
            .header-right {
                gap: 0.5rem;
            }
            
            .social-links {
                gap: 0.2rem;
            }
            
            .social-links a,
            .social-links .contact-icon {
                min-width: 32px;
                min-height: 32px;
                width: auto;
                height: auto;
                padding: 0.4rem;
            }
            
            .social-links svg {
                width: 14px;
                height: 14px;
            }
            
            .lang-switch {
                padding: 0.2rem;
                gap: 0.15rem;
            }
            
            .lang-switch button {
                padding: 0.25rem 0.45rem;
                font-size: 0.65rem;
                min-height: 32px;
            }
            
            .account-btn {
                padding: 0.5rem;
                min-width: 32px;
                min-height: 32px;
            }
            
            .account-btn span {
                display: none;
            }
            
            .account-btn svg {
                width: 16px;
                height: 16px;
            }
            
            /* CATEGORÍAS - Sin scroll horizontal */
            .categories-section {
                padding: 0.45rem 0;
            }
            
            .categories {
                padding: 0 1rem;
                gap: 0.5rem;
            }
            
            .category-btn {
                padding: 0.35rem 0.65rem;
                font-size: 13px;
                letter-spacing: 0.15px;
                min-height: 32px;
            }
            
            /* SUBCATEGORÍAS - Sin scroll, sin uppercase */
            .subcategories-section {
                padding: 0.45rem 0;
            }
            
            .subcategories {
                padding: 0 1rem;
                gap: 0.4rem;
            }
            
            .subcategory-btn {
                padding: 0.25rem 0.45rem;
                font-size: 12px;
                text-transform: none;
                min-height: 32px;
            }
            
            /* FILTROS - Layout + fade indicators */
            .filters-section {
                padding: 0.35rem 0;
            }
            
            .filters-wrapper {
                padding: 0.15rem 1.5rem;  /* Alineado con header 768px */
            }
            
            .filters-wrapper::before,
            .filters-wrapper::after {
                content: '';
                position: absolute;
                top: 0;
                bottom: 0;
                width: 20px;
                pointer-events: none;
                z-index: 1;
            }
            
            .filters-wrapper::before {
                left: 0;
                background: linear-gradient(to right, var(--white), transparent);
            }
            
            .filters-wrapper::after {
                right: 0;
                background: linear-gradient(to left, var(--white), transparent);
            }
        }

        @media (max-width: 480px) {
            .filters-wrapper {
                padding: 0.15rem 1rem;  /* Alineado con header 480px (1rem) */
            }
        }

        @media (max-width: 768px) {
            .header-content {
                padding: 0.75rem 1.5rem;
                gap: 0.75rem;
            }
            
            .logo {
                font-size: 1.3rem;
                letter-spacing: 1.5px;
            }
            
            .header-right {
                gap: 0.5rem;
            }
            
            .social-links {
                gap: 0.5rem;
            }
            
            .contact-icon svg {
                width: 16px;
                height: 16px;
            }
            
            .lang-btn {
                padding: 0.25rem 0.5rem;
                font-size: 11px;
            }
            
            .account-btn {
                padding: 0.4rem 0.6rem;
                font-size: 12px;
                gap: 0.3rem;
            }
            
            .account-btn svg {
                width: 16px;
                height: 16px;
            }
            
            .account-btn span {
                display: none;
            }
        }
        
        @media (max-width: 480px) {
            .header-content {
                padding: 0.6rem 1rem;
                gap: 0.5rem;
            }
            
            .logo {
                font-size: 1.1rem;
                letter-spacing: 1px;
            }
            
            .social-links a:nth-child(4),
            .social-links a:nth-child(5) {
                display: none;
            }
            
            .lang-btn {
                padding: 0.2rem 0.4rem;
                font-size: 10px;
            }
            
            .account-btn {
                padding: 0.3rem 0.5rem;
            }
        }
        
        /* ============================================
           CATEGORIES - RESPONSIVE
           ============================================ */
        @media (max-width: 1024px) {
            .categories {
                padding: 0 2rem;
                justify-content: flex-start;
                gap: 0.6rem;
            }
            
            .category-btn {
                font-size: 11px;
                padding: 0.35rem 0.6rem;
            }
        }
        
        @media (max-width: 768px) {
            .categories {
                padding: 0 1.5rem;  /* Alineado con header 768px (1.5rem) */
                gap: 0.5rem;
                justify-content: flex-start;
            }
            
            .category-btn {
                font-size: 10px;
                padding: 0.3rem 0.5rem;
                letter-spacing: 0.2px;
            }
        }
        
        @media (max-width: 480px) {
            /* 2c: Categories responsive - TODAS visibles siempre */
            .categories-section {
                padding: 0.28rem 0;  /* 2a: Reducido 20% */
            }
            
            .categories {
                padding: 0 1rem;  /* 2b: Alineado con header móvil */
                gap: 0.4rem;
            }
            
            .category-btn {
                font-size: 9px;
                padding: 0.2rem 0.36rem;  /* 2a+2c: Más compacto */
                letter-spacing: 0.1px;
            }
        }
        
        @media (max-width: 480px) {
            /* 2c: Móvil pequeño - MUY compacto, TODAS visibles */
            .categories {
                padding: 0 0.75rem;  /* 2b: Alineado header móvil pequeño */
                gap: 0.25rem;
            }
            
            .category-btn {
                font-size: 8px;
                padding: 0.16rem 0.28rem;  /* 2c: Extra compacto */
                letter-spacing: 0;
            }
        }
        
        /* ============================================
           SUBCATEGORIES - RESPONSIVE
           ============================================ */
        @media (max-width: 1024px) {
            .subcategories {
                padding: 0 2rem;
                justify-content: flex-start;
                gap: 0.6rem;
            }
            
            .subcategory-btn {
                font-size: 11px;
                padding: 0.24rem 0.48rem;  /* 3a: Reducido 20% */
            }
        }
        
        @media (max-width: 768px) {
            .subcategories {
                padding: 0 1.5rem;  /* Alineado con header 768px (1.5rem) */
                gap: 0.5rem;
                justify-content: flex-start;
            }
            
            .subcategory-btn {
                font-size: 10px;
                padding: 0.22rem 0.4rem;  /* 3a: Reducido 20% */
            }
        }
        
        @media (max-width: 480px) {
            .subcategories-section {
                padding: 0.28rem 0;  /* 3a: Reducido 20% */
            }
            
            .subcategories {
                padding: 0 1rem;  /* Alineado con header 480px (1rem) */
                gap: 0.3rem;
            }
            
            .subcategory-btn {
                font-size: 8px;
                padding: 0.18rem 0.32rem;  /* 3a: Reducido 20% */
            }
        }

        /* ============================================
           MODALES DE CUENTA
           ============================================ */
        .account-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .account-modal.active {
            display: flex;
        }

        .account-modal-content {
            background: var(--white);
            border-radius: 16px;
            padding: 2.5rem;
            max-width: 500px;
            width: 90%;
            position: relative;
            text-align: center;
        }

        /* ============================================
           3: BOTONES CERRAR - FORZADO TODAS LAS MODALES
           ============================================ */
        .account-modal-close,
        .dev-modal-close,
        .advertise-modal-close,
        .demand-modal-close,
        .contact-modal-close,
        .news-modal-close,
        .subscribe-modal-close,
        .vehicle-modal-close {
            position: absolute !important;
            top: -15px !important;
            right: -15px !important;
            width: 40px !important;
            height: 40px !important;
            border-radius: 50% !important;
            background: #FFFFFF !important;
            border: 2px solid #0F2A2E !important;
            color: #0F2A2E !important;
            font-size: 28px !important;
            font-weight: 300 !important;
            line-height: 1 !important;
            cursor: pointer !important;
            transition: all 0.3s ease !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            z-index: 10 !important;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
            padding: 0 !important;
            margin: 0 !important;
        }

        .account-modal-close:hover,
        .dev-modal-close:hover,
        .advertise-modal-close:hover,
        .demand-modal-close:hover,
        .contact-modal-close:hover,
        .news-modal-close:hover,
        .subscribe-modal-close:hover,
        .vehicle-modal-close:hover {
            background: #0F2A2E !important;
            color: #FFFFFF !important;
            border-color: #0F2A2E !important;
            transform: rotate(90deg) scale(1.1) !important;
        }

        /* Responsive móvil */
        @media (max-width: 600px) {
            .account-modal-close,
            .dev-modal-close,
            .advertise-modal-close,
            .demand-modal-close,
            .contact-modal-close,
            .news-modal-close,
            .subscribe-modal-close,
            .vehicle-modal-close {
                top: 10px !important;
                right: 50% !important;
                transform: translateX(50%) !important;
                width: 36px !important;
                height: 36px !important;
            }
            
            .account-modal-close:hover,
            .dev-modal-close:hover,
            .advertise-modal-close:hover,
            .demand-modal-close:hover,
            .contact-modal-close:hover,
            .news-modal-close:hover,
            .subscribe-modal-close:hover,
            .vehicle-modal-close:hover {
                transform: translateX(50%) rotate(90deg) scale(1.1) !important;
            }
        }

        .account-modal-title {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--petrol-blue);
            margin-bottom: 1.5rem;
        }

        /* 2: FORZAR overflow visible TODOS modales */
        .vehicle-detail-modal,
        .demand-modal,
        .advertise-modal {
            overflow: visible !important;
        }

        .vehicle-detail-content,
        .demand-modal-content,
        .advertise-modal-content {
            overflow: visible !important;
        }

        /* 4: Ocultar scrollbars COMPLETAMENTE */
        .vehicle-detail-grid,
        .demand-modal-content > form,
        .advertise-modal-content > form {
            overflow-y: auto !important;
            overflow-x: hidden !important;
            scrollbar-width: none !important;  /* 4: Firefox */
            -ms-overflow-style: none !important;  /* 4: IE */
        }

        .vehicle-detail-grid::-webkit-scrollbar,
        .demand-modal-content > form::-webkit-scrollbar,
        .advertise-modal-content > form::-webkit-scrollbar {
            display: none !important;  /* 4: Chrome/Safari */
            width: 0 !important;
            height: 0 !important;
        }

        /* 3+5: Account options - layout completo */
        .account-options {
            display: grid !important;
            grid-template-columns: repeat(5, 1fr) !important;
            gap: 1.2rem !important;
            margin: 0 auto 1.5rem !important;
            padding: 2rem !important;
            border: 2px solid #0F2A2E !important;
            border-radius: 16px !important;
            background: linear-gradient(135deg, rgba(15, 42, 46, 0.02) 0%, rgba(26, 66, 72, 0.04) 100%) !important;
            box-sizing: border-box !important;
            max-width: 550px !important;
            justify-items: center !important;
        }

        @media (max-width: 768px) {
            .account-options {
                grid-template-columns: repeat(3, 1fr) !important;
                max-width: 400px !important;
            }
        }

        @media (max-width: 480px) {
            .account-options {
                grid-template-columns: repeat(2, 1fr) !important;
                max-width: 300px !important;
                gap: 1rem !important;
                padding: 1.5rem !important;
            }
        }

        .account-option {
            display: flex !important;
            flex-direction: column !important;
            align-items: center !important;
            justify-content: center !important;
            gap: 0 !important;
            padding: 0 !important;
            margin: 0 !important;
            background: #F3F4F6 !important;
            border: 2px solid #D1D5DB !important;
            border-radius: 50% !important;
            cursor: pointer !important;
            transition: all 0.3s ease !important;
            width: 70px !important;
            height: 70px !important;
            box-sizing: border-box !important;
        }

        .account-option svg {
            width: 32px !important;
            height: 32px !important;
            margin: 0 !important;
        }

        .account-option:hover {
            border-color: var(--petrol-blue);
            background: var(--white);
            transform: translateY(-3px) scale(1.05);
        }

        .account-option svg {
            width: 32px;
            height: 32px;
        }

        .account-option svg path {
            fill: var(--petrol-blue);
        }

        .account-option svg[stroke] path {
            stroke: var(--petrol-blue);
            fill: none;
        }

        .account-divider {
            display: none;
            align-items: center;
            gap: 1rem;
            margin: 1.5rem 0;
        }
        
        .account-divider.active {
            display: flex;
        }

        .account-divider::before,
        .account-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--border);
        }

        .account-divider span {
            color: var(--text-auxiliary);
            font-size: 0.85rem;
        }

        .account-input-group {
            display: none;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .account-input-group.active {
            display: flex;
        }

        .account-input {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .account-btn-submit {
            width: 100%;
            padding: 1rem;
            background: var(--petrol-blue);
            color: var(--white);
            border: none;
            border-radius: 8px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .account-btn-submit:hover {
            background: var(--petrol-light);
        }

        .dev-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2001;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .dev-modal.active {
            display: flex;
        }

        .dev-modal-content {
            background: var(--white);
            border-radius: 16px;
            padding: 2.5rem;
            max-width: 450px;
            width: 90%;
            text-align: center;
            position: relative;
        }

        
        .dev-modal-title {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--petrol-blue);
            margin-bottom: 1rem;
        }

        .dev-modal-text {
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        .dev-modal-input {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .dev-modal-btn {
            width: 100%;
            padding: 1rem;
            background: var(--petrol-blue);
            color: var(--white);
            border: none;
            border-radius: 8px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .dev-modal-btn:hover {
            background: var(--petrol-light);
        }

        /* ============================================
           ADVERTISE MODAL (P0-03)
           ============================================ */
        .advertise-modal {
            display: none !important;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            overflow-y: auto;
        }

        .advertise-modal.active {
            display: flex !important;
        }
        
        /* FORZAR OCULTAR ADVERTISE MODAL AL INICIO */
        #advertiseModal:not(.active) {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
            pointer-events: none !important;
        }

        /* 6a: Modal MUY ANCHO hacia laterales */
        /* 2+4: Advertise modal - overflow visible para X */
        .advertise-modal-content {
            background: var(--white);
            border-radius: 16px;
            padding: 1.5rem 2rem;
            max-width: 95vw;
            width: 96%;
            max-height: 95vh;
            position: relative;
            display: flex;
            flex-direction: column;
            overflow: visible !important;  /* 2: X visible fuera - FORZADO */
        }

        /* Contenedor scrolleable interno */
        .advertise-modal-content > form {
            overflow-y: auto !important;
            flex: 1 !important;
        }

        /* 6f: Título CENTRADO */
        .advertise-modal-title {
            font-size: 1.6rem;  /* Reducido de 1.8rem */
            font-weight: 800;
            color: var(--petrol-blue);
            margin-bottom: 1rem;  /* Reducido de 1.5rem */
            text-align: center;  /* CENTRADO */
        }

        /* 6c: Grid de 4 columnas */
        .advertise-form {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.8rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;  /* Reducido de 0.3rem */
        }

        /* Elementos que ocupan 1 columna */
        .form-group.col-1 {
            grid-column: span 1;
        }

        /* 6d: Elementos que ocupan 2 columnas (para imágenes) */
        .form-group.col-2 {
            grid-column: span 2;
        }

        /* Elementos que ocupan 4 columnas (ancho completo) */
        .form-group.col-4 {
            grid-column: span 4;
        }

        .form-group label {
            font-weight: 500;
            color: var(--text-dark);
            font-size: 12px;  /* Más pequeño: 13px → 12px */
        }

        .form-group input,
        .form-group select {
            padding: 0.5rem;  /* Más compacto: 0.6rem → 0.5rem */
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 13px;  /* Más pequeño: 14px → 13px */
            transition: all 0.3s ease;
            height: 36px;  /* Más bajo: 40px → 36px */
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--petrol-blue);
            box-shadow: 0 0 0 3px rgba(15, 42, 46, 0.1);
        }

        .form-help {
            font-size: 11px;  /* Reducido de 12px */
            color: var(--text-auxiliary);
        }

        /* 6f: Botón enviar CENTRADO */
        .advertise-submit {
            grid-column: span 4;
            padding: 0.8rem;  /* Reducido de 1rem */
            background: var(--petrol-blue);
            color: var(--white);
            border: none;
            border-radius: 8px;
            font-weight: 700;
            font-size: 15px;  /* Reducido de 16px */
            cursor: pointer;
            margin: 0 auto;  /* CENTRADO */
            max-width: 300px;  /* Ancho máximo */
            width: 100%;
            transition: all 0.3s ease;
            margin-top: 1rem;
        }

        .advertise-submit:hover {
            background: var(--petrol-light);
        }

        /* 6b: RESPONSIVE Modal Anúnciate */
        @media (max-width: 1024px) {
            .advertise-form {
                grid-template-columns: repeat(2, 1fr);  /* 2 columnas en tablet */
            }

            /* Secciones siguen ocupando todo */
            .form-section {
                grid-column: 1 / -1;
            }

            /* Filas dentro de secciones = 2 columnas */
            .form-row {
                grid-template-columns: repeat(2, 1fr);
            }

            .form-group.col-1 {
                grid-column: span 1;
            }

            .form-group.col-2 {
                grid-column: span 2;
            }

            .form-group.col-4 {
                grid-column: span 2;  /* Full width en tablet */
            }

            .advertise-submit {
                grid-column: span 2;
            }
        }

        @media (max-width: 480px) {
            .advertise-modal-content {
                padding: 1.5rem;
                width: 98%;
            }

            .advertise-modal-title {
                font-size: 1.4rem;
            }

            .advertise-form {
                grid-template-columns: 1fr;  /* 1 columna en móvil */
                gap: 0.6rem;
            }

            /* Secciones siguen ocupando todo */
            .form-section {
                grid-column: 1 / -1;
            }

            /* Filas dentro de secciones = 1 columna */
            .form-row {
                grid-template-columns: 1fr;
            }

            .form-group.col-1,
            .form-group.col-2,
            .form-group.col-4 {
                grid-column: span 1;
            }

            .advertise-submit {
                grid-column: span 1;
            }

            .form-group label {
                font-size: 12px;
            }

            .form-group input,
            .form-group select {
                font-size: 13px;
                padding: 0.5rem;
            }

            /* 6e: Checkbox aún más pequeño en móvil */
            .checkbox-label {
                font-size: 10px;  /* Más pequeño en móvil */
            }

            .checkbox-label input[type="checkbox"] {
                width: 14px;
                height: 14px;
            }
        }

        /* ============================================

        /* ADVERTISE FORM - Iteración 6 */
        .advertise-modal-content {
            max-width: 900px !important;
            width: 95% !important;
        }

        /* Secciones ocupan todo el ancho - MÁS COMPACTAS */
        .form-section {
            grid-column: 1 / -1;  /* Full width */
            margin-bottom: 1rem;  /* Reducido de 1.5rem */
            padding-bottom: 0.8rem;  /* Reducido de 1rem */
            border-bottom: 1px solid var(--border);
        }

        .form-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .form-section-title {
            font-size: 1rem;  /* Reducido de 1.1rem */
            font-weight: 600;
            color: var(--petrol-blue);
            margin-bottom: 0.6rem;  /* Reducido de 0.8rem */
            grid-column: 1 / -1;  /* Full width */
        }

        /* Filas dentro de secciones = grid 4 columnas */
        .form-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.6rem;  /* Reducido de 0.8rem */
            margin-bottom: 0.6rem;  /* Reducido de 0.8rem */
        }

        .form-row:last-child {
            margin-bottom: 0;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-group textarea {
            padding: 0.5rem;  /* Reducido de 0.8rem */
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 13px;  /* Reducido de 14px */
            font-family: inherit;
            resize: vertical;
            transition: all 0.3s ease;
        }

        .form-group textarea:focus {
            outline: none;
            border-color: var(--petrol-blue);
            box-shadow: 0 0 0 3px rgba(15, 42, 46, 0.1);
        }

        /* 6e: Checkbox aceptación MUY compacto */
        .checkbox-label {
            display: flex;
            align-items: flex-start;
            gap: 0.4rem;
            cursor: pointer;
            font-size: 11px;  /* MUY pequeño para una línea */
            line-height: 1.4;
        }

        .checkbox-label input[type="checkbox"] {
            margin-top: 0.15rem;
            width: 16px;
            height: 16px;
            cursor: pointer;
            flex-shrink: 0;
        }

        /* 6d/7d: Cajas imagen PEQUEÑAS - tamaño 2 casillas */
        .photo-upload-area {
            border: 2px dashed var(--border);
            border-radius: 8px;  /* Más pequeño: 12px → 8px */
            padding: 0.8rem;  /* MUY reducido: 2rem → 0.8rem */
            text-align: center;
            background: var(--light-gray);
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 100px;  /* Altura mínima controlada */
        }

        .photo-upload-area:hover {
            border-color: var(--petrol-blue);
            background: #f0f4f5;
        }

        .upload-icon {
            width: 32px;  /* Mucho más pequeño: 64px → 32px */
            height: 32px;
            margin: 0 auto 0.5rem;  /* Reducido: 1rem → 0.5rem */
            color: var(--petrol-blue);
        }

        .upload-text {
            font-size: 11px;  /* Más pequeño: 14px → 11px */
            color: var(--text-dark);
            line-height: 1.4;  /* Reducido: 1.6 → 1.4 */
            margin-bottom: 0.5rem;  /* Reducido: 1rem → 0.5rem */
        }

        .upload-text strong {
            color: var(--petrol-blue);
        }

        .upload-recommendations {
            font-size: 12px;
            color: var(--text-auxiliary);
            text-align: left;
            line-height: 1.8;
            margin-top: 1rem;
            padding: 1rem;
            background: white;
            border-radius: 8px;
        }

        .photo-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .photo-preview-item {
            position: relative;
            aspect-ratio: 1;
            border-radius: 8px;
            overflow: hidden;
            border: 2px solid var(--border);
        }

        .photo-preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .photo-preview-remove {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: rgba(255, 0, 0, 0.8);
            color: white;
            border: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            line-height: 1;
            transition: all 0.3s ease;
        }

        .photo-preview-remove:hover {
            background: rgba(255, 0, 0, 1);
        }

        .form-submit-btn {
            padding: 1rem 2rem;
            background: linear-gradient(135deg, var(--petrol-blue) 0%, var(--petrol-light) 100%);
            color: var(--white);
            border: none;
            border-radius: 8px;
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 1rem;
        }

        .form-submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(15, 42, 46, 0.3);
        }

        .form-submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* RESPONSIVE ADVERTISE FORM */
        @media (max-width: 768px) {
            .advertise-modal-content {
                padding: 1.5rem;
                max-height: 95vh;
            }

            .advertise-modal-title {
                font-size: 1.4rem;
            }

            .form-section-title {
                font-size: 1.1rem;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .photo-upload-area {
                padding: 1.5rem;
            }

            .upload-icon {
                width: 48px;
                height: 48px;
            }

            .upload-text {
                font-size: 13px;
            }

            .upload-recommendations {
                font-size: 11px;
            }
        }
        /* ============================================
           DEMAND MODAL (P0-04)
           ============================================ */
        .demand-modal {
            display: none !important;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            overflow-y: auto;
        }

        .demand-modal.active {
            display: flex !important;
        }

        /* 7a: Modal MÁS ANCHO */
        /* 2+4: Demand modal - overflow visible para X */
        .demand-modal-content {
            background: var(--white);
            border-radius: 16px;
            padding: 1.5rem 2rem;
            max-width: 95vw;
            width: 96%;
            max-height: 95vh;
            position: relative;
            display: flex;
            flex-direction: column;
            overflow: visible !important;  /* 2: X visible fuera - FORZADO */
        }

        /* Contenedor scrolleable interno */
        .demand-modal-content > form {
            overflow-y: auto !important;
            flex: 1 !important;
        }

        /* 7f: Títulos CENTRADOS y compactos */
        .demand-modal-title {
            font-size: 1.5rem;  /* Reducido de 1.6rem */
            font-weight: 800;
            color: var(--petrol-blue);
            margin-bottom: 0.4rem;  /* Reducido de 0.5rem */
            text-align: center;  /* CENTRADO */
        }

        .demand-modal-subtitle {
            color: var(--text-secondary);
            margin-bottom: 1rem;  /* Reducido de 1.5rem */
            font-size: 13px;  /* Reducido de 14px */
            text-align: center;  /* CENTRADO */
        }

        /* 7c: Grid 4 columnas MÁS COMPACTO */
        .demand-form {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.6rem;  /* Reducido de 0.8rem */
        }

        /* 7c: Slider container con altura uniforme */
        .slider-container {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;  /* Reducido de 0.5rem */
        }

        .slider-values {
            display: flex;
            justify-content: space-between;
            font-size: 11px;  /* Reducido de 14px para compactar */
            font-weight: 600;
            color: var(--petrol-blue);
            margin-bottom: 0.2rem;
        }

        .slider-range {
            position: relative;
            height: 30px;
            display: flex;
            align-items: center;
        }

        .slider-range input[type="range"] {
            position: absolute;
            width: 100%;
            height: 30px;
            appearance: none;
            -webkit-appearance: none;
            background: transparent;
            margin: 0;
            outline: none;
            pointer-events: none;
        }

        /* Min slider: z-index bajo pero muestra el track */
        .slider-range input[type="range"]:first-child {
            z-index: 1;
        }
        
        /* Max slider: z-index alto, track transparente */
        .slider-range input[type="range"]:last-child {
            z-index: 2;
        }

        /* Solo el primer slider muestra el track */
        .slider-range input[type="range"]:first-child::-webkit-slider-runnable-track {
            width: 100%;
            height: 6px;
            background: var(--border);
            border-radius: 3px;
        }

        .slider-range input[type="range"]:first-child::-moz-range-track {
            width: 100%;
            height: 6px;
            background: var(--border);
            border-radius: 3px;
        }

        /* El segundo slider tiene track transparente */
        .slider-range input[type="range"]:last-child::-webkit-slider-runnable-track {
            width: 100%;
            height: 6px;
            background: transparent;
            border-radius: 3px;
        }

        .slider-range input[type="range"]:last-child::-moz-range-track {
            width: 100%;
            height: 6px;
            background: transparent;
            border-radius: 3px;
        }

        .slider-range input[type="range"]::-webkit-slider-thumb {
            pointer-events: auto;
            appearance: none;
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: var(--petrol-blue);
            border-radius: 50%;
            cursor: pointer;
            margin-top: -7px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            transition: transform 0.15s, box-shadow 0.15s;
        }

        .slider-range input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 3px 6px rgba(0,0,0,0.3);
        }

        .slider-range input[type="range"]::-webkit-slider-thumb:active {
            transform: scale(1.15);
            background: var(--petrol-light);
        }

        .slider-range input[type="range"]::-moz-range-thumb {
            pointer-events: auto;
            width: 20px;
            height: 20px;
            background: var(--petrol-blue);
            border-radius: 50%;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            transition: transform 0.15s, box-shadow 0.15s;
        }

        .slider-range input[type="range"]::-moz-range-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 3px 6px rgba(0,0,0,0.3);
        }

        .slider-range input[type="range"]::-moz-range-thumb:active {
            transform: scale(1.15);
            background: var(--petrol-light);
        }

        .contact-options {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        /* SLIDER-TRACK - Actualizado para formulario demand */
        .slider-track {
            position: relative;
            height: 40px;
            background: var(--light-gray);
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 0 12px;
            display: flex;
            align-items: center;
        }

        .slider-track input[type="range"] {
            position: absolute;
            width: calc(100% - 24px);
            left: 12px;
            pointer-events: none;
            -webkit-appearance: none;
            appearance: none;
            background: transparent;
            height: 6px;
        }
        
        .slider-track input.slider-min {
            z-index: 1;
        }
        
        .slider-track input.slider-max {
            z-index: 2;
        }

        .slider-track input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            pointer-events: all;
            width: 18px;
            height: 18px;
            background: var(--petrol-blue);
            border: 2px solid white;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .slider-track input[type="range"]::-moz-range-thumb {
            pointer-events: all;
            width: 18px;
            height: 18px;
            background: var(--petrol-blue);
            border: 2px solid white;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        /* CONTACT METHODS */
        .contact-methods {
            display: flex;
            gap: 1.5rem;
            flex-wrap: wrap;
        }
        
        .contact-methods .checkbox-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }
        
        .contact-methods input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 6px;
            transition: background 0.2s;
        }

        .checkbox-label:hover {
            background: var(--light-gray);
        }

        .checkbox-label input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        /* 7f: Botón CENTRADO */
        .demand-submit {
            grid-column: span 4;
            padding: 0.8rem;
            background: var(--petrol-blue);
            color: var(--white);
            border: none;
            border-radius: 8px;
            font-weight: 700;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 1rem auto 0;  /* CENTRADO */
            max-width: 300px;
            width: 100%;
        }

        .demand-submit:hover {
            background: var(--petrol-light);
        }

        /* 7b: RESPONSIVE Modal Demand */
        @media (max-width: 1024px) {
            .demand-form {
                grid-template-columns: repeat(2, 1fr);
            }

            .form-section {
                grid-column: 1 / -1;
            }

            .form-row {
                grid-template-columns: repeat(2, 1fr);
            }

            .demand-submit {
                grid-column: span 2;
            }
        }

        @media (max-width: 480px) {
            .demand-modal-content {
                padding: 1.5rem;
                width: 98%;
            }

            .demand-modal-title {
                font-size: 1.2rem;  /* Más pequeño */
            }

            .demand-modal-subtitle {
                font-size: 11px;  /* Más pequeño */
            }

            .demand-form {
                grid-template-columns: 1fr;
                gap: 0.5rem;  /* Más compacto */
            }

            .form-section {
                grid-column: 1 / -1;
                margin-bottom: 0.8rem;
                padding-bottom: 0.6rem;
            }

            .form-row {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }

            .demand-submit {
                grid-column: span 1;
            }

            /* 7e: Checkbox pequeño en móvil */
            .checkbox-label {
                font-size: 10px;
            }

            .checkbox-label input[type="checkbox"] {
                width: 14px;
                height: 14px;
            }
        }

        .favorites-notification {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .favorites-notification.active {
            display: flex;
        }

        .favorites-notification-content {
            background: var(--white);
            border-radius: 16px;
            padding: 2rem;
            max-width: 400px;
            width: 90%;
            text-align: center;
            position: relative;
        }

        .favorites-notification-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: rgba(0, 0, 0, 0.1);
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-auxiliary);
            line-height: 1;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .favorites-notification-close:hover {
            background: rgba(0, 0, 0, 0.2);
        }

        .favorites-notification-text {
            color: var(--text-dark);
            margin-bottom: 1.5rem;
            font-size: 1rem;
            line-height: 1.6;
        }

        .favorites-notification-btn {
            padding: 0.8rem 2rem;
            background: var(--petrol-blue);
            color: var(--white);
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .favorites-notification-btn:hover {
            background: var(--petrol-light);
        }

        /* ============================================
           MAIN CONTENT
           ============================================ */
        main {
            margin-top: 70px;
            padding: 0;
            min-height: calc(100vh - 400px);
            transition: margin-top 0.3s ease;
        }

        body.banner-visible main {
            margin-top: 75px;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 0 3rem;
        }

        /* Container sin padding para evitar doble padding en categories/filters */
        .container-no-padding {
            max-width: 100%;
            margin: 0 auto;
            padding: 0;  /* Sin padding - los elementos internos lo manejan */
        }

        /* ============================================
           CATEGORIES - 25% reducción de altura
           ============================================ */
        .categories-section {
            background: var(--white);
            padding: 0.34rem 0;  /* 2a: Reducido 20% (0.42 → 0.34) */
            margin-bottom: 0;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.04);
            position: relative;
            overflow: hidden;
        }

        .categories-wrapper {
            overflow-x: auto;
            overflow-y: hidden;
            scrollbar-width: none;
            -ms-overflow-style: none;
            position: relative;
            padding: 0;  /* 2: Sin padding - alineación con header */
        }

        .categories-wrapper::-webkit-scrollbar {
            display: none;
        }

        .categories {
            display: flex;
            justify-content: flex-start;
            gap: 0.75rem;
            padding: 0 3rem;  /* 2b: ✅ Ya alineado con header */
            min-width: 100%;
        }

        .category-btn {
            padding: 0.31rem 0.56rem;  /* 2a: Reducido 20% (0.39→0.31, 0.7→0.56) */
            border: 2px solid var(--border);
            border-radius: 9999px;
            background: var(--white);
            color: var(--text-dark);
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            font-size: 12px;
            line-height: 1.4;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .category-btn:hover {
            border-color: var(--petrol-blue);
            background: var(--light-gray);
            color: var(--petrol-blue);
        }

        .category-btn.active {
            background: linear-gradient(135deg, var(--petrol-blue) 0%, var(--petrol-light) 100%);
            color: var(--white);
            border-color: var(--petrol-blue);
        }

        .scroll-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(15, 42, 46, 0.8);
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            color: var(--white);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            transition: all 0.3s ease;
            font-size: 1.2rem;
        }

        .scroll-btn:hover {
            background: var(--petrol-blue);
        }

        .scroll-btn-left {
            left: 8px;
        }

        .scroll-btn-right {
            right: 8px;
        }

        .scroll-btn.hidden {
            display: none;
        }

        /* ============================================
           SUBCATEGORIES - 25% reducción de altura
           ============================================ */
        .subcategories-section {
            background: var(--white);
            padding: 0.34rem 0;  /* 3a: Reducido 20% (0.42 → 0.34) */
            margin-bottom: 0;
            border-top: 1px solid var(--border);
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.04);
            position: relative;
            overflow: hidden;
        }

        .subcategories-wrapper {
            overflow-x: auto;
            overflow-y: hidden;
            scrollbar-width: none;
            -ms-overflow-style: none;
            position: relative;
            padding: 0;  /* 2: Sin padding - alineación con header */
        }

        .subcategories-wrapper::-webkit-scrollbar {
            display: none;
        }

        .subcategories {
            display: flex;
            justify-content: flex-start;
            gap: 0.75rem;
            padding: 0 3rem;  /* 3b: ✅ Ya alineado con header */
            min-width: 100%;
        }

        .subcategory-btn {
            padding: 0.27rem 0.56rem;  /* 3a: Reducido 20% (0.34→0.27, 0.7→0.56) */
            border: 2px solid var(--border);
            border-radius: 9999px;
            background: var(--white);
            color: var(--text-dark);
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            font-size: 12px;
            line-height: 1.4;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .subcategory-btn.disabled {
            color: var(--disabled-gray);
            cursor: not-allowed;
            background: #F9FAFB;
            border-color: var(--disabled-gray);
        }

        .subcategory-btn.disabled:hover {
            background: #F9FAFB;
            color: var(--disabled-gray);
        }

        .subcategory-btn:not(.disabled):hover {
            color: var(--petrol-blue);
            background: var(--light-gray);
            border-color: var(--petrol-light);
        }

        .subcategory-btn:not(.disabled):active {
            background: linear-gradient(135deg, var(--petrol-light) 0%, var(--accent) 100%) !important;
            color: var(--white) !important;
            border-color: var(--petrol-light) !important;
            transform: scale(0.98);
        }
        
        .subcategory-btn:focus {
            outline: none;
        }

        .subcategory-btn.active {
            background: linear-gradient(135deg, var(--petrol-light) 0%, var(--accent) 100%);
            color: var(--white);
            border-color: var(--petrol-light);
        }

        /* Eliminar delay de 300ms en móviles */
        .subcategory-btn {
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        /* ============================================
           FILTERS - 25% reducción de altura
           ============================================ */
        .filters-section {
            background: var(--white);
            padding: 0.3rem 0;
            margin-bottom: 0;
            border-top: 1px solid var(--border);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.04);
            position: relative;
            overflow: hidden;
        }

        .filters-wrapper {
            display: flex;
            gap: 0.6rem;
            align-items: center;
            flex-wrap: nowrap;
            overflow-x: auto;
            overflow-y: hidden;
            padding: 0.1rem 3rem;  /* Alineado con header (antes: 0.1rem 3rem 0.1rem 43px) */
            scrollbar-width: none;
            -ms-overflow-style: none;
            position: relative;
            cursor: grab;
        }

        .filters-wrapper:active {
            cursor: grabbing;
        }

        .filters-wrapper::-webkit-scrollbar {
            display: none;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 0.3rem;
            flex-shrink: 0;
            cursor: default;  /* No heredar grab cursor */
        }

        /* Los sliders no deben heredar el cursor grab del wrapper */
        .filter-group .slider-container {
            cursor: default;
        }

        .filter-group .slider-container * {
            cursor: inherit;  /* Heredar el cursor correcto */
        }

        .filter-group:not(:last-child)::after {
            content: '|';
            color: var(--border);
            margin-left: 0.6rem;
            font-weight: 300;
        }

        .filter-label {
            font-weight: 500;
            color: var(--petrol-blue);
            font-size: 9.3px;
            line-height: 1.4;
            text-transform: uppercase;
            letter-spacing: 0.15px;
            white-space: nowrap;
            min-width: 35px;
        }

        select {
            padding: 0.2rem 0.3rem;
            border: 2px solid var(--border);
            border-radius: 4px;
            font-size: 9.3px;
            line-height: 1.4;
            color: var(--text-dark);
            background: var(--white);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 400;
            min-width: 74px;
        }

        select:focus {
            outline: none;
            border-color: var(--petrol-blue);
            box-shadow: 0 0 0 2px rgba(15, 42, 46, 0.1);
        }

        .slider-container {
            display: flex;
            flex-direction: column;
            gap: 0.13rem;
            min-width: 74px;
        }

        .slider-values {
            display: flex;
            justify-content: space-between;
            font-size: 8px;
            line-height: 1.4;
            color: var(--text-auxiliary);
            font-weight: 500;
        }

        /* Sliders definidos en .slider-range más arriba - no duplicar aquí */

        .checkbox-container {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            cursor: pointer;
        }

        input[type="checkbox"] {
            width: 14px;
            height: 14px;
            cursor: pointer;
            accent-color: var(--petrol-blue);
        }

        .checkbox-label {
            font-size: 14px;
            line-height: 1.4;
            font-weight: 400;
        }

        .no-filters-message {
            color: var(--text-auxiliary);
            font-style: italic;
            font-size: 14px;
            line-height: 1.4;
            white-space: nowrap;
        }

        /* ============================================
           CATALOG CONTROLS - 25% reducción de altura
           ============================================ */
        .catalog-controls {
            background: var(--white);
            padding: 0.25rem 0;  /* 5a: Reducido 20% adicional (0.31 → 0.25) */
            border-top: 1px solid var(--border);
            margin-bottom: 0.34rem;  /* 5a: Reducido 20% adicional (0.42 → 0.34) */
            position: relative;
        }

        .catalog-controls-wrapper {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 0.36rem;  /* 5a: Reducido 20% adicional (0.45 → 0.36) */
            align-items: center;
            padding: 0 3rem;  /* 4c: Alineado con header */
        }

        /* 5b: Switcher mostrar/ocultar menú */
        /* 5a: Botón circular mostrar/ocultar menú */
        .menu-toggle-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;           /* Circular */
            height: 36px;          /* Circular */
            padding: 0;
            background: var(--white);
            border: 2px solid var(--petrol-blue);
            border-radius: 50%;    /* CIRCULAR */
            cursor: pointer;
            transition: all 0.3s ease;
            flex-shrink: 0;
            color: var(--petrol-blue);  /* Color para currentColor */
        }

        .menu-toggle-btn:hover {
            background: var(--petrol-blue);
            color: var(--white);  /* Cambiar color de iconos */
        }
        
        /* Estado activo (menú visible): colores invertidos */
        .menu-toggle-btn.menu-visible {
            background: var(--petrol-blue);
            color: var(--white);
        }
        
        .menu-toggle-btn.menu-visible #eyeOpenIcon path {
            fill: var(--white);
            stroke: var(--white);
        }
        
        .menu-toggle-btn.menu-visible #eyeOpenIcon circle {
            fill: var(--petrol-blue);
        }
        
        .menu-toggle-btn.menu-visible:hover {
            background: var(--white);
            color: var(--petrol-blue);
        }
        
        .menu-toggle-btn.menu-visible:hover #eyeOpenIcon path {
            fill: var(--petrol-blue);
            stroke: var(--petrol-blue);
        }
        
        .menu-toggle-btn.menu-visible:hover #eyeOpenIcon circle {
            fill: var(--white);
        }

        .menu-toggle-btn svg {
            width: 20px;
            height: 20px;
            transition: all 0.3s ease;
        }

        /* Ocultar secciones cuando menu está oculto */
        .menu-hidden .categories-section,
        .menu-hidden .subcategories-section,
        .menu-hidden .filters-section {
            display: none;
        }

        /* 5a: Flecha desde header hasta ojo */
        /* 5a: Wrapper para ojo + búsqueda (ojo A LA IZQUIERDA) */
        .search-menu-wrapper {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-wrap: nowrap;  /* NUNCA envolver */
            min-width: 0;
            position: relative;
        }

        .search-box {
            position: relative;
            min-width: 0;
            max-width: 225px;
            flex: 1;  /* Crecer para ocupar espacio */
        }

        .search-input {
            width: 100%;
            padding: 0.25rem 2.5rem 0.25rem 0.5rem;  /* Padding derecha para lupa */
            border: 2px solid var(--border);
            border-radius: 4.5px;
            font-size: 12px;
            line-height: 1.3;
            transition: all 0.3s ease;
            background: var(--light-gray);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--petrol-blue);
            box-shadow: 0 0 0 2.25px rgba(15, 42, 46, 0.1);
            background: var(--white);
        }

        /* 17b: Lupa búsqueda SVG - DERECHA */
        .search-icon,
        .news-search-icon {
            position: absolute;
            right: 0.75rem;  /* Derecha */
            left: auto;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-auxiliary);
            pointer-events: none;
            width: 20px;
            height: 20px;
        }

        .notification-btn-wrapper {
            display: flex;
            justify-content: center;
        }

        .notification-btn-wrapper.sticky {
            position: fixed;
            top: 70px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 999;
            transition: top 0.4s ease;
        }

        body.banner-visible .notification-btn-wrapper.sticky {
            top: 95.38px;
        }

        header.scrolled ~ main .notification-btn-wrapper.sticky {
            top: 60px;
        }

        body.banner-visible header.scrolled ~ main .notification-btn-wrapper.sticky {
            top: 85.38px;
        }

        .notification-btn {
            background: linear-gradient(135deg, var(--orange) 0%, #D97706 100%);
            color: var(--white);
            border: none;
            padding: 0.41rem 0.825rem;
            border-radius: 6px;
            font-weight: 600;
            font-size: 14px;
            line-height: 1;
            cursor: pointer;
            box-shadow: 0 3px 12px rgba(245, 158, 11, 0.3);
            transition: all 0.3s ease;
            white-space: nowrap;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .notification-btn .notification-icon-mobile {
            display: none;
        }
        
        .notification-btn .notification-text {
            display: inline;
        }

        .notification-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(245, 158, 11, 0.4);
        }

        /* 5b: Botón circular Mostrar Favoritos */
        .favorites-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;           /* Circular */
            height: 36px;          /* Circular */
            padding: 0;
            background: var(--white);
            border: 2px solid var(--border);
            border-radius: 50%;    /* CIRCULAR */
            cursor: pointer;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .favorites-btn svg {
            width: 20px;
            height: 20px;
            stroke: var(--petrol-blue);
            fill: none;
            stroke-width: 2;
            transition: all 0.3s ease;
        }

        .favorites-btn:hover {
            background: var(--petrol-blue);
            border-color: var(--petrol-blue);
        }

        .favorites-btn:hover svg {
            fill: var(--gold);
            stroke: var(--gold);
        }

        .favorites-btn.active {
            background: var(--petrol-blue);
            border-color: var(--petrol-blue);
        }

        .favorites-btn.active svg {
            fill: var(--gold);
            stroke: var(--gold);
        }

        .controls-right {
            display: flex;
            align-items: center;
            gap: 0.6rem;
            justify-content: flex-end;
        }

        .view-box {
            display: flex;
            align-items: center;
            gap: 0.34rem;
        }

        .view-label {
            font-weight: 500;
            color: var(--text-dark);
            white-space: nowrap;
            font-size: 10.5px;
            line-height: 1.4;
        }

        .view-select {
            padding: 0.31rem 0.84rem 0.31rem 0.39rem;
            border: 2px solid var(--border);
            border-radius: 4.5px;
            font-size: 10.5px;
            line-height: 1.4;
            background: var(--light-gray);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 400;
            min-width: 82.5px;
        }

        .view-select:focus {
            outline: none;
            border-color: var(--petrol-blue);
            box-shadow: 0 0 0 2.25px rgba(15, 42, 46, 0.1);
            background: var(--white);
        }

        .sort-box {
            display: flex;
            align-items: center;
            gap: 0.34rem;
        }

        .sort-label {
            font-weight: 500;
            color: var(--text-dark);
            white-space: nowrap;
            font-size: 10.5px;
            line-height: 1.4;
        }

        .sort-select {
            padding: 0.31rem 0.84rem 0.31rem 0.39rem;
            border: 2px solid var(--border);
            border-radius: 4.5px;
            font-size: 10.5px;
            line-height: 1.4;
            background: var(--light-gray);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 400;
            min-width: 97.5px;
        }

        .sort-select:focus {
            outline: none;
            border-color: var(--petrol-blue);
            box-shadow: 0 0 0 3px rgba(15, 42, 46, 0.1);
            background: var(--white);
        }

        @media (max-width: 1024px) {
            .catalog-controls-wrapper {
                grid-template-columns: 1fr;
                gap: 0.6rem;
                padding: 0 1.5rem;
            }

            /* 5a: Búsqueda + ojo siempre en línea */
            .search-menu-wrapper {
                display: flex;
                flex-wrap: nowrap;
                gap: 0.5rem;
                width: 100%;
            }
            
            .search-box {
                flex: 1;
                max-width: none;
            }

            .menu-toggle-btn {
                width: 32px;
                height: 32px;
                flex-shrink: 0;
            }

            .menu-toggle-btn svg {
                width: 18px;
                height: 18px;
            }

            /* 5b: Favoritos, Mostrar, Ordenar PEGADOS A LA DERECHA */
            .controls-right {
                order: 3;
                display: flex !important;
                flex-direction: row !important;
                gap: 0.4rem;
                justify-content: flex-end;  /* PEGADO A LA DERECHA */
                flex-wrap: nowrap;
                margin-left: auto;  /* Empujar a la derecha */
            }

            .favorites-btn {
                width: 32px;
                height: 32px;
            }

            .favorites-btn svg {
                width: 18px;
                height: 18px;
            }

            .favorites-btn,
            .view-box,
            .sort-box {
                flex-shrink: 0;
            }

            .view-label,
            .sort-label {
                display: none;  /* Ocultar labels en móvil para ahorrar espacio */
            }
            
            .notification-btn-wrapper {
                order: 2;
            }
            
            .notification-btn-wrapper.sticky {
                left: 0;
                right: 0;
                transform: none;
                padding: 0 1rem;
            }
            
            .notification-btn {
                width: 100%;
            }

            /* 5c: Mantener botones en línea incluso en 480px */
            .controls-right {
                order: 3;
                display: flex !important;
                flex-direction: row !important;
                gap: 0.3rem;
                justify-content: flex-start;
                flex-wrap: nowrap;
            }

            .menu-toggle-btn {
                width: 28px;
                height: 28px;
            }

            .menu-toggle-btn svg {
                width: 16px;
                height: 16px;
            }

            .favorites-btn {
                width: 28px;
                height: 28px;
            }

            .favorites-btn svg {
                width: 16px;
                height: 16px;
            }

            .view-select,
            .sort-select {
                font-size: 10px;
                padding: 0.3rem 0.4rem;
                min-width: 70px;
            }
        }

        @media (max-width: 480px) {
            .catalog-controls-wrapper {
                padding: 0 1rem;  /* Alineado con header 480px (1rem) */
            }

            /* 5a: Búsqueda + ojo en línea incluso en móvil */
            .search-menu-wrapper {
                gap: 0.4rem;
            }

            .search-box {
                min-width: 0;  /* Permitir reducción */
            }

            .search-input {
                font-size: 11px;
                padding: 0.25rem 0.28rem 0.25rem 0.8rem;
            }

            .menu-toggle-btn {
                width: 28px;
                height: 28px;
                flex-shrink: 0;  /* NO reducir */
            }

            .menu-toggle-btn svg {
                width: 16px;
                height: 16px;
            }

            .notification-btn {
                width: 100%;
            }

            /* 5b: Favoritos + Mostrar + Ordenar PEGADOS A LA DERECHA */
            .controls-right {
                display: flex !important;
                flex-direction: row !important;
                gap: 0.3rem;
                flex-wrap: nowrap;
                justify-content: flex-end;  /* PEGADO A LA DERECHA */
                margin-left: auto;  /* Empujar a la derecha */
            }

            .favorites-btn {
                width: 28px;
                height: 28px;
                flex-shrink: 0;
            }

            .favorites-btn svg {
                width: 16px;
                height: 16px;
            }

            .view-select,
            .sort-select {
                font-size: 10px;
                padding: 0.3rem 0.4rem;
                min-width: 70px;
            }
        }

        /* ============================================
           CATALOG
           ============================================ */
        /* 5: Catalog section - sin padding cuando news activa */
        .catalog-section {
            padding: 1.5rem 0;
            margin-bottom: 48px;
            background: var(--light-gray);
        }

        body:has(.news-section.active) .catalog-section {
            padding: 0 !important;  /* 5: Eliminar padding */
            margin-bottom: 0 !important;  /* 5: Eliminar margen */
        }

        .catalog {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 24px;
            margin-bottom: 3rem;
        }

        .catalog.table-view {
            display: block;
        }

        /* ============================================
           TABLE VIEW STYLES
           ============================================ */
        
        /* Wrapper para scroll horizontal */
        .table-wrapper {
            width: 100%;
            overflow-x: auto;
            overflow-y: visible;
            -webkit-overflow-scrolling: touch;
            cursor: grab;
            user-select: none;
        }
        
        .table-wrapper:active {
            cursor: grabbing;
        }
        
        /* Estilos de scrollbar personalizados */
        .table-wrapper::-webkit-scrollbar {
            height: 10px;
        }
        
        .table-wrapper::-webkit-scrollbar-track {
            background: var(--light-gray);
            border-radius: 5px;
        }
        
        .table-wrapper::-webkit-scrollbar-thumb {
            background: var(--medium-gray);
            border-radius: 5px;
        }
        
        .table-wrapper::-webkit-scrollbar-thumb:hover {
            background: var(--dark-gray);
        }
        
        /* Tabla */
        /* 9c: Tabla reducida 25% */
        .catalog-table {
            width: 100%;
            min-width: 1050px; /* Reducido 25%: 1400px → 1050px */
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            font-size: 12px; /* Reducido de 16px base */
        }
        
        .catalog-table thead {
            background: var(--petrol-blue);
            color: white;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        /* 9d: Columnas ordenables */
        .catalog-table th {
            padding: 0.75rem;  /* Reducido 25%: 1rem → 0.75rem */
            text-align: left;
            font-weight: 700;
            font-size: 11px;  /* Reducido 25%: 14px → 11px */
            white-space: nowrap;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid rgba(255,255,255,0.2);
        }
        
        .catalog-table th.sortable {
            cursor: pointer;
            user-select: none;
            position: relative;
            padding-right: 1.5rem;
        }
        
        .catalog-table th.sortable:hover {
            background: rgba(255,255,255,0.1);
        }
        
        /* 9d: Indicadores de ordenamiento */
        .catalog-table th.sortable::after {
            content: '⇅';
            position: absolute;
            right: 0.5rem;
            opacity: 0.3;
            font-size: 10px;
        }
        
        .catalog-table th.sorted-asc::after {
            content: '▲';
            opacity: 1;
        }
        
        .catalog-table th.sorted-desc::after {
            content: '▼';
            opacity: 1;
        }
        
        .catalog-table tbody tr {
            border-bottom: 1px solid var(--border);
            transition: background-color 0.2s;
        }
        
        .catalog-table tbody tr:hover {
            background-color: var(--light-gray);
        }
        
        .catalog-table tbody tr.table-row {
            cursor: pointer;
        }
        
        .catalog-table td {
            padding: 0.56rem 0.75rem;  /* Reducido 25%: 0.75rem 1rem → 0.56rem 0.75rem */
            vertical-align: middle;
            font-size: 14px;
        }
        
        /* Imagen en tabla */
        .table-image {
            width: 80px;
            height: 60px;
            object-fit: cover;
            border-radius: 6px;
            display: block;
        }
        
        /* Categoría badge en tabla */
        /* 1: Categorías - MISMO estilo que image-overlay-category */
        .table-category,
        .vehicle-category-badge {
            display: inline-block !important;
            background: linear-gradient(135deg, #0F2A2E 0%, #1A4248 100%) !important;
            color: #FFFFFF !important;
            padding: 0.5rem 0.9rem !important;
            font-size: 12px !important;
            line-height: 1.4 !important;
            font-weight: 700 !important;
            text-transform: uppercase !important;
            letter-spacing: 0.5px !important;
            border-radius: 12px !important;
            white-space: nowrap !important;
        }
        
        /* Ignorar clases alquiler/venta/terceros - todos igual */
        .table-category.alquiler,
        .table-category.venta,
        .table-category.terceros {
            background: linear-gradient(135deg, #0F2A2E 0%, #1A4248 100%) !important;
            color: #FFFFFF !important;
        }
        
        /* Precio en tabla */
        /* 2: Precios - VERDE como image-overlay-price */
        .table-price,
        .vehicle-price {
            font-weight: 700 !important;
            color: #10B981 !important;
            white-space: nowrap !important;
            background: linear-gradient(135deg, #10B981 0%, #059669 100%) !important;
            -webkit-background-clip: text !important;
            -webkit-text-fill-color: transparent !important;
            background-clip: text !important;
        }
        
        /* Ubicación en tabla */
        .table-location {
            white-space: nowrap;
        }
        
        /* Botones de iconos en tabla */
        .table-icon-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 2px solid var(--border);
            background: white;
            color: var(--text-color);
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0;
        }
        
        .table-icon-btn:hover {
            background: var(--light-gray);
            border-color: var(--primary-color);
            transform: scale(1.1);
        }
        
        /* Botón favorito */
        .table-icon-btn.favorite-btn.active {
            color: #f39c12;
            border-color: #f39c12;
            background: rgba(243, 156, 18, 0.1);
        }
        
        /* Botón compartir */
        .table-icon-btn.share-btn {
            font-weight: bold;
        }
        
        .table-icon-btn.share-btn:hover {
            color: var(--primary-color);
        }
        
        /* Botón descargar folleto */
        .table-icon-btn.download-btn:hover {
            color: #C41E3A;
            border-color: #C41E3A;
        }
        
        /* Celda de acciones en tabla */
        .table-actions-cell {
            white-space: nowrap;
        }
        
        /* Responsive: en pantallas pequeñas mostrar scroll hint */
        @media (max-width: 1400px) {
            .table-wrapper::after {
                content: '← Arrastra para ver más →';
                display: block;
                text-align: center;
                padding: 0.5rem;
                background: var(--light-gray);
                color: var(--text-color);
                font-size: 12px;
                font-style: italic;
                border-radius: 0 0 8px 8px;
                margin-top: -8px;
            }
        }
        
        @media (max-width: 768px) {
            .catalog-table {
                min-width: 1200px;
            }
            
            .catalog-table th,
            .catalog-table td {
                padding: 0.5rem 0.75rem;
                font-size: 13px;
            }
            
            .table-image {
                width: 60px;
                height: 45px;
            }
            
            .table-icon-btn {
                width: 28px;
                height: 28px;
                font-size: 14px;
            }
        }
        
        @media (max-width: 480px) {
            .catalog-table {
                min-width: 1000px;
            }
            
            .catalog-table th,
            .catalog-table td {
                padding: 0.4rem 0.6rem;
                font-size: 12px;
            }
            
            .table-image {
                width: 50px;
                height: 38px;
            }
        }

        .product-card {
            background: var(--white);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid transparent;
            display: flex;
            flex-direction: column;
            cursor: pointer;
            aspect-ratio: 1 / 1;
        }

        .product-card:hover {
            transform: translateY(-12px);
            box-shadow: 0 20px 40px rgba(15, 42, 46, 0.12);
            border-color: var(--petrol-light);
        }

        .product-image-container {
            position: relative;
            aspect-ratio: 4 / 3;
            background: linear-gradient(135deg, var(--light-gray) 0%, var(--medium-gray) 100%);
            overflow: hidden;
        }

        .product-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }

        .product-card:hover .product-image {
            transform: scale(1.08);
        }

        .image-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 1rem;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 3;
        }

        .product-card:hover .image-nav {
            opacity: 1;
        }

        .image-nav-btn {
            background: rgba(255, 255, 255, 0.95);
            border: none;
            width: 38px;
            height: 38px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            font-size: 1.1rem;
            color: var(--petrol-blue);
            font-weight: bold;
        }

        .image-nav-btn:hover {
            background: var(--white);
            transform: scale(1.15);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
        }

        .image-indicators {
            position: absolute;
            bottom: 0.6rem;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 0.5rem;
            background: rgba(0, 0, 0, 0.5);
            padding: 0.4rem 0.9rem;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            z-index: 2;
        }

        .indicator {
            width: 7px;
            height: 7px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .indicator.active {
            background: var(--white);
            width: 24px;
            border-radius: 4px;
        }

        /* 5b: Etiquetas categoría y ubicación - MISMO diseño catálogo */
        .image-overlay-category {
            position: absolute !important;
            bottom: 0 !important;
            left: 0 !important;
            background: linear-gradient(135deg, #0F2A2E 0%, #1A4248 100%) !important;
            color: #FFFFFF !important;
            padding: 0.5rem 0.9rem !important;
            font-size: 12px !important;
            line-height: 1.4 !important;
            font-weight: 700 !important;
            text-transform: uppercase !important;
            letter-spacing: 0.5px !important;
            border-top-right-radius: 12px !important;
            z-index: 2 !important;
            display: block !important;
        }

        .image-overlay-location {
            position: absolute !important;
            bottom: 0 !important;
            right: 0 !important;
            background: rgba(0, 0, 0, 0.75) !important;
            backdrop-filter: blur(10px) !important;
            color: #FFFFFF !important;
            padding: 0.5rem 0.9rem !important;
            font-size: 12px !important;
            line-height: 1.4 !important;
            font-weight: 600 !important;
            border-top-left-radius: 12px !important;
            display: flex !important;
            align-items: center !important;
            gap: 0.4rem !important;
            z-index: 2 !important;
        }

        /* 5c: Precio VERDE - igual que catálogo */
        .image-overlay-price {
            position: absolute !important;
            top: 0 !important;
            right: 0 !important;
            background: linear-gradient(135deg, #10B981 0%, #059669 100%) !important;
            color: #FFFFFF !important;
            padding: 0.6rem 1rem !important;
            font-size: 14px !important;
            line-height: 1.4 !important;
            font-weight: 700 !important;
            border-bottom-left-radius: 12px !important;
            z-index: 2 !important;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2) !important;
            display: block !important;
        }

        .product-info {
            padding: 1.2rem 1.3rem;
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 0.9rem;
        }

        .product-title {
            font-size: 18px;
            line-height: 1.35;
            font-weight: 700;
            color: var(--petrol-blue);
            /* Responsive: una sola línea siempre */
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        }

        .product-disclaimer {
            font-size: 14px;
            line-height: 1.5;
            color: var(--text-auxiliary);
            font-style: italic;
        }

        /* 8c: Banner amarillo pastel para terceros - RESPONSIVE */
        /* 5a+6: Banner intermediación UNA LÍNEA SIEMPRE */
        .product-terceros-banner,
        #vehicleDisclaimerContainer,
        #vehicleDisclaimerContainer > * {
            background: #FFFEF0 !important;
            border-left: 3px solid #F5D547 !important;
            padding: 0.5rem 0.8rem !important;
            font-size: 12px !important;  /* 1: Más grande: 10px → 12px */
            line-height: 1.3 !important;
            color: #5A5A3D !important;
            margin-bottom: 0.15rem !important;  /* 1: Menos espacio: 0.25rem → 0.15rem */
            border-radius: 4px !important;
            width: 100% !important;
            box-sizing: border-box !important;
            white-space: nowrap !important;
            overflow: hidden !important;
            text-overflow: ellipsis !important;
            display: block !important;
        }
        
        /* Ocultar banner cuando está vacío (NO terceros) */
        .product-terceros-banner:empty,
        #vehicleDisclaimerContainer:empty {
            display: none !important;
        }

        @media (max-width: 1200px) {
            .product-terceros-banner,
            #vehicleDisclaimerContainer,
            #vehicleDisclaimerContainer > * {
                font-size: 11px !important;
            }
        }

        @media (max-width: 768px) {
            .product-terceros-banner,
            #vehicleDisclaimerContainer,
            #vehicleDisclaimerContainer > * {
                font-size: 10px !important;
                padding: 0.4rem 0.6rem !important;
            }
        }

        @media (max-width: 480px) {
            .product-terceros-banner,
            #vehicleDisclaimerContainer,
            #vehicleDisclaimerContainer > * {
                font-size: 9px !important;
                padding: 0.3rem 0.5rem !important;
            }
        }

        .product-specs {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.7rem;
        }

        .spec-item {
            display: flex;
            flex-direction: column;
            gap: 0.3rem;
        }

        .spec-label {
            font-size: 12px;
            line-height: 1.4;
            color: var(--text-auxiliary);
            text-transform: uppercase;
            letter-spacing: 0.3px;
            font-weight: 500;
        }

        .spec-value {
            font-weight: 700;
            color: var(--petrol-blue);
            font-size: 14px;
            line-height: 1.4;
        }

        /* ============================================
           VEHICLE DETAIL MODAL - GAMMA Style
           ============================================ */
        /* ============================================
           14: MODAL DETALLE VEHÍCULO - NUEVA ESTRUCTURA
           ============================================ */
        
        /* 4: Modales overflow visible para X completa */
        .vehicle-detail-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            overflow-y: auto;
            padding: 2rem 1rem;
        }

        .vehicle-detail-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* 2: Vehicle modal SIN scroll - pantalla completa */
        /* 2+4: Vehicle modal content - overflow visible para X */
        .vehicle-detail-content {
            background: white;
            border-radius: 16px;
            max-width: 95vw;
            width: 100%;
            max-height: 95vh;
            position: relative;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            overflow: visible !important;  /* 2: X visible fuera - FORZADO */
        }

        /* 14c: Grid responsive - scrolleable internamente */
        .vehicle-detail-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            padding: 2rem;
            overflow-y: auto;       /* 2: Scroll interno si necesario */
            flex: 1;
        }

        /* ============================================
           14a: ÁREA IZQUIERDA - GALERÍA
           ============================================ */
        
        .vehicle-gallery-section {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        /* Imagen principal 4:3 con botones laterales */
        .vehicle-main-image-container {
            position: relative;
            width: 100%;
            aspect-ratio: 4 / 3;
            background: var(--light-gray);
            border-radius: 12px;
            overflow: hidden;
        }

        .vehicle-main-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Botones de navegación en los laterales de la imagen */
        .vehicle-image-nav-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.6);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        .vehicle-image-nav-btn:hover {
            background: rgba(0, 0, 0, 0.8);
            transform: translateY(-50%) scale(1.1);
        }

        .vehicle-image-nav-btn.nav-prev {
            left: 10px;
        }

        .vehicle-image-nav-btn.nav-next {
            right: 10px;
        }

        /* Carrusel de miniaturas DEBAJO de la imagen (no dentro) */
        .vehicle-thumbnails-wrapper {
            width: 100%;
            overflow-x: auto;
            overflow-y: hidden;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: thin;
            scrollbar-color: var(--petrol-blue) var(--light-gray);
        }

        .vehicle-thumbnails-wrapper::-webkit-scrollbar {
            height: 6px;
        }

        .vehicle-thumbnails-wrapper::-webkit-scrollbar-track {
            background: var(--light-gray);
            border-radius: 3px;
        }

        .vehicle-thumbnails-wrapper::-webkit-scrollbar-thumb {
            background: var(--petrol-blue);
            border-radius: 3px;
        }

        .vehicle-thumbnails-container {
            display: flex;
            gap: 0.5rem;
            padding: 0.25rem 0;
        }

        .vehicle-thumbnail {
            width: 80px;
            height: 60px;
            object-fit: cover;
            border-radius: 6px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .vehicle-thumbnail:hover {
            border-color: var(--petrol-blue);
            transform: scale(1.05);
        }

        .vehicle-thumbnail.active {
            border-color: var(--petrol-blue);
            box-shadow: 0 0 0 2px var(--petrol-light);
        }

        /* Sticky notification naranja centrado debajo de miniaturas */
        .vehicle-sticky-notification {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            text-align: center;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(243, 156, 18, 0.3);
        }

        .vehicle-sticky-notification:hover {
            background: linear-gradient(135deg, #e67e22 0%, #d35400 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(243, 156, 18, 0.4);
        }

        /* ============================================
           14b: ÁREA DERECHA - INFORMACIÓN
           ============================================ */
        
        .vehicle-info-section {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        /* 14b: Fila de acciones - Contactar grande + 2 botones circulares */
        .vehicle-actions-row {
            display: flex;
            gap: 0.75rem;
            align-items: center;
        }

        .vehicle-pdf-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            background: white;
            color: var(--petrol-blue);
            border: 2px solid var(--petrol-blue);
            padding: 0.75rem 1rem;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .vehicle-pdf-btn:hover {
            background: var(--petrol-blue);
            color: white;
        }
        
        .vehicle-pdf-btn svg {
            flex-shrink: 0;
        }
        
        .vehicle-contact-btn {
            flex: 1;
            background: var(--petrol-blue);
            color: white;
            border: none;
            padding: 0.85rem 1.5rem;
            border-radius: 8px;
            font-weight: 700;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .vehicle-contact-btn:hover {
            background: var(--petrol-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(15, 42, 46, 0.3);
        }

        /* 14b: Botones circulares (favorito y compartir) */
        .vehicle-icon-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid var(--border);
            background: white;
            color: var(--text-color);
            font-size: 1.3rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .vehicle-icon-btn:hover {
            border-color: var(--petrol-blue);
            background: var(--light-gray);
            transform: scale(1.1);
        }

        .vehicle-icon-btn.favorite-btn.active {
            color: #f39c12;
            border-color: #f39c12;
            background: rgba(243, 156, 18, 0.1);
        }

        .vehicle-icon-btn.share-btn {
            font-weight: bold;
        }

        /* 14b: Título y Precio (misma línea siempre) */
        .vehicle-title-price-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 1rem;
            flex-wrap: nowrap;
        }

        /* 3: vehicle-title - UNA LÍNEA SIEMPRE */
        .vehicle-title {
            font-size: 1.5rem !important;
            font-weight: 800 !important;
            color: #0F2A2E !important;
            margin: 0 !important;
            line-height: 1.2 !important;
            flex: 1 !important;
            min-width: 0 !important;
            white-space: nowrap !important;
            overflow: hidden !important;
            text-overflow: ellipsis !important;
        }

        .vehicle-price {
            font-size: 1.75rem !important;
            font-weight: 800 !important;
            color: #10B981 !important;
            white-space: nowrap !important;
            flex-shrink: 0 !important;
            background: linear-gradient(135deg, #10B981 0%, #059669 100%) !important;
            -webkit-background-clip: text !important;
            -webkit-text-fill-color: transparent !important;
            background-clip: text !important;
        }

        /* 14b: Etiqueta y Ubicación (misma línea siempre) */
        .vehicle-meta-row {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: nowrap;
        }

        .vehicle-category-badge {
            display: inline-block !important;
            background: linear-gradient(135deg, #0F2A2E 0%, #1A4248 100%) !important;
            color: #FFFFFF !important;
            padding: 0.5rem 0.9rem !important;
            font-size: 12px !important;
            line-height: 1.4 !important;
            font-weight: 700 !important;
            text-transform: uppercase !important;
            letter-spacing: 0.5px !important;
            border-radius: 12px !important;
            white-space: nowrap !important;
        }

        .vehicle-category-badge.alquiler,
        .vehicle-category-badge.venta,
        .vehicle-category-badge.terceros {
            background: linear-gradient(135deg, #0F2A2E 0%, #1A4248 100%) !important;
            color: #FFFFFF !important;
        }

        /* 1: vehicle-location - MISMO que image-overlay-location */
        .vehicle-location {
            display: inline-flex !important;
            align-items: center !important;
            gap: 0.4rem !important;
            background: rgba(0, 0, 0, 0.75) !important;
            color: #FFFFFF !important;
            padding: 0.5rem 0.9rem !important;
            font-size: 12px !important;
            line-height: 1.4 !important;
            font-weight: 600 !important;
            border-radius: 12px !important;
            white-space: nowrap !important;
        }
        }

        /* Disclaimer */
        .vehicle-disclaimer {
            background: rgba(231, 76, 60, 0.1);
            color: #c0392b;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            font-size: 0.85rem;
            border-left: 4px solid #c0392b;
        }

        /* Características - Grid de 3 columnas */
        .vehicle-characteristics h3 {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--petrol-blue);
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .vehicle-char-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
        }

        .vehicle-char-item {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
            padding: 0.75rem;
            background: var(--light-gray);
            border-radius: 8px;
        }

        .vehicle-char-label {
            font-size: 0.75rem;
            color: var(--text-auxiliary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        .vehicle-char-value {
            font-size: 1rem;
            color: var(--text-dark);
            font-weight: 700;
        }

        /* Descripción */
        .vehicle-description h3 {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--petrol-blue);
            margin-bottom: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .vehicle-description p {
            color: var(--text-color);
            line-height: 1.6;
            font-size: 0.95rem;
        }

        /* 14c: RESPONSIVE */
        @media (max-width: 1024px) {
            .vehicle-detail-grid {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }

            .vehicle-char-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .vehicle-detail-content {
                max-height: 95vh;
                border-radius: 12px;
            }

            .vehicle-detail-grid {
                padding: 1.5rem;
            }

            .vehicle-title {
                font-size: 1.25rem;
            }

            .vehicle-price {
                font-size: 1.5rem;
            }

            .vehicle-char-grid {
                grid-template-columns: 1fr;
            }

            .vehicle-pdf-btn {
                padding: 0.6rem 0.8rem;
                font-size: 0.75rem;
            }
            
            .vehicle-pdf-btn span {
                display: none;
            }
            
            .vehicle-contact-btn {
                padding: 0.875rem 1.5rem;
                font-size: 0.9rem;
            }

            .vehicle-icon-btn {
                width: 45px;
                height: 45px;
                font-size: 1.2rem;
            }
        }

        @media (max-width: 480px) {
            .vehicle-detail-modal {
                padding: 0.5rem;
            }

            .vehicle-detail-grid {
                padding: 1rem;
                gap: 1rem;
            }

            .vehicle-title-price-row {
                flex-direction: column;
                align-items: flex-start;
            }

            .vehicle-price {
                font-size: 1.5rem;
            }

            .vehicle-thumbnail {
                width: 60px;
                height: 45px;
            }
        }

        @media (min-width: 1025px) and (min-height: 800px) {
            .vehicle-detail-content {
                max-height: 85vh;
            }

            .vehicle-info-section {
                overflow-y: auto;
                max-height: calc(85vh - 4rem);
                padding-right: 0.5rem;
            }

            .vehicle-info-section::-webkit-scrollbar {
                width: 6px;
            }

            .vehicle-info-section::-webkit-scrollbar-track {
                background: var(--light-gray);
                border-radius: 3px;
            }

            .vehicle-info-section::-webkit-scrollbar-thumb {
                background: var(--petrol-blue);
                border-radius: 3px;
            }
        }

        /* ============================================
           CONTACT MODAL
           ============================================ */
        .contact-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2001;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .contact-modal.active {
            display: flex;
        }

        .contact-modal-content {
            background: var(--white);
            border-radius: 16px;
            padding: 2.5rem;
            max-width: 500px;
            width: 90%;
            position: relative;
        }


        .contact-modal-title {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--petrol-blue);
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .contact-options {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .contact-option {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.2rem;
            background: var(--light-gray);
            border: 2px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            color: var(--text-dark);
        }

        .contact-option:hover {
            border-color: var(--petrol-blue);
            background: var(--white);
            transform: translateX(5px);
        }

        .contact-icon-large {
            width: 50px;
            height: 50px;
            background: var(--petrol-blue);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            flex-shrink: 0;
        }

        .contact-option-text {
            display: flex;
            flex-direction: column;
        }

        .contact-option-title {
            font-weight: 700;
            font-size: 16px;
            line-height: 1.4;
        }

        .contact-option-subtitle {
            font-size: 14px;
            line-height: 1.6;
            color: var(--text-secondary);
        }

        /* ============================================
           NEWS SECTION - SUSTITUYE CATÁLOGO
           ============================================ */
        .news-section {
            padding: 0;
            margin: 0;
            display: none;
        }

        .news-section.active {
            display: block;
        }

        /* Secciones Sobre nosotros + Legal */
        .about-section,
        .legal-section {
            padding: 0;
            margin: 0;
            display: none;
        }

        .about-section.active,
        .legal-section.active {
            display: block;
        }

        .section-header-top {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.5rem;
            background: var(--white);
            border-bottom: 1px solid var(--border);
        }

        .section-back-button {
            background: var(--light-gray);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 24px;
            color: var(--petrol-blue);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .section-back-button:hover {
            background: var(--petrol-blue);
            color: var(--white);
        }

        .section-title {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--petrol-blue);
            margin: 0;
        }

        .section-content-placeholder {
            padding: 3rem;
            text-align: center;
            color: var(--text-secondary);
            font-size: 1.2rem;
        }

        /* 1: Ocultar catálogo cuando cualquier sección activa */
        body:has(.news-section.active) .categories-section,
        body:has(.news-section.active) .subcategories-section,
        body:has(.news-section.active) .filters-section,
        body:has(.news-section.active) #catalogControls,
        body:has(.news-section.active) #catalog,
        body:has(.about-section.active) .categories-section,
        body:has(.about-section.active) .subcategories-section,
        body:has(.about-section.active) .filters-section,
        body:has(.about-section.active) #catalogControls,
        body:has(.about-section.active) #catalog,
        body:has(.legal-section.active) .categories-section,
        body:has(.legal-section.active) .subcategories-section,
        body:has(.legal-section.active) .filters-section,
        body:has(.legal-section.active) #catalogControls,
        body:has(.legal-section.active) #catalog {
            display: none !important;
        }


        /* Eliminar espacio del container dentro de news-section */
        .news-section > .container {
            padding-top: 0 !important;
            margin-top: 0 !important;
        }

        .news-header-top {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 0.75rem;
            padding: 0.15rem 3rem 0.5rem;  /* Top mínimo, bottom 0.5rem */
            margin-top: 0;
            position: relative;
        }

        /* 15c: Botón atrás oculto */
        .news-back-button {
            display: none;  /* Eliminado */
        }

        /* 1) Wrapper para top3 con botones scroll */
        .top-news-bar-wrapper {
            position: relative;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex: 1;
            max-width: 900px;
        }

        /* 15d: Top news bar con scroll */
        .top-news-bar {
            display: flex;
            align-items: center;
            gap: 1rem;
            background: var(--light-gray);
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            flex: 1;
            overflow: hidden;
        }

        .top-news-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-shrink: 0;  /* Nunca se oculta */
        }

        .top-news-icon {
            color: var(--petrol-blue);
            flex-shrink: 0;
        }

        .top-news-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--petrol-blue);
            white-space: nowrap;
            flex-shrink: 0;  /* Siempre visible */
        }

        /* 15d: Wrapper con scroll OCULTO - solo botones */
        .top-news-wrapper {
            display: flex;
            overflow-x: auto;
            overflow-y: hidden;
            scrollbar-width: none;  /* Firefox - OCULTAR */
            -ms-overflow-style: none;  /* IE - OCULTAR */
            -webkit-overflow-scrolling: touch;
            flex: 1;
            min-width: 0;
        }

        .top-news-wrapper::-webkit-scrollbar {
            display: none;  /* Chrome/Safari - OCULTAR */
        }

        .top-news-list {
            display: flex;
            align-items: center;
            gap: 2rem;
            padding: 0;
            min-width: min-content;
        }

        .top-news-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 7.9px;
            line-height: 1.4;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-dark);
            text-decoration: none;
            font-weight: 500;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .top-news-item:hover {
            color: var(--petrol-blue);
            transform: translateX(3px);
        }

        .news-search {
            max-width: 600px;
            margin: 0.5rem auto 0.5rem;  /* Reducido: 9px → 0.5rem */
            position: relative;
        }

        /* News search input - lupa derecha */
        .news-search-input {
            width: 100%;
            padding: 0.45rem 2.5rem 0.45rem 0.75rem;  /* Padding derecha para lupa */
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 9px;
            line-height: 1.3;
            transition: all 0.3s ease;
        }

        .news-search-input:focus {
            outline: none;
            border-color: var(--petrol-blue);
            box-shadow: 0 0 0 3px rgba(15, 42, 46, 0.1);
        }
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.9rem;
            color: var(--text-auxiliary);
            pointer-events: none;  /* No interferir con clicks */
        }

        .news-filters {
            display: flex;
            justify-content: center;
            gap: 0.85rem;
            margin-bottom: 0.5rem;  /* Reducido: 12px → 0.5rem */
            flex-wrap: nowrap;
            overflow-x: auto;
            overflow-y: hidden;
            scrollbar-width: none;
            -ms-overflow-style: none;
            padding: 0.5rem;
            max-width: 600px;
            margin: 0 auto 12px;
        }

        .news-filters::-webkit-scrollbar {
            display: none;
        }

        .news-filter-item {
            display: flex;
            align-items: center;
            gap: 0.35rem;
            cursor: pointer;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .news-filter-checkbox {
            width: 15px;
            height: 15px;
        }

        .news-filter-label {
            font-weight: 500;
            font-size: 9px;
            line-height: 1.4;
            color: var(--text-dark);
        }

        .news-section-title {
            font-size: 32px;
            line-height: 1.2;
            font-weight: 800;
            color: var(--petrol-blue);
            text-align: center;
            margin-bottom: 0.5rem;  /* Super compacto: 12px → 0.5rem */
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .news-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            row-gap: 1.5rem;
            column-gap: 0.5rem;   /* 2️⃣ YA REDUCIDO 75% */
            margin-bottom: 8px;
            padding: 0 3rem;
        }

        /* 10d: Tarjetas noticias reducidas 25% */
        .news-card {
            background: var(--white);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 3px 15px rgba(0, 0, 0, 0.06);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid transparent;
            display: flex;
            flex-direction: column;
            cursor: pointer;
            aspect-ratio: 1 / 1;
            transform: scale(0.75);
            transform-origin: top center;
            margin-bottom: -20%;  /* 3) Reducido: -30% → -20% para más espacio entre filas */
        }

        .news-card:hover {
            transform: scale(0.75) translateY(-12px);
            box-shadow: 0 15px 30px rgba(15, 42, 46, 0.12);
            border-color: var(--petrol-light);
        }

        .news-image-container {
            position: relative;
            aspect-ratio: 4 / 3;
            background: linear-gradient(135deg, var(--light-gray) 0%, var(--medium-gray) 100%);
            overflow: hidden;
        }

        .news-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }

        .news-card:hover .news-image {
            transform: scale(1.08);
        }

        .news-image-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 0.6rem;
            background: linear-gradient(to bottom, rgba(0,0,0,0.6) 0%, transparent 100%);
            z-index: 2;
        }

        .news-date-badge {
            background: rgba(0, 0, 0, 0.75);
            color: var(--white);
            padding: 0.3rem 0.6rem;
            border-radius: 6px;
            font-size: 12px;
            line-height: 1.4;
            font-weight: 600;
        }

        .news-category-badge {
            background: var(--petrol-blue);
            color: var(--white);
            padding: 0.3rem 0.6rem;
            border-radius: 6px;
            font-size: 12px;
            line-height: 1.4;
            font-weight: 700;
            text-transform: uppercase;
        }

        .news-comments-badge {
            position: absolute;
            bottom: 0.6rem;
            right: 0.6rem;
            background: rgba(0, 0, 0, 0.75);
            color: var(--white);
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.3rem;
            z-index: 3;
        }

        .news-comments-badge svg {
            width: 12px;
            height: 12px;
        }

        .news-content {
            padding: 1.2rem 1.3rem;
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .news-title {
            font-size: 18px;
            line-height: 1.35;
            font-weight: 700;
            color: var(--petrol-blue);
            margin-bottom: 0.3rem;
        }

        .news-subtitle {
            font-size: 14px;
            line-height: 1.5;
            color: var(--text-secondary);
        }

        .news-load-more {
            display: flex;
            justify-content: flex-end;
            padding-right: 3rem;
        }

        .load-more-btn {
            background: var(--petrol-blue);
            color: var(--white);
            border: none;
            padding: 0.7rem 1.8rem;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            line-height: 1;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .load-more-btn:hover {
            background: var(--petrol-light);
            transform: translateY(-2px);
        }

        /* ============================================
           NEWS MODAL
           ============================================ */
        .news-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            align-items: flex-start;
            justify-content: center;
            padding: 2rem;
            overflow-y: auto;
        }

        .news-modal.active {
            display: flex;
        }

        .news-modal-content {
            background: var(--white);
            border-radius: 16px;
            max-width: 900px;
            width: 100%;
            position: relative;
            margin-top: 2rem;
            margin-bottom: 2rem;
        }

        .news-modal-image-container {
            position: relative;
            height: 0;
            padding-bottom: 75%;
        }

        .news-modal-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .news-modal-date {
            position: absolute;
            top: 1rem;
            left: 1rem;
            background: rgba(0, 0, 0, 0.75);
            color: var(--white);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 14px;
            line-height: 1.4;
            font-weight: 600;
        }

        .news-modal-comments-badge {
            position: absolute;
            bottom: 1rem;
            right: 1rem;
            background: rgba(0, 0, 0, 0.8);
            color: var(--white);
            padding: 0.4rem 0.8rem;
            border-radius: 16px;
            font-size: 13px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.4rem;
            z-index: 10;
            cursor: pointer;  /* 15: Clickeable */
            transition: all 0.3s ease;
        }

        .news-modal-comments-badge:hover {
            background: var(--petrol-blue);
            transform: scale(1.05);
        }

        .news-modal-comments-badge svg {
            width: 14px;
            height: 14px;
        }


        .news-modal-body {
            padding: 48px;
        }

        .news-modal-title {
            font-size: 32px;
            line-height: 1.2;
            font-weight: 800;
            color: var(--petrol-blue);
            margin-bottom: 16px;
        }

        .news-modal-subtitle {
            font-size: 18px;
            line-height: 1.5;
            color: var(--text-secondary);
            margin-bottom: 16px;
        }

        .news-modal-hashtags {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            padding: 16px 0;
            border-bottom: 1px solid var(--border);
            margin-bottom: 32px;
        }

        .hashtag {
            background: var(--light-gray);
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 14px;
            line-height: 1.4;
            color: var(--petrol-blue);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .hashtag:hover {
            background: var(--petrol-blue);
            color: var(--white);
        }

        .news-modal-text {
            font-size: 18px;
            line-height: 1.6;
            color: var(--text-dark);
            margin-bottom: 48px;
        }

        .news-modal-text p {
            margin-bottom: 24px;
        }

        /* 15: Botones reorganizados */
        .news-modal-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
            margin-bottom: 48px;
            justify-content: space-between;  /* 15: Espacio entre */
            flex-wrap: wrap;
        }

        #newsModalComment {
            margin-right: auto;  /* 15: Comentar a la izquierda */
        }

        .btn-action-news {
            background: var(--petrol-blue);
            color: var(--white);
            border: none;
            padding: 0.8rem 1.8rem;
            border-radius: 9999px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 14px;
            line-height: 1;
        }

        .btn-action-news:hover {
            background: var(--petrol-light);
            transform: translateY(-2px);
        }

        .btn-action-news svg {
            width: 18px;
            height: 18px;
        }

        .subscribe-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2001;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .subscribe-modal.active {
            display: flex;
        }

        .subscribe-modal-content {
            background: var(--white);
            border-radius: 16px;
            padding: 2.5rem;
            max-width: 500px;
            width: 90%;
            position: relative;
        }


        .subscribe-modal-title {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--petrol-blue);
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .subscribe-options {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .subscribe-option {
            display: flex;
            align-items: flex-start;
            gap: 0.8rem;
            padding: 1rem;
            background: var(--light-gray);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .subscribe-option:hover {
            background: var(--white);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .subscribe-option input[type="checkbox"] {
            margin-top: 0.2rem;
        }

        .subscribe-option-text {
            flex: 1;
        }

        .subscribe-option-title {
            font-weight: 700;
            color: var(--petrol-blue);
            margin-bottom: 0.2rem;
            font-size: 16px;
            line-height: 1.4;
        }

        .subscribe-option-desc {
            font-size: 14px;
            line-height: 1.6;
            color: var(--text-secondary);
        }

        .subscribe-email-input {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 16px;
            line-height: 1.3;
            margin-bottom: 1rem;
        }

        .subscribe-btn {
            width: 100%;
            padding: 1rem;
            background: var(--petrol-blue);
            color: var(--white);
            border: none;
            border-radius: 8px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .subscribe-btn:hover {
            background: var(--petrol-light);
        }

        .hashtag-view {
            display: none;
        }

        .hashtag-view.active {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2rem;
            grid-template-rows: auto 1fr;
        }
        
        .hashtag-view .back-to-comments-btn {
            grid-column: 1 / -1;
        }
        
        .hashtag-view .hashtag-view-title {
            grid-column: 1 / -1;
        }
        
        @media (max-width: 1024px) {
            .hashtag-view.active {
                grid-template-columns: 1fr;
            }
        }

        .back-to-comments-btn {
            background: var(--medium-gray);
            border: none;
            padding: 0.7rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
            margin-bottom: 32px;
            font-size: 14px;
            line-height: 1;
        }

        .back-to-comments-btn:hover {
            background: var(--border);
        }

        .hashtag-view-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--petrol-blue);
            margin-bottom: 48px;
            text-align: center;
        }

        .hashtag-section {
            margin-bottom: 48px;
        }

        .hashtag-section-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--petrol-blue);
            margin-bottom: 16px;
        }

        .hashtag-news-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .hashtag-news-item {
            background: var(--light-gray);
            padding: 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .hashtag-news-item:hover {
            background: var(--white);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .hashtag-news-title {
            font-weight: 700;
            color: var(--petrol-blue);
            margin-bottom: 0.3rem;
            font-size: 16px;
            line-height: 1.4;
        }

        .hashtag-news-date {
            font-size: 14px;
            line-height: 1.6;
            color: var(--text-secondary);
        }

        .hashtag-news-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 0.5rem;
        }

        .hashtag-news-comments {
            display: flex;
            align-items: center;
            gap: 0.3rem;
            color: var(--text-auxiliary);
            font-size: 12px;
            font-weight: 600;
        }

        .hashtag-news-comments svg {
            width: 12px;
            height: 12px;
        }

        .comments-section {
            border-top: 2px solid var(--border);
            padding-top: 48px;
        }

        .comment-form-container {
            display: none;
            margin-bottom: 48px;
            background: var(--light-gray);
            padding: 24px;
            border-radius: 12px;
            position: relative;
        }

        .comment-form-container.active {
            display: block;
        }

        .comment-form-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-auxiliary);
            line-height: 1;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .comment-form-close:hover {
            background: var(--medium-gray);
        }

        .comment-form-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--petrol-blue);
            margin-bottom: 0.5rem;
        }

        .comment-form-subtitle {
            font-size: 14px;
            line-height: 1.5;
            color: var(--text-secondary);
            font-style: italic;
            margin-bottom: 16px;
        }

        .comment-textarea {
            width: 100%;
            min-height: 100px;
            padding: 0.8rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-family: inherit;
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 16px;
            resize: vertical;
        }

        .comment-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 16px;
        }

        .comment-input {
            padding: 0.7rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 16px;
            line-height: 1.3;
        }

        .comment-submit-btn {
            background: var(--petrol-blue);
            color: var(--white);
            border: none;
            padding: 0.8rem 2rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            line-height: 1;
        }

        .comment-submit-btn:hover {
            background: var(--petrol-light);
        }

        .comments-list {
            margin-top: 48px;
        }

        .comment-thread {
            margin-bottom: 1.5rem;
        }

        .comment-item {
            background: var(--light-gray);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 0.75rem;
            border-left: 3px solid transparent;
        }

        .comment-replies {
            margin-left: 2rem;
            padding-left: 1rem;
            border-left: 2px solid var(--border);
        }

        .comment-replies .comment-item {
            background: var(--white);
            border-left-color: var(--petrol-light);
        }

        .reply-btn {
            background: none;
            border: none;
            color: var(--petrol-blue);
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 0.5rem;
            padding: 0.25rem 0;
        }

        .reply-btn:hover {
            text-decoration: underline;
        }

        .comment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .comment-author {
            font-weight: 700;
            color: var(--petrol-blue);
            font-size: 16px;
            line-height: 1.4;
        }

        .comment-pending {
            font-size: 14px;
            line-height: 1.4;
            color: var(--orange);
            font-style: italic;
            font-weight: 600;
        }

        .comment-date {
            font-size: 14px;
            line-height: 1.6;
            color: var(--text-secondary);
        }

        .comment-text {
            color: var(--text-dark);
            line-height: 1.6;
            margin-bottom: 12px;
            font-size: 16px;
        }

        .comment-reply-btn {
            background: none;
            border: none;
            color: var(--petrol-blue);
            font-weight: 600;
            font-size: 14px;
            line-height: 1.4;
            cursor: pointer;
            padding: 0;
        }

        .comment-reply-btn:hover {
            text-decoration: underline;
        }

        /* ============================================
           FOOTER
           ============================================ */
        footer {
            background: linear-gradient(135deg, var(--petrol-dark) 0%, var(--petrol-blue) 100%);
            color: var(--text-dark-bg);
            padding: 48px 0 32px 0;
            margin-top: 64px;
        }

        .footer-content {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 3rem;
            display: flex;
            justify-content: space-evenly;
            gap: 4rem;
            margin-bottom: 48px;
        }

        .footer-section {
            flex: 0 0 auto;
            min-width: 150px;
        }

        .footer-section h3 {
            font-size: 16px;
            line-height: 1.4;
            margin-bottom: 16px;
            font-weight: 700;
        }

        .footer-section h3 a {
            color: inherit;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .footer-section h3 a:hover {
            color: var(--text-dark-secondary);
        }

        .footer-section p,
        .footer-section a {
            color: var(--text-dark-secondary);
            text-decoration: none;
            line-height: 1.6;
            transition: all 0.3s ease;
            display: block;
            cursor: pointer;
            font-size: 14px;
        }

        .footer-section a:hover {
            color: var(--text-dark-bg);
            padding-left: 0.5rem;
        }

        .footer-links {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .footer-kit-digital {
            text-align: center;
            padding: 0 3rem;
            margin-bottom: 32px;
        }

        .footer-kit-digital img {
            width: 100%;
            max-width: 1600px;
            height: auto;
        }

        .footer-bottom {
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            padding: 32px 3rem 0 3rem;
            text-align: center;
            color: var(--text-dark-secondary);
            font-size: 14px;
            line-height: 1.6;
        }

        .footer-logo {
            margin-bottom: 16px;
        }

        .footer-logo img {
            max-width: 180px;
            height: auto;
            opacity: 0.9;
            transition: opacity 0.3s ease;
        }

        .footer-logo img:hover {
            opacity: 1;
        }

        @media (max-width: 1200px) {
            .footer-content {
                flex-wrap: wrap;
            }

            .news-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 0 1.5rem;
            }

            .container-no-padding {
                padding: 0;  /* Siempre sin padding */
            }

            .catalog {
                grid-template-columns: 1fr;
            }

            .footer-content {
                flex-direction: row;
                justify-content: space-around;
                gap: 1rem;
                padding: 0 2rem;
            }
            
            .footer-section {
                min-width: auto;
            }
            
            /* 11a: Ocultar subsecciones en tablet/móvil */
            .footer-links {
                display: none;
            }
            
            .footer-section h3 {
                font-size: 14px;
                margin-bottom: 0;
            }

            .news-grid {
                grid-template-columns: 1fr;
                padding: 0 1.5rem;
            }

            /* 15d: Top3 responsive - scroll activo en móvil */
            .news-header-top {
                padding: 0 1.5rem;
            }

            .top-news-bar {
                max-width: calc(100vw - 3rem);
            }

            .top-news-wrapper {
                overflow-x: auto;  /* Activar scroll en móvil */
            }

            .news-load-more {
                padding-right: 1.5rem;
            }
        }
        
        /* En pantallas MUY pequeñas, mantener diseño compacto */
        @media (max-width: 480px) {
            .footer-links {
                display: none;  /* Ya oculto en 768px */
            }
            
            .footer-content {
                gap: 0.5rem;
            }
            
            .footer-section h3 {
                font-size: 14px;
            }
        }

        .hidden {
            display: none !important;
        }
    
        /* Chat Usuario - Estilo WhatsApp */
        .chat-container { background: #f9fafb; border-radius: 8px; padding: 15px; }
        .chat-messages { max-height: 350px; overflow-y: auto; margin-bottom: 12px; min-height: 150px; }
        .chat-empty { text-align: center; color: #9ca3af; padding: 30px; }
        .chat-msg { margin-bottom: 6px; max-width: 85%; }
        .chat-msg.user { margin-left: auto; }
        .chat-msg.admin { margin-right: auto; }
        .chat-msg .bubble { padding: 8px 12px; border-radius: 12px; word-wrap: break-word; font-size: 13px; line-height: 1.4; position: relative; }
        .chat-msg.user .bubble { background: #0F2A2E; color: white; border-bottom-right-radius: 4px; }
        .chat-msg.admin .bubble { background: #e5e7eb; color: #1f2937; border-bottom-left-radius: 4px; }
        .chat-msg .bubble .msg-time { font-size: 10px; opacity: 0.7; margin-left: 10px; float: right; margin-top: 4px; }
        .chat-input-container { display: flex; flex-direction: column; gap: 10px; }
        .chat-input-container textarea { padding: 10px; border: 1px solid #e5e7eb; border-radius: 8px; resize: none; font-family: inherit; }
        .chat-info { font-size: 12px; color: #6b7280; margin-top: 10px; }
        
        /* Separador de fecha en chat */
        .chat-date-separator { text-align: center; margin: 15px 0; }
        .chat-date-separator span { background: #e5e7eb; padding: 4px 12px; border-radius: 10px; font-size: 11px; color: #6b7280; }

        /* ============================================
           HEADER MOBILE - Menús desplegables
           ============================================ */
        .mobile-menu-group {
            display: none;
            position: relative;
        }
        
        /* Icono botón idéntico a desktop */
        .header-icon-btn {
            width: 38px;
            height: 38px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 50%;
            color: var(--white);
            text-decoration: none;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            cursor: pointer;
            flex-shrink: 0;
            border: none;
        }
        
        .header-icon-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .header-icon-btn svg {
            width: 18px;
            height: 18px;
        }
        
        /* Área de conexión invisible entre botón y dropdown */
        .mobile-menu-group::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            height: 15px;
            display: none;
        }
        
        .mobile-menu-group.active::after {
            display: block;
        }
        
        .mobile-menu-dropdown {
            display: none;
            position: absolute;
            top: calc(100% + 10px);
            left: 50%;
            transform: translateX(-50%);
            background: rgba(15, 42, 46, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            padding: 8px;
            z-index: 1000;
        }
        
        .mobile-menu-group.active .mobile-menu-dropdown {
            display: flex;
            flex-direction: row;
            gap: 6px;
        }
        
        .mobile-menu-dropdown .header-icon-btn {
            width: 36px;
            height: 36px;
        }
        
        .mobile-menu-dropdown .header-icon-btn svg {
            width: 16px;
            height: 16px;
        }
        
        /* Selector de idioma móvil */
        .mobile-lang-dropdown {
            display: none;
            position: absolute;
            top: calc(100% + 10px);
            left: 50%;
            transform: translateX(-50%);
            background: rgba(15, 42, 46, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 50%;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
            padding: 4px;
            z-index: 1000;
        }
        
        .mobile-menu-group.active .mobile-lang-dropdown {
            display: flex;
        }
        
        /* Bandera dentro del círculo con mismo tamaño que otros iconos */
        .lang-flag-img {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            object-fit: cover;
        }
        
        .lang-trigger {
            overflow: hidden;
        }
        
        .lang-option {
            cursor: pointer;
        }
        
        /* Indicador visual cuando menú está activo */
        .mobile-menu-group.active > .header-icon-btn,
        .mobile-menu-group.active > .mobile-trigger {
            background: rgba(255, 255, 255, 0.4);
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.2);
        }
        
        /* Desktop: elementos normales visibles */
        .desktop-only {
            display: flex;
        }
        
        /* Mobile: < 768px - Activar menús compactos */
        @media (max-width: 768px) {
            .desktop-only {
                display: none !important;
            }
            
            .mobile-menu-group {
                display: block;
            }
            
            .header-right {
                gap: 4px !important;
            }
            
            .account-btn span {
                display: none !important;
            }
            
            .account-btn {
                padding: 8px !important;
                border-radius: 50% !important;
            }
        }
        
        /* Botón ojo - Estado activo (menú visible): colores invertidos */
        .menu-toggle-btn.menu-visible {
            background: var(--petrol-blue);
            color: var(--white);
        }
        
        .menu-toggle-btn.menu-visible #eyeOpenIcon path {
            fill: var(--white);
            stroke: var(--white);
        }
        
        .menu-toggle-btn.menu-visible #eyeOpenIcon circle {
            fill: var(--petrol-blue);
        }
        
        /* Botón naranja - Icono prismáticos en móvil */
        .notification-btn {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .notification-btn .notification-icon-mobile {
            display: none;
        }
        
        .notification-btn .notification-text {
            display: inline;
        }
        
        /* ============================================
           ALINEACIÓN CONSISTENTE - CORRECCIÓN FINAL
           Paddings: Base 3rem → 768px 1.5rem → 480px 1rem
           ============================================ */
        @media (max-width: 768px) {
            .categories {
                padding: 0 1.5rem !important;
            }
            .subcategories {
                padding: 0 1.5rem !important;
            }
            .filters-wrapper {
                padding: 0.1rem 1.5rem !important;
            }
            .catalog-controls-wrapper {
                padding: 0 1.5rem !important;
            }
        }
        
        @media (max-width: 480px) {
            .header-content {
                padding: 0.6rem 1rem !important;
            }
            .categories {
                padding: 0 1rem !important;
            }
            .subcategories {
                padding: 0 1rem !important;
            }
            .filters-wrapper {
                padding: 0.1rem 1rem !important;
            }
            .catalog-controls-wrapper {
                padding: 0 1rem !important;
            }
        }
        
        /* ============================================
           BUSCADOR Y CONTROLES - REDISEÑADO
           ============================================ */
        
        .catalog-controls-wrapper {
            display: flex;
            flex-direction: row;
            flex-wrap: nowrap;
            align-items: center;
            justify-content: space-between;
            gap: 0.75rem;
            padding: 0.5rem 3rem;
            background: var(--light-gray);
            border-bottom: 1px solid #e5e7eb;
        }
        
        .controls-left {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-shrink: 0;
        }
        
        .controls-right {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex-shrink: 0;
        }
        
        /* Botón Menú con texto */
        .menu-toggle-btn {
            display: flex !important;
            align-items: center !important;
            gap: 0.5rem !important;
            padding: 0.4rem 0.5rem 0.4rem 0.75rem !important;
            background: var(--petrol-blue);
            border: 2px solid var(--petrol-blue);
            border-radius: 20px !important;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--white);
            font-weight: 600;
            font-size: 13px;
            width: auto !important;
            height: auto !important;
        }
        
        /* Wrapper del ojo con circunferencia blanca */
        .eye-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            border: 2px solid white;
            border-radius: 50%;
            flex-shrink: 0;
        }
        
        .eye-wrapper svg {
            width: 14px !important;
            height: 14px !important;
        }
        
        .menu-toggle-btn #eyeOpenIcon path {
            fill: white;
            stroke: white;
        }
        
        .menu-toggle-btn #eyeOpenIcon circle {
            fill: var(--petrol-blue);
        }
        
        .menu-toggle-btn:hover {
            background: var(--white);
            color: var(--petrol-blue);
            border-color: var(--petrol-blue);
        }
        
        .menu-toggle-btn:hover .eye-wrapper {
            border-color: var(--petrol-blue);
        }
        
        .menu-toggle-btn:hover #eyeOpenIcon path {
            fill: var(--petrol-blue);
            stroke: var(--petrol-blue);
        }
        
        .menu-toggle-btn:hover #eyeOpenIcon circle {
            fill: white;
        }
        
        /* Cuando menú está visible (estado activo = fondo azul) */
        .menu-toggle-btn.menu-visible {
            background: var(--petrol-blue);
            color: var(--white);
        }
        
        .menu-toggle-btn.menu-visible .eye-wrapper {
            border-color: white;
        }
        
        .menu-toggle-btn.menu-visible #eyeOpenIcon path {
            fill: white;
            stroke: white;
        }
        
        .menu-toggle-btn.menu-visible #eyeOpenIcon circle {
            fill: var(--petrol-blue);
        }
        
        /* Cuando menú NO está visible (ojo tachado) */
        .menu-toggle-btn:not(.menu-visible) {
            background: var(--white);
            color: var(--petrol-blue);
        }
        
        .menu-toggle-btn:not(.menu-visible) .eye-wrapper {
            border-color: var(--petrol-blue);
        }
        
        .menu-toggle-btn:not(.menu-visible) #eyeClosedIcon path,
        .menu-toggle-btn:not(.menu-visible) #eyeClosedIcon circle,
        .menu-toggle-btn:not(.menu-visible) #eyeClosedIcon line {
            stroke: var(--petrol-blue);
        }
        
        .menu-label {
            display: inline !important;
        }
        
        /* Buscador Desktop - caja completa */
        .search-box {
            display: flex;
            align-items: center;
            background: var(--white);
            border: 2px solid var(--petrol-blue);
            border-radius: 20px;
            padding: 0.3rem 0.5rem 0.3rem 0.75rem;
            gap: 0.4rem;
        }
        
        .search-box .search-icon {
            color: var(--petrol-blue);
            flex-shrink: 0;
        }
        
        .search-box .search-input {
            border: none;
            outline: none;
            font-size: 13px;
            width: 160px;
            background: transparent;
            color: var(--petrol-blue);
        }
        
        .search-box .search-input::placeholder {
            color: #9ca3af;
        }
        
        .search-clear-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
            padding: 0;
            background: #e5e7eb;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            color: #6b7280;
            transition: all 0.2s;
            flex-shrink: 0;
        }
        
        .search-clear-btn:hover {
            background: var(--petrol-blue);
            color: white;
        }
        
        /* Buscador Móvil - wrapper */
        .mobile-search-wrapper {
            display: none;
            position: relative;
        }
        
        /* Buscador Móvil - icono colapsable */
        .search-btn-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            padding: 0;
            background: var(--white);
            border: 2px solid var(--petrol-blue);
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--petrol-blue);
        }
        
        .search-btn-icon:hover,
        .search-wrapper.active .search-btn-icon {
            background: var(--petrol-blue);
            color: var(--white);
        }
        
        .search-dropdown {
            display: none;
            position: absolute;
            top: calc(100% + 8px);
            left: 0;
            background: var(--white);
            border: 2px solid var(--petrol-blue);
            border-radius: 8px;
            padding: 0.4rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 100;
            min-width: 200px;
        }
        
        .search-wrapper.active .search-dropdown {
            display: block;
        }
        
        .search-dropdown input {
            border: none;
            outline: none;
            font-size: 14px;
            width: 100%;
            padding: 0.3rem;
            background: transparent;
        }
        
        .desktop-search {
            display: flex;
        }
        
        .mobile-search {
            display: none;
        }
        
        /* Sticky Notification */
        .notification-btn-wrapper {
            flex: 1;
            display: flex;
            justify-content: center;
            min-width: 0;
        }
        
        .notification-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            background: linear-gradient(135deg, var(--orange) 0%, #D97706 100%);
            color: var(--white);
            border: none;
            padding: 0.5rem 1.25rem;
            border-radius: 25px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            box-shadow: 0 3px 12px rgba(245, 158, 11, 0.3);
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        .notification-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(245, 158, 11, 0.4);
        }
        
        .notification-btn .notification-icon {
            flex-shrink: 0;
            color: white !important;
            stroke: white !important;
            display: none !important;  /* Oculto en desktop */
            width: 22px !important;
            height: 22px !important;
        }
        
        .notification-btn .notification-icon circle,
        .notification-btn .notification-icon path {
            stroke: white !important;
        }
        
        .notification-btn .notification-icon circle[fill="currentColor"] {
            fill: white !important;
        }
        
        .notification-text-desktop {
            display: inline !important;
        }
        
        .notification-text-mobile {
            display: none !important;
        }
        
        /* Favoritos */
        .favorites-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            padding: 0;
            background: var(--white);
            border: 2px solid var(--petrol-blue);
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--petrol-blue);
            flex-shrink: 0;
        }
        
        .favorites-btn svg {
            width: 18px;
            height: 18px;
            fill: none;
            stroke: currentColor;
            stroke-width: 2;
            transition: all 0.3s ease;
        }
        
        .favorites-btn:hover {
            background: var(--petrol-blue);
            color: var(--white);
        }
        
        .favorites-btn:hover svg {
            stroke: var(--white);
        }
        
        .favorites-btn.active {
            background: var(--petrol-blue);
            color: var(--white);
        }
        
        .favorites-btn.active svg {
            fill: var(--orange);
            stroke: var(--white);
        }
        
        /* Switcher Vista Grid/Tabla */
        .view-switcher {
            display: flex;
            background: var(--white);
            border: 2px solid var(--petrol-blue);
            border-radius: 20px;
            overflow: hidden;
        }
        
        .view-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 32px;
            padding: 0;
            background: transparent;
            border: none;
            cursor: pointer;
            color: var(--petrol-blue);
            transition: all 0.2s ease;
        }
        
        .view-btn:first-child {
            border-right: 1px solid var(--petrol-blue);
        }
        
        .view-btn:hover {
            background: rgba(15, 42, 46, 0.1);
        }
        
        .view-btn.active {
            background: var(--petrol-blue);
            color: var(--white);
        }
        
        .view-btn svg {
            width: 16px;
            height: 16px;
        }
        
        /* Ordenar con dropdown */
        .sort-wrapper {
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }
        
        .sort-label {
            font-size: 13px;
            font-weight: 600;
            color: var(--petrol-blue);
        }
        
        .sort-dropdown-wrapper {
            position: relative;
        }
        
        .sort-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            padding: 0;
            background: var(--white);
            border: 2px solid var(--petrol-blue);
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--petrol-blue);
        }
        
        .sort-btn:hover,
        .sort-dropdown-wrapper.active .sort-btn {
            background: var(--petrol-blue);
            color: var(--white);
        }
        
        .sort-dropdown {
            display: none;
            position: absolute;
            top: calc(100% + 8px);
            right: 0;
            background: var(--white);
            border: 2px solid var(--petrol-blue);
            border-radius: 8px;
            padding: 0.5rem 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 100;
            min-width: 150px;
        }
        
        .sort-dropdown-wrapper.active .sort-dropdown {
            display: block;
        }
        
        .sort-option {
            display: block;
            width: 100%;
            padding: 0.5rem 1rem;
            text-align: left;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 13px;
            color: var(--petrol-blue);
            transition: background 0.2s;
        }
        
        .sort-option:hover {
            background: rgba(15, 42, 46, 0.1);
        }
        
        .sort-option.active {
            background: var(--petrol-blue);
            color: var(--white);
        }
        
        /* ============================================
           RESPONSIVE - MÓVIL
           ============================================ */
        @media (max-width: 768px) {
            .catalog-controls-wrapper {
                padding: 0.4rem 1rem;
                gap: 0.4rem;
            }
            
            /* Ocultar label del menú en móvil - solo mostrar el ojo */
            .menu-label {
                display: none !important;
            }
            
            .menu-toggle-btn {
                width: 32px !important;
                height: 32px !important;
                padding: 0 !important;
                border-radius: 50% !important;
                justify-content: center !important;
            }
            
            .eye-wrapper {
                width: 100% !important;
                height: 100% !important;
                border: none !important;
            }
            
            .menu-toggle-btn.menu-visible {
                background: var(--petrol-blue) !important;
                border-color: var(--petrol-blue) !important;
            }
            
            .menu-toggle-btn:not(.menu-visible) {
                background: var(--white) !important;
                border: 2px solid var(--petrol-blue) !important;
            }
            
            /* Buscador: ocultar desktop, mostrar móvil */
            .desktop-search {
                display: none !important;
            }
            
            .mobile-search-wrapper {
                display: block !important;
            }
            
            .search-btn-icon {
                display: flex !important;
            }
            
            .search-dropdown {
                display: none;
            }
            
            .mobile-search-wrapper.active .search-dropdown {
                display: block;
            }
            
            /* Notification móvil: botón con icono + texto */
            .notification-text-desktop {
                display: none !important;
            }
            
            .notification-text-mobile {
                display: inline !important;
            }
            
            .notification-btn {
                padding: 0.4rem 0.75rem !important;
                font-size: 11px !important;
                gap: 0.35rem !important;
                border-radius: 20px !important;
            }
            
            .notification-btn .notification-icon {
                display: none !important;  /* Sin icono en móvil */
            }
            
            /* Favoritos */
            .favorites-btn {
                width: 32px;
                height: 32px;
            }
            
            .favorites-btn svg {
                width: 16px;
                height: 16px;
            }
            
            /* Vista switcher */
            .view-btn {
                width: 32px;
                height: 28px;
            }
            
            .view-btn svg {
                width: 14px;
                height: 14px;
            }
            
            /* Ordenar: solo icono */
            .sort-label {
                display: none !important;
            }
            
            .sort-btn {
                width: 32px;
                height: 32px;
            }
        }
        
        @media (max-width: 480px) {
            .catalog-controls-wrapper {
                padding: 0.3rem 0.75rem;
                gap: 0.2rem;
            }
            
            .menu-toggle-btn,
            .search-btn-icon,
            .favorites-btn,
            .sort-btn {
                width: 28px !important;
                height: 28px !important;
            }
            
            .menu-toggle-btn svg,
            .search-btn-icon svg,
            .favorites-btn svg,
            .sort-btn svg {
                width: 14px !important;
                height: 14px !important;
            }
            
            .notification-btn {
                padding: 0.3rem 0.5rem;
                font-size: 10px;
            }
            
            .notification-btn .notification-icon {
                width: 16px;
                height: 16px;
            }
            .notification-btn {
                padding: 0.3rem 0.5rem;
                font-size: 11px;
            }
            
            .notification-btn .notification-icon {
                width: 14px;
                height: 14px;
            }
            
            .view-btn {
                width: 28px;
                height: 24px;
            }
            
            .view-btn svg {
                width: 12px;
                height: 12px;
            }
        }

        </style>
    
    <!-- CSS del sistema de autenticación y panel de usuario -->
    <link rel="stylesheet" href="auth-user-panel.css">
    
    <!-- Scripts del sistema -->
    <script src="google-sheets-api.js"></script>
    <script src="auth-system.js" defer></script>
    <script src="user-panel.js" defer></script>
    <script src="user-panel-functions.js" defer></script>
</head>
<body>
<!-- BANNER - Empieza oculto, se muestra dinámicamente si está activo -->
    <div class="announcement-banner hidden" id="announcementBanner">
        <!-- Contenido se carga dinámicamente desde Sheets -->
    </div>

    <!-- HEADER -->
    <header id="header">
        <div class="header-content">
            <div class="logo" id="logoBtn">TANK IBERICA</div>
            <div class="header-right">
                <!-- DESKTOP: Enlaces normales -->
                <div class="social-links desktop-only">
                    <a href="/cdn-cgi/l/email-protection#2e474048416e5a4f4045474c4b5c474d4f004d4143" id="emailIcon" class="contact-icon" title="Email">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                            <polyline points="22,6 12,13 2,6"></polyline>
                        </svg>
                    </a>
                    <a href="tel:+34600000000" id="phoneIcon" class="contact-icon" title="Teléfono">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                        </svg>
                    </a>
                    <a href="https://wa.me/34600000000" id="whatsapp-link" target="_blank" title="WhatsApp">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
                        </svg>
                    </a>
                    <a href="https://linkedin.com/company/tankiberica" target="_blank" title="LinkedIn">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                        </svg>
                    </a>
                    <a href="https://facebook.com/tankiberica" target="_blank" title="Facebook">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                        </svg>
                    </a>
                </div>
                
                <!-- MOBILE: Menú Contacto (mismo icono que desktop) -->
                <!-- MOBILE: Iconos idénticos a desktop con desplegables -->
                <div class="mobile-menu-group" id="mobileContactMenu">
                    <!-- Botón principal: icono SMARTPHONE ANTIGUO con botón físico -->
                    <a href="#" class="header-icon-btn mobile-trigger" onclick="event.preventDefault();" title="Contactar">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <!-- Cuerpo del smartphone con bordes redondeados arriba -->
                            <rect x="5" y="1" width="14" height="22" rx="3" ry="3"></rect>
                            <!-- Altavoz superior -->
                            <line x1="9" y1="4" x2="15" y2="4" stroke-linecap="round"></line>
                            <!-- Pantalla -->
                            <rect x="7" y="6" width="10" height="11" rx="0.5"></rect>
                            <!-- Botón físico circular (Home button) -->
                            <circle cx="12" cy="20" r="1.5" fill="currentColor"></circle>
                        </svg>
                    </a>
                    <div class="mobile-menu-dropdown">
                        <a href="/cdn-cgi/l/email-protection#f891969e97b88c999693919a9d8a919b99d69b9795" class="header-icon-btn" title="Email">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                                <polyline points="22,6 12,13 2,6"></polyline>
                            </svg>
                        </a>
                        <a href="tel:+34600000000" class="header-icon-btn" title="Teléfono">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                            </svg>
                        </a>
                        <a href="https://wa.me/34600000000" target="_blank" class="header-icon-btn" title="WhatsApp">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
                            </svg>
                        </a>
                    </div>
                </div>
                
                <!-- MOBILE: Menú Redes Sociales -->
                <div class="mobile-menu-group" id="mobileSocialMenu">
                    <!-- Botón principal: icono GLOBO TERRÁQUEO -->
                    <a href="#" class="header-icon-btn mobile-trigger" onclick="event.preventDefault();" title="Redes Sociales">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="2" y1="12" x2="22" y2="12"></line>
                            <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
                        </svg>
                    </a>
                    <div class="mobile-menu-dropdown">
                        <a href="https://wa.me/34600000000" target="_blank" class="header-icon-btn" title="WhatsApp">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
                            </svg>
                        </a>
                        <a href="https://linkedin.com/company/tankiberica" target="_blank" class="header-icon-btn" title="LinkedIn">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                            </svg>
                        </a>
                        <a href="https://facebook.com/tankiberica" target="_blank" class="header-icon-btn" title="Facebook">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                            </svg>
                        </a>
                    </div>
                </div>
                
                <!-- MOBILE: Selector de idioma - mismo tamaño que otros iconos -->
                <div class="mobile-menu-group" id="mobileLangMenu">
                    <div class="header-icon-btn mobile-trigger lang-trigger" id="mobileLangTrigger">
                        <img src="https://flagcdn.com/w40/es.png" alt="ES" class="lang-flag-img" id="mobileLangFlag">
                    </div>
                    <div class="mobile-lang-dropdown" id="mobileLangDropdown">
                        <div class="header-icon-btn lang-option" id="mobileLangAlt" data-lang="en">
                            <img src="https://flagcdn.com/w40/gb.png" alt="EN" class="lang-flag-img">
                        </div>
                    </div>
                </div>
                
                <!-- DESKTOP: Selector de idioma normal -->
                <div class="lang-switch desktop-only">
                    <button class="lang-btn active" data-lang="es">ES</button>
                    <button class="lang-btn" data-lang="en">EN</button>
                </div>
                
                <!-- Botón de cuenta -->
                <button class="account-btn" id="accountBtn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                    <span id="accountBtnText" class="user-name" data-es="Mi cuenta" data-en="My account">Mi cuenta</span>
                </button>
            </div>
        </div>
    </header>

    <main>
        <!-- CATEGORIES -->
        <section class="categories-section">
            <div class="categories-wrapper" id="categoriesWrapper">
                <button class="scroll-btn scroll-btn-left hidden" id="categoriesScrollLeft">◀</button>
                <div class="categories" id="categoriesContainer">
                    <button class="category-btn" data-category="alquiler" data-es="Alquiler" data-en="Rental">Alquiler</button>
                    <button class="category-btn" data-category="venta" data-es="Venta" data-en="Sale">Venta</button>
                    <button class="category-btn" data-category="terceros" data-es="Terceros" data-en="Third Party">Terceros</button>
                    <button class="category-btn" data-category="anunciate" data-es="Anúnciate" data-en="Advertise">Anúnciate</button>
                </div>
                <button class="scroll-btn scroll-btn-right hidden" id="categoriesScrollRight">▶</button>
            </div>
        </section>

        <!-- CATALOG CONTENT -->
        <div id="catalogContent">
            <section class="subcategories-section">
                <div class="subcategories-wrapper" id="subcategoriesWrapper">
                    <button class="scroll-btn scroll-btn-left hidden" id="subcategoriesScrollLeft">◀</button>
                    <div class="subcategories" id="subcategoriesContainer">
                        <!-- Subcategorías se cargan dinámicamente desde Google Sheets -->
                    </div>
                    <button class="scroll-btn scroll-btn-right hidden" id="subcategoriesScrollRight">▶</button>
                </div>
            </section>

            <section class="filters-section">
                <div class="container-no-padding">
                    <button class="scroll-btn scroll-btn-left hidden" id="filtersScrollLeft">◀</button>
                    <div class="filters-wrapper" id="filtersWrapper">
                        <div class="filter-group" data-filtro-nombre="${nombre.toLowerCase()}">
                            <label class="filter-label" data-es="Precio:" data-en="Price:">Precio:</label>
                            <div class="slider-container">
                                <div class="slider-values">
                                    <span id="priceMinValue">0€</span>
                                    <span>-</span>
                                    <span id="priceMaxValue">200k€</span>
                                </div>
                                <div class="slider-range">
                                    <input type="range" id="priceMin" min="0" max="200000" value="0" step="100">
                                    <input type="range" id="priceMax" min="0" max="200000" value="200000" step="100">
                                </div>
                            </div>
                        </div>

                        <div class="filter-group" data-filtro-nombre="${nombre.toLowerCase()}">
                            <label class="filter-label" data-es="Marca:" data-en="Brand:">Marca:</label>
                            <select id="brandFilter">
                                <option value="" data-es="Todas" data-en="All">Todas</option>
                                <option value="scania">Scania</option>
                                <option value="volvo">Volvo</option>
                                <option value="mercedes">Mercedes-Benz</option>
                                <option value="man">MAN</option>
                                <option value="daf">DAF</option>
                                <option value="iveco">Iveco</option>
                                <option value="renault">Renault</option>
                            </select>
                        </div>

                        <div class="filter-group" data-filtro-nombre="${nombre.toLowerCase()}">
                            <label class="filter-label" data-es="Año:" data-en="Year:">Año:</label>
                            <div class="slider-container">
                                <div class="slider-values">
                                    <span id="yearMinValue">1900</span>
                                    <span>-</span>
                                    <span id="yearMaxValue">2024</span>
                                </div>
                                <div class="slider-range">
                                    <input type="range" id="yearMin" min="1900" max="2500" value="2000">
                                    <input type="range" id="yearMax" min="1900" max="2500" value="2024">
                                </div>
                            </div>
                        </div>

                        <div id="advancedFilters" style="display: contents;"></div>
                    </div>
                    <button class="scroll-btn scroll-btn-right hidden" id="filtersScrollRight">▶</button>
                </div>
            </section>

            <section class="catalog-controls" id="catalogControls">
                <div class="container-no-padding">
                    <div class="catalog-controls-wrapper">
                        <!-- Grupo izquierdo: Menú + Buscador -->
                        <div class="controls-left">
                            <!-- Botón Menú: Desktop = "Menú" + ojo | Móvil = solo ojo -->
                            <button class="menu-toggle-btn menu-visible" id="menuToggleBtn" onclick="toggleMenuVisibility()">
                                <span class="menu-label" data-es="Menú" data-en="Menu">Menú</span>
                                <span class="eye-wrapper">
                                    <svg id="eyeOpenIcon" width="18" height="18" viewBox="0 0 24 24">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" fill="currentColor" stroke="currentColor" stroke-width="2"></path>
                                        <circle cx="12" cy="12" r="3" fill="white" stroke="none"></circle>
                                    </svg>
                                    <svg id="eyeClosedIcon" width="18" height="18" viewBox="0 0 24 24" style="display: none;">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" fill="none" stroke="currentColor" stroke-width="2"></path>
                                        <circle cx="12" cy="12" r="3" fill="none" stroke="currentColor" stroke-width="2"></circle>
                                        <line x1="2" y1="2" x2="22" y2="22" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"></line>
                                    </svg>
                                </span>
                            </button>

                            <!-- Buscador Desktop: caja completa con lupa izq y X derecha -->
                            <div class="search-box desktop-search" id="desktopSearchBox">
                                <svg class="search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="11" cy="11" r="8"></circle>
                                    <path d="m21 21-4.35-4.35"></path>
                                </svg>
                                <input type="text" id="searchInput" class="search-input" placeholder="Buscar..." data-es-placeholder="Buscar..." data-en-placeholder="Search...">
                                <button class="search-clear-btn" id="searchClearBtn" type="button" style="display: none;">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="18" y1="6" x2="6" y2="18"></line>
                                        <line x1="6" y1="6" x2="18" y2="18"></line>
                                    </svg>
                                </button>
                            </div>
                            
                            <!-- Buscador Móvil: icono lupa colapsable -->
                            <div class="search-wrapper mobile-search-wrapper" id="searchWrapper">
                                <button class="search-btn-icon" id="searchBtnIcon" title="Buscar">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="11" cy="11" r="8"></circle>
                                        <path d="m21 21-4.35-4.35"></path>
                                    </svg>
                                </button>
                                <div class="search-dropdown" id="searchDropdown">
                                    <input type="text" id="searchInputMobile" placeholder="Buscar..." data-es-placeholder="Buscar..." data-en-placeholder="Search...">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Centro: Sticky Notification -->
                        <div class="notification-btn-wrapper" id="notificationBtnWrapper">
                            <button class="notification-btn" id="notificationBtn" onclick="abrirModalSolicitud()">
                                <!-- Icono binoculares mejorado -->
                                <svg class="notification-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <!-- Lente izquierda -->
                                    <circle cx="6" cy="15" r="4"></circle>
                                    <!-- Lente derecha -->
                                    <circle cx="18" cy="15" r="4"></circle>
                                    <!-- Tubo izquierdo -->
                                    <path d="M6 11V6c0-1 .5-2 2-2h2"></path>
                                    <!-- Tubo derecho -->
                                    <path d="M18 11V6c0-1-.5-2-2-2h-2"></path>
                                    <!-- Puente central -->
                                    <path d="M10 4h4"></path>
                                    <!-- Detalle lentes (reflejo) -->
                                    <circle cx="5" cy="14" r="1" fill="currentColor" opacity="0.3"></circle>
                                    <circle cx="17" cy="14" r="1" fill="currentColor" opacity="0.3"></circle>
                                </svg>
                                <span class="notification-text-desktop" data-es="¿No encuentra lo que busca? Solicítelo aquí" data-en="Can't find what you're looking for? Request it here">¿No encuentra lo que busca? Solicítelo aquí</span>
                                <span class="notification-text-mobile" data-es="¿No lo encuentra? Le avisamos" data-en="Can't find it? We'll notify you">¿No lo encuentra? Le avisamos</span>
                            </button>
                        </div>
                        
                        <!-- Grupo derecho: Favoritos + Vista + Ordenar -->
                        <div class="controls-right">
                            <!-- Favoritos -->
                            <button class="favorites-btn" id="favoritesBtn" title="Filtrar por favoritos" onclick="toggleFavorites()">
                                <svg viewBox="0 0 24 24">
                                    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                                </svg>
                            </button>

                            <!-- Switcher Vista: Grid/Tabla -->
                            <div class="view-switcher" id="viewSwitcher">
                                <button class="view-btn active" data-view="thumbnails" title="Miniaturas" onclick="changeView('thumbnails')">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                        <rect x="3" y="3" width="7" height="7" rx="1"></rect>
                                        <rect x="14" y="3" width="7" height="7" rx="1"></rect>
                                        <rect x="3" y="14" width="7" height="7" rx="1"></rect>
                                        <rect x="14" y="14" width="7" height="7" rx="1"></rect>
                                    </svg>
                                </button>
                                <button class="view-btn" data-view="table" title="Tabla" onclick="changeView('table')">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                        <rect x="3" y="3" width="18" height="4" rx="1"></rect>
                                        <rect x="3" y="10" width="18" height="4" rx="1"></rect>
                                        <rect x="3" y="17" width="18" height="4" rx="1"></rect>
                                    </svg>
                                </button>
                            </div>

                            <!-- Ordenar: Icono flechas + desplegable -->
                            <div class="sort-wrapper">
                                <span class="sort-label" data-es="Ordenar" data-en="Sort">Ordenar</span>
                                <div class="sort-dropdown-wrapper" id="sortDropdownWrapper">
                                    <button class="sort-btn" id="sortBtn" title="Ordenar">
                                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                                            <path d="M7 4v16"></path>
                                            <path d="M7 4l-3 3"></path>
                                            <path d="M7 4l3 3"></path>
                                            <path d="M17 20V4"></path>
                                            <path d="M17 20l-3-3"></path>
                                            <path d="M17 20l3-3"></path>
                                        </svg>
                                    </button>
                                    <div class="sort-dropdown" id="sortDropdown">
                                        <button class="sort-option active" data-sort="recommended" data-es="Recomendado" data-en="Recommended">Recomendado</button>
                                        <button class="sort-option" data-sort="price-asc" data-es="Precio ↑" data-en="Price ↑">Precio ↑</button>
                                        <button class="sort-option" data-sort="price-desc" data-es="Precio ↓" data-en="Price ↓">Precio ↓</button>
                                        <button class="sort-option" data-sort="year-asc" data-es="Año ↑" data-en="Year ↑">Año ↑</button>
                                        <button class="sort-option" data-sort="year-desc" data-es="Año ↓" data-en="Year ↓">Año ↓</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section class="catalog-section">
                <div class="container">
                    <div class="catalog" id="catalog"></div>
                </div>
            </section>
        </div>

        <!-- VEHICLE DETAIL MODAL - GAMMA STYLE -->
        <!-- VEHICLE DETAIL MODAL - 14: Nueva Estructura -->
        <div class="vehicle-detail-modal" id="vehicleDetailModal">
            <div class="vehicle-detail-content">
                <button class="vehicle-modal-close" id="vehicleCloseBtn">×</button>
                
                <div class="vehicle-detail-grid">
                    <!-- 14a: ÁREA IZQUIERDA - GALERÍA -->
                    <div class="vehicle-gallery-section">
                        <!-- Imagen principal 4:3 con navegación lateral -->
                        <div class="vehicle-main-image-container">
                            <img class="vehicle-main-image" id="vehicleMainImage" src="" alt="">
                            <button class="vehicle-image-nav-btn nav-prev" id="vehicleImagePrev">◀</button>
                            <button class="vehicle-image-nav-btn nav-next" id="vehicleImageNext">▶</button>
                        </div>
                        
                        <!-- Carrusel de miniaturas debajo (fuera de imagen) -->
                        <div class="vehicle-thumbnails-wrapper">
                            <div class="vehicle-thumbnails-container" id="vehicleThumbnailsContainer"></div>
                        </div>
                        
                        <!-- Sticky notification naranja debajo de miniaturas, centrado -->
                        <div class="vehicle-sticky-notification" id="vehicleStickyNotification">
                            <span data-es="¿No encuentra lo que busca? Solicítelo aquí" data-en="Can't find it? Request it here">
                                ¿No encuentra lo que busca? Solicítelo aquí
                            </span>
                        </div>
                    </div>

                    <!-- 14b: ÁREA DERECHA - INFORMACIÓN -->
                    <div class="vehicle-info-section">
                        <!-- Botones de acción: Contactar + Favorito + Compartir (misma línea siempre) -->
                        <div class="vehicle-actions-row">
                            <button class="vehicle-pdf-btn" id="vehiclePdfBtn" title="Descargar folleto">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                    <polyline points="14 2 14 8 20 8"></polyline>
                                    <line x1="16" y1="13" x2="8" y2="13"></line>
                                    <line x1="16" y1="17" x2="8" y2="17"></line>
                                    <polyline points="10 9 9 9 8 9"></polyline>
                                </svg>
                                <span data-es="PDF" data-en="PDF">PDF</span>
                            </button>
                            <button class="vehicle-contact-btn" id="vehicleContactBtn">
                                <span data-es="Contactar" data-en="Contact">Contactar</span>
                            </button>
                            <button class="vehicle-icon-btn favorite-btn" id="vehicleFavoriteBtn" title="Favorito">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                                </svg>
                            </button>
                            <button class="vehicle-icon-btn share-btn" id="vehicleShareBtn" title="Compartir">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2"></path>
                                    <polyline points="7 9 12 4 17 9"></polyline>
                                    <line x1="12" y1="4" x2="12" y2="16"></line>
                                </svg>
                            </button>
                        </div>

                        <!-- Título y Precio (misma línea siempre) -->
                        <div class="vehicle-title-price-row">
                            <h1 class="vehicle-title" id="vehicleName"></h1>
                            <div class="vehicle-price" id="vehiclePrice"></div>
                        </div>

                        <!-- Etiqueta (categoría) y Ubicación (misma línea siempre) -->
                        <div class="vehicle-meta-row">
                            <span class="vehicle-category-badge" id="vehicleCategory"></span>
                            <span class="vehicle-location" id="vehicleLocation"></span>
                        </div>

                        <!-- Disclaimer para terceros (si aplica) -->
                        <div id="vehicleDisclaimerContainer"></div>

                        <!-- Características (filas de 3) -->
                        <div class="vehicle-characteristics">
                            <h3 data-es="Características" data-en="Characteristics">Características</h3>
                            <div class="vehicle-char-grid" id="vehicleCharGrid"></div>
                        </div>

                        <!-- Descripción -->
                        <div class="vehicle-description">
                            <h3 data-es="Descripción" data-en="Description">Descripción</h3>
                            <p id="vehicleDescriptionText"></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- CONTACT MODAL -->
        <div class="contact-modal" id="contactModal">
            <div class="contact-modal-content">
                <button class="contact-modal-close" id="contactModalClose">×</button>
                <h2 class="contact-modal-title" data-es="¿Cómo desea contactarnos?" data-en="How would you like to contact us?">¿Cómo desea contactarnos?</h2>
                
                <div class="contact-options">
                    <a href="#" class="contact-option" id="contactEmail">
                        <div class="contact-icon-large">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                                <polyline points="22,6 12,13 2,6"></polyline>
                            </svg>
                        </div>
                        <div class="contact-option-text">
                            <span class="contact-option-title">Email</span>
                            <span class="contact-option-subtitle" id="contactEmailText"></span>
                        </div>
                    </a>
                    
                    <a href="#" class="contact-option" id="contactPhone">
                        <div class="contact-icon-large">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                            </svg>
                        </div>
                        <div class="contact-option-text">
                            <span class="contact-option-title" data-es="Teléfono" data-en="Phone">Teléfono</span>
                            <span class="contact-option-subtitle" id="contactPhoneText"></span>
                        </div>
                    </a>
                    
                    <a href="#" class="contact-option" id="contactWhatsApp">
                        <div class="contact-icon-large">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
                            </svg>
                        </div>
                        <div class="contact-option-text">
                            <span class="contact-option-title">WhatsApp</span>
                            <span class="contact-option-subtitle" id="contactWhatsAppText"></span>
                        </div>
                    </a>
                </div>
            </div>
        </div>

        <!-- ACCOUNT MODAL -->
        <div class="account-modal" id="accountModal">
            <div class="account-modal-content">
                <button class="account-modal-close" id="accountModalClose">×</button>
                <h2 class="account-modal-title" data-es="Accede o Regístrate" data-en="Log In or Register">Accede o Regístrate</h2>
                
                <div class="account-options">
                    <div class="account-option" data-provider="google">
                        <svg width="32" height="32" viewBox="0 0 24 24">
                            <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
                            <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
                            <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/>
                            <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
                        </svg>
                    </div>
                    <div class="account-option" data-provider="apple">
                        <svg width="32" height="32" viewBox="0 0 24 24">
                            <path d="M17.05 20.28c-.98.95-2.05.8-3.08.35-1.09-.46-2.09-.48-3.24 0-1.44.62-2.2.44-3.06-.35C2.79 15.25 3.51 7.59 9.05 7.31c1.35.07 2.29.74 3.08.8 1.18-.24 2.31-.93 3.57-.84 1.51.12 2.65.72 3.4 1.8-3.12 1.87-2.38 5.98.48 7.13-.57 1.5-1.31 2.99-2.54 4.09l.01-.01zM12.03 7.25c-.15-2.23 1.66-4.07 3.74-4.25.29 2.58-2.34 4.5-3.74 4.25z"/>
                        </svg>
                    </div>
                    <div class="account-option" data-provider="microsoft">
                        <svg width="32" height="32" viewBox="0 0 24 24">
                            <path d="M11.4 24H0V12.6h11.4V24zM24 24H12.6V12.6H24V24zM11.4 11.4H0V0h11.4v11.4zm12.6 0H12.6V0H24v11.4z" fill="#0F2A2E"/>
                        </svg>
                    </div>
                    <div class="account-option" data-provider="phone">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke-width="2">
                            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                        </svg>
                    </div>
                    <div class="account-option" data-provider="email">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke-width="2">
                            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                            <polyline points="22,6 12,13 2,6"></polyline>
                        </svg>
                    </div>
                </div>

                <div class="account-divider">
                    <span data-es="o continúa con" data-en="or continue with">o continúa con</span>
                </div>

                <div class="account-input-group" id="accountInputGroup">
                    <input type="text" class="account-input" id="accountInput" placeholder="Teléfono o Email" data-es-placeholder="Teléfono o Email" data-en-placeholder="Phone or Email">
                    <button class="account-btn-submit" id="accountContinueBtn" data-es="Continuar" data-en="Continue">Continuar</button>
                </div>
            </div>
        </div>

        <!-- DEV MODAL -->
        <div class="dev-modal" id="devModal">
            <div class="dev-modal-content">
                <button class="dev-modal-close" id="devModalClose">×</button>
                <h2 class="dev-modal-title" data-es="Función en desarrollo" data-en="Feature in development">Función en desarrollo</h2>
                <p class="dev-modal-text" data-es="Lamentamos las molestias. Déjanos tu email para avisarte cuando esté disponible." data-en="We apologize for the inconvenience. Leave us your email to notify you when it's available.">Lamentamos las molestias. Déjanos tu email para avisarte cuando esté disponible.</p>
                <input type="email" class="dev-modal-input" id="devModalInput" placeholder="Email">
                <button class="dev-modal-btn" id="devModalSubmit" data-es="Enviar" data-en="Submit">Enviar</button>
            </div>
        </div>

        <!-- ADVERTISE MODAL (Iteración 6) -->
        <div class="advertise-modal" id="advertiseModal">
            <div class="advertise-modal-content">
                <button class="advertise-modal-close" id="advertiseModalClose">×</button>
                <h2 class="advertise-modal-title" data-es="Anúnciate con nosotros" data-en="Advertise with us">Anúnciate con nosotros</h2>
                
                <form class="advertise-form" id="advertiseForm">
                    <!-- DATOS PERSONALES -->
                    <div class="form-section">
                        <h3 class="form-section-title" data-es="Datos de contacto" data-en="Contact details">Datos de contacto</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="advertiseName" data-es="Nombre *" data-en="Name *">Nombre *</label>
                                <input type="text" id="advertiseName" required>
                            </div>
                            <div class="form-group">
                                <label for="advertiseEmail" data-es="Email *" data-en="Email *">Email *</label>
                                <input type="email" id="advertiseEmail" required>
                            </div>
                            <div class="form-group">
                                <label for="advertisePhone" data-es="Teléfono *" data-en="Phone *">Teléfono *</label>
                                <input type="tel" id="advertisePhone" required>
                            </div>
                        </div>
                    </div>

                    <!-- DATOS DEL VEHÍCULO -->
                    <div class="form-section">
                        <h3 class="form-section-title" data-es="Datos del vehículo" data-en="Vehicle details">Datos del vehículo</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="advertiseVehicle" data-es="Vehículo *" data-en="Vehicle *">Vehículo *</label>
                                <select id="advertiseVehicle" required>
                                    <option value="" data-es="Seleccione..." data-en="Select...">Seleccione...</option>
                                    <option value="cisterna" data-es="Cisterna" data-en="Tanker">Cisterna</option>
                                    <option value="tractora" data-es="Tractora" data-en="Tractor">Tractora</option>
                                    <option value="rigido" data-es="Rígido" data-en="Rigid">Rígido</option>
                                    <option value="semirremolque" data-es="Semirremolque" data-en="Semi-trailer">Semirremolque</option>
                                    <option value="remolque" data-es="Remolque" data-en="Trailer">Remolque</option>
                                    <option value="otro" data-es="Otro" data-en="Other">Otro</option>
                                </select>
                            </div>
                            
                            <!-- CASILLA CISTERNA (solo para rígidos y remolques) -->
                            <div class="form-group" id="advertiseTankerCheckGroup" style="display: none;">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="advertiseTankerCheck">
                                    <span data-es="Es cisterna" data-en="Is tanker">Es cisterna</span>
                                </label>
                            </div>
                            
                            <!-- TIPO (solo para cisternas) -->
                            <div class="form-group" id="advertiseTipoGroup" style="display: none;">
                                <label for="advertiseTipo" data-es="Tipo *" data-en="Type *">Tipo *</label>
                                <select id="advertiseTipo">
                                    <option value="" data-es="Seleccione..." data-en="Select...">Seleccione...</option>
                                    <option value="alimentaria" data-es="Alimentaria" data-en="Food">Alimentaria</option>
                                    <option value="combustible" data-es="Combustible" data-en="Fuel">Combustible</option>
                                    <option value="quimica" data-es="Química" data-en="Chemical">Química</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="advertiseBrand" data-es="Marca *" data-en="Brand *">Marca *</label>
                                <input type="text" id="advertiseBrand" required>
                            </div>
                            <div class="form-group">
                                <label for="advertiseModel" data-es="Modelo *" data-en="Model *">Modelo *</label>
                                <input type="text" id="advertiseModel" required>
                            </div>
                            <div class="form-group">
                                <label for="advertiseYear" data-es="Año *" data-en="Year *">Año *</label>
                                <input type="number" id="advertiseYear" min="1990" max="2500" required>
                            </div>
                        </div>

                        <!-- CAMPOS CONDICIONALES -->
                        <div class="form-row" id="advertiseConditionalFields">
                            <!-- VOLUMEN (solo cisternas) -->
                            <div class="form-group" id="advertiseVolumeGroup" style="display: none;">
                                <label for="advertiseVolume" data-es="Volumen (L) *" data-en="Volume (L) *">Volumen (L) *</label>
                                <input type="number" id="advertiseVolume" min="0">
                            </div>
                            
                            <!-- COMPARTIMENTOS (solo cisternas) -->
                            <div class="form-group" id="advertiseCompartmentsGroup" style="display: none;">
                                <label for="advertiseCompartments" data-es="Compartimentos" data-en="Compartments">Compartimentos</label>
                                <input type="number" id="advertiseCompartments" min="1">
                            </div>
                            
                            <!-- CAPACIDAD (solo no-cisternas) -->
                            <div class="form-group" id="advertiseCapacityGroup" style="display: none;">
                                <label for="advertiseCapacity" data-es="Capacidad (kg) *" data-en="Capacity (kg) *">Capacidad (kg) *</label>
                                <input type="number" id="advertiseCapacity" min="0">
                            </div>
                            
                            <!-- POTENCIA (solo tractoras) -->
                            <div class="form-group" id="advertisePowerGroup" style="display: none;">
                                <label for="advertisePower" data-es="Potencia (CV) *" data-en="Power (HP) *">Potencia (CV) *</label>
                                <input type="number" id="advertisePower" min="0">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="advertisePrice" data-es="Precio (€) *" data-en="Price (€) *">Precio (€) *</label>
                                <input type="number" id="advertisePrice" min="0" required>
                            </div>
                            <div class="form-group">
                                <label for="advertiseLocation" data-es="Ubicación *" data-en="Location *">Ubicación *</label>
                                <input type="text" id="advertiseLocation" required>
                            </div>
                        </div>

                        <div class="form-group full-width">
                            <label for="advertiseDescription" data-es="Descripción *" data-en="Description *">Descripción *</label>
                            <textarea id="advertiseDescription" rows="3" required></textarea>
                        </div>
                    </div>

                    <!-- FOTOS -->
                    <div class="form-section">
                        <h3 class="form-section-title" data-es="Imágenes" data-en="Images">Imágenes</h3>
                        
                        <!-- FOTOS DEL VEHÍCULO -->
                        <div class="form-group full-width">
                            <label data-es="Fotos del vehículo *" data-en="Vehicle photos *">Fotos del vehículo *</label>
                            <div class="photo-upload-area" id="advertisePhotoUpload">
                                <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
                                    <circle cx="12" cy="13" r="4"></circle>
                                </svg>
                                <p class="upload-text">
                                    <span data-es="Haga clic o arrastre imágenes" data-en="Click or drag images">Haga clic o arrastre imágenes</span><br>
                                    <strong data-es="Obligatorio: Mínimo 3 fotos del vehículo." data-en="Mandatory: Minimum 3 photos of the vehicle.">Obligatorio: Mínimo 3 fotos del vehículo.</strong>
                                </p>
                                <p class="upload-recommendations">
                                    <strong data-es="Recomendaciones para las fotos:" data-en="Photo recommendations:">Recomendaciones para las fotos:</strong><br>
                                    <span data-es="- Vista general en 3/4" data-en="- General 3/4 view">- Vista general en 3/4</span><br>
                                    <span data-es="- Frontal, trasera y ambos laterales" data-en="- Front, rear and both sides">- Frontal, trasera y ambos laterales</span><br>
                                    <span data-es="- Ruedas" data-en="- Wheels">- Ruedas</span><br>
                                    <span data-es="- Interior de la cabina si procede" data-en="- Cabin interior if applicable">- Interior de la cabina si procede</span><br>
                                    <span data-es="- Placa de compartimentos si procede" data-en="- Compartments plate if applicable">- Placa de compartimentos si procede</span>
                                </p>
                                <input type="file" id="advertisePhotos" accept="image/*" multiple required style="display: none;">
                            </div>
                            <div class="photo-preview" id="advertisePhotoPreview"></div>
                        </div>
                        
                        <!-- FICHA TÉCNICA -->
                        <div class="form-group full-width" style="margin-top: 1.5rem;">
                            <label data-es="Ficha técnica *" data-en="Technical sheet *">Ficha técnica *</label>
                            <div class="photo-upload-area" id="advertiseTechSheetUpload">
                                <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                    <polyline points="14 2 14 8 20 8"></polyline>
                                    <line x1="16" y1="13" x2="8" y2="13"></line>
                                    <line x1="16" y1="17" x2="8" y2="17"></line>
                                    <polyline points="10 9 9 9 8 9"></polyline>
                                </svg>
                                <p class="upload-text">
                                    <span data-es="Haga clic o arrastre una imagen" data-en="Click or drag an image">Haga clic o arrastre una imagen</span><br>
                                    <strong data-es="1 foto legible de la ficha técnica" data-en="1 legible photo of technical sheet">1 foto legible de la ficha técnica</strong>
                                </p>
                                <p class="upload-note" style="color: var(--text-auxiliary); font-size: 0.9rem; margin-top: 0.5rem;">
                                    <span data-es="La ficha técnica no se mostrará en los anuncios por motivos de privacidad." data-en="The technical sheet will not be displayed in ads for privacy reasons.">La ficha técnica no se mostrará en los anuncios por motivos de privacidad.</span>
                                </p>
                                <input type="file" id="advertiseTechSheet" accept="image/*" required style="display: none;">
                            </div>
                            <div class="photo-preview" id="advertiseTechSheetPreview"></div>
                        </div>
                    </div>

                    <!-- ACEPTACIÓN Y ENVÍO -->
                    <div class="form-section">
                        <div class="form-group full-width">
                            <label class="checkbox-label">
                                <input type="checkbox" id="advertiseAccept" required>
                                <span data-es="Acepto que Tank Iberica pueda editar las imágenes para proteger mi identidad y cumplir con las funciones de intermediación." data-en="I accept that Tank Iberica can edit the images to protect my identity and comply with intermediation functions.">Acepto que Tank Iberica pueda editar las imágenes para proteger mi identidad y cumplir con las funciones de intermediación.</span>
                            </label>
                        </div>
                        <button type="submit" class="form-submit-btn" data-es="Enviar solicitud" data-en="Submit request">Enviar solicitud</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- DEMAND MODAL (P0-04) -->
        <div class="demand-modal" id="demandModal">
            <div class="demand-modal-content">
                <button class="demand-modal-close" id="demandModalClose">×</button>
                <h2 class="demand-modal-title" data-es="¿No encuentra lo que busca?" data-en="Can't find what you're looking for?">¿No encuentra lo que busca?</h2>
                <p class="demand-modal-subtitle" data-es="Díganos qué necesita y le buscaremos opciones" data-en="Tell us what you need and we'll find options for you">Díganos qué necesita y le buscaremos opciones</p>
                
                <form class="demand-form" id="demandForm">
                    <!-- DATOS DE CONTACTO -->
                    <div class="form-section">
                        <h3 class="form-section-title" data-es="Datos de contacto" data-en="Contact details">Datos de contacto</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="demandName" data-es="Nombre *" data-en="Name *">Nombre *</label>
                                <input type="text" id="demandName" required>
                            </div>
                            <div class="form-group">
                                <label for="demandEmail" data-es="Email *" data-en="Email *">Email *</label>
                                <input type="email" id="demandEmail" required>
                            </div>
                            <div class="form-group">
                                <label for="demandPhone" data-es="Teléfono *" data-en="Phone *">Teléfono *</label>
                                <input type="tel" id="demandPhone" required>
                            </div>
                        </div>
                    </div>

                    <!-- CRITERIOS DE BÚSQUEDA -->
                    <div class="form-section">
                        <h3 class="form-section-title" data-es="¿Qué vehículo busca?" data-en="What vehicle are you looking for?">¿Qué vehículo busca?</h3>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="demandVehicle" data-es="Vehículo *" data-en="Vehicle *">Vehículo *</label>
                                <select id="demandVehicle" required>
                                    <option value="" data-es="Seleccione..." data-en="Select...">Seleccione...</option>
                                    <option value="cisternas" data-es="Cisterna" data-en="Tanker">Cisterna</option>
                                    <option value="tractoras" data-es="Tractora" data-en="Tractor">Tractora</option>
                                    <option value="rigidos" data-es="Rígido" data-en="Rigid">Rígido</option>
                                    <option value="remolques" data-es="Semirremolque" data-en="Semi-trailer">Semirremolque</option>
                                    <option value="remolques_completos" data-es="Remolque" data-en="Trailer">Remolque</option>
                                    <option value="otro" data-es="Otro" data-en="Other">Otro</option>
                                </select>
                            </div>
                            
                            <div class="form-group" id="demandIsCisternGroup" style="display: none;">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="demandIsCistern">
                                    <span data-es="Es cisterna" data-en="Is tanker">Es cisterna</span>
                                </label>
                            </div>
                            
                            <div class="form-group" id="demandCisternTypeGroup" style="display: none;">
                                <label for="demandCisternType" data-es="Tipo *" data-en="Type *">Tipo *</label>
                                <select id="demandCisternType">
                                    <option value="" data-es="Seleccione..." data-en="Select...">Seleccione...</option>
                                    <option value="alimentaria" data-es="Alimentaria" data-en="Food grade">Alimentaria</option>
                                    <option value="combustible" data-es="Combustible" data-en="Fuel">Combustible</option>
                                    <option value="quimica" data-es="Química" data-en="Chemical">Química</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="demandBrand" data-es="Marca" data-en="Brand">Marca</label>
                                <select id="demandBrand">
                                    <option value="" data-es="Cualquiera" data-en="Any">Cualquiera</option>
                                    <option value="scania">Scania</option>
                                    <option value="volvo">Volvo</option>
                                    <option value="mercedes">Mercedes-Benz</option>
                                    <option value="man">MAN</option>
                                    <option value="daf">DAF</option>
                                    <option value="iveco">Iveco</option>
                                    <option value="renault">Renault</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="demandModel" data-es="Modelo" data-en="Model">Modelo</label>
                                <input type="text" id="demandModel" data-es="Opcional" data-en="Optional" placeholder="Opcional">
                            </div>
                        </div>
                    </div>

                    <!-- RANGOS CON SLIDERS -->
                    <div class="form-section">
                        <h3 class="form-section-title" data-es="Rangos de búsqueda" data-en="Search ranges">Rangos de búsqueda</h3>
                        
                        <!-- PRECIO -->
                        <div class="form-group full-width">
                            <label data-es="Precio (€)" data-en="Price (€)">Precio (€)</label>
                            <div class="slider-container">
                                <div class="slider-values">
                                    <span id="demandPriceMinValue">0€</span>
                                    <span>-</span>
                                    <span id="demandPriceMaxValue">200.000€</span>
                                </div>
                                <div class="slider-track">
                                    <input type="range" id="demandPriceMin" class="slider-min" min="0" max="200000" step="1000" value="0">
                                    <input type="range" id="demandPriceMax" class="slider-max" min="0" max="200000" step="1000" value="200000">
                                </div>
                            </div>
                        </div>
                        
                        <!-- AÑO -->
                        <div class="form-group full-width">
                            <label data-es="Año" data-en="Year">Año</label>
                            <div class="slider-container">
                                <div class="slider-values">
                                    <span id="demandYearMinValue">1900</span>
                                    <span>-</span>
                                    <span id="demandYearMaxValue">2026</span>
                                </div>
                                <div class="slider-track">
                                    <input type="range" id="demandYearMin" class="slider-min" min="1900" max="2500" value="2000">
                                    <input type="range" id="demandYearMax" class="slider-max" min="1900" max="2500" value="2026">
                                </div>
                            </div>
                        </div>
                        
                        <!-- VOLUMEN (solo cisternas) -->
                        <div class="form-group full-width conditional-cistern" style="display: none;">
                            <label data-es="Volumen (L)" data-en="Volume (L)">Volumen (L)</label>
                            <div class="slider-container">
                                <div class="slider-values">
                                    <span id="demandVolumeMinValue">0 L</span>
                                    <span>-</span>
                                    <span id="demandVolumeMaxValue">50.000 L</span>
                                </div>
                                <div class="slider-track">
                                    <input type="range" id="demandVolumeMin" class="slider-min" min="0" max="50000" step="1000" value="0">
                                    <input type="range" id="demandVolumeMax" class="slider-max" min="0" max="50000" step="1000" value="50000">
                                </div>
                            </div>
                        </div>
                        
                        <!-- COMPARTIMENTOS (solo cisternas) -->
                        <div class="form-group full-width conditional-cistern" style="display: none;">
                            <label data-es="Compartimentos" data-en="Compartments">Compartimentos</label>
                            <div class="slider-container">
                                <div class="slider-values">
                                    <span id="demandCompartmentsMinValue">1</span>
                                    <span>-</span>
                                    <span id="demandCompartmentsMaxValue">8</span>
                                </div>
                                <div class="slider-track">
                                    <input type="range" id="demandCompartmentsMin" class="slider-min" min="1" max="8" value="1">
                                    <input type="range" id="demandCompartmentsMax" class="slider-max" min="1" max="8" value="8">
                                </div>
                            </div>
                        </div>
                        
                        <!-- CAPACIDAD (solo rígidos) -->
                        <div class="form-group full-width conditional-rigid" style="display: none;">
                            <label data-es="Capacidad (kg)" data-en="Capacity (kg)">Capacidad (kg)</label>
                            <div class="slider-container">
                                <div class="slider-values">
                                    <span id="demandCapacityMinValue">0 kg</span>
                                    <span>-</span>
                                    <span id="demandCapacityMaxValue">30.000 kg</span>
                                </div>
                                <div class="slider-track">
                                    <input type="range" id="demandCapacityMin" class="slider-min" min="0" max="30000" step="500" value="0">
                                    <input type="range" id="demandCapacityMax" class="slider-max" min="0" max="30000" step="500" value="30000">
                                </div>
                            </div>
                        </div>
                        
                        <!-- POTENCIA (tractoras y rígidos) -->
                        <div class="form-group full-width conditional-power" style="display: none;">
                            <label data-es="Potencia (CV)" data-en="Power (HP)">Potencia (CV)</label>
                            <div class="slider-container">
                                <div class="slider-values">
                                    <span id="demandPowerMinValue">0 CV</span>
                                    <span>-</span>
                                    <span id="demandPowerMaxValue">700 CV</span>
                                </div>
                                <div class="slider-track">
                                    <input type="range" id="demandPowerMin" class="slider-min" min="0" max="700" step="10" value="0">
                                    <input type="range" id="demandPowerMax" class="slider-max" min="0" max="700" step="10" value="700">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- FORMAS DE CONTACTO -->
                    <div class="form-section">
                        <h3 class="form-section-title" data-es="¿Cómo prefiere que le contactemos?" data-en="How do you prefer to be contacted?">¿Cómo prefiere que le contactemos?</h3>
                        <div class="contact-methods">
                            <label class="checkbox-label">
                                <input type="checkbox" id="demandContactEmail">
                                <span data-es="Email" data-en="Email">Email</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="demandContactPhone">
                                <span data-es="Teléfono" data-en="Phone">Teléfono</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="demandContactWhatsApp">
                                <span data-es="WhatsApp" data-en="WhatsApp">WhatsApp</span>
                            </label>
                        </div>
                    </div>

                    <!-- ACEPTACIÓN Y ENVÍO -->
                    <div class="form-section">
                        <div class="form-group full-width">
                            <label class="checkbox-label">
                                <input type="checkbox" id="demandAccept" required>
                                <span data-es="Acepto que Tank Iberica se ponga en contacto conmigo cuando tenga vehículos que cumplan mis criterios." data-en="I accept that Tank Iberica contacts me when there are vehicles that meet my criteria.">Acepto que Tank Iberica se ponga en contacto conmigo cuando tenga vehículos que cumplan mis criterios.</span>
                            </label>
                        </div>
                        <button type="submit" class="form-submit-btn" data-es="Buscar vehículo" data-en="Search vehicle">Buscar vehículo</button>
                    </div>
                </form>            </div>
        </div>

        <!-- FAVORITES NOTIFICATION -->
        <div class="favorites-notification" id="favoritesNotification">
            <div class="favorites-notification-content">
                <button class="favorites-notification-close" id="favoritesNotificationClose">×</button>
                <p class="favorites-notification-text" data-es="Funcionalidad exclusiva para miembros registrados." data-en="Functionality exclusive to registered members.">Funcionalidad exclusiva para miembros registrados.</p>
                <button class="favorites-notification-btn" id="favoritesLoginBtn" data-es="Acceda o Regístrese" data-en="Log In or Register">Acceda o Regístrese</button>
            </div>
        </div>

        <!-- NEWS SECTION -->
        <section class="news-section" id="newsSection">
            <div class="container">
                <div class="news-header-top">
                    <button class="news-back-button" id="newsBackButton">&lt;</button>
                    
                    <div class="top-news-bar-wrapper">
                        <button class="scroll-btn scroll-btn-left hidden" id="topNewsScrollLeft">◀</button>
                        <div class="top-news-bar" id="topNewsBar">
                            <div class="top-news-header">
                                <svg class="top-news-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                                    <polyline points="17 6 23 6 23 12"></polyline>
                                </svg>
                                <span class="top-news-title" data-es="Top 3 Noticias" data-en="Top 3 News">Top 3 Noticias</span>
                            </div>
                            <div class="top-news-wrapper" id="topNewsWrapper">
                            <div class="top-news-list" id="topNewsList"></div>
                        </div>
                    </div>
                        <button class="scroll-btn scroll-btn-right hidden" id="topNewsScrollRight">▶</button>
                    </div>
                </div>

                <div class="news-search">
                    <svg class="news-search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="m21 21-4.35-4.35"></path>
                    </svg>
                    <input type="text" id="newsSearchInput" class="news-search-input" placeholder="Buscar por palabras clave" data-es-placeholder="Buscar por palabras clave" data-en-placeholder="Search by keywords">
                </div>

                <div class="news-filters">
                    <label class="news-filter-item">
                        <input type="checkbox" class="news-filter-checkbox" data-filter="press" checked>
                        <span class="news-filter-label" data-es="Área de prensa" data-en="Newsroom">Área de prensa</span>
                    </label>
                    <label class="news-filter-item">
                        <input type="checkbox" class="news-filter-checkbox" data-filter="newsletters" checked>
                        <span class="news-filter-label" data-es="Boletines" data-en="Newsletters">Boletines</span>
                    </label>
                    <label class="news-filter-item">
                        <input type="checkbox" class="news-filter-checkbox" data-filter="featured" checked>
                        <span class="news-filter-label" data-es="Destacados" data-en="Featured">Destacados</span>
                    </label>
                    <label class="news-filter-item">
                        <input type="checkbox" class="news-filter-checkbox" data-filter="events" checked>
                        <span class="news-filter-label" data-es="Eventos" data-en="Events">Eventos</span>
                    </label>
                </div>

                <h2 class="news-section-title" data-es="ÚLTIMAS NOTICIAS" data-en="LATEST NEWS">ÚLTIMAS NOTICIAS</h2>

                <div class="news-grid" id="newsGrid"></div>

                <div class="news-load-more">
                    <button class="load-more-btn" id="loadMoreNewsBtn" data-es="Anteriores" data-en="Previous">Anteriores</button>
                </div>
            </div>
        </section>

        <!-- SOBRE NOSOTROS SECTION -->
        <section class="about-section" id="aboutSection">
            <div class="container">
                <div class="section-header-top">
                    <button class="section-back-button" id="aboutBackButton">&lt;</button>
                    <h2 class="section-title" data-es="Sobre Nosotros" data-en="About Us">Sobre Nosotros</h2>
                </div>
                <div class="section-content-placeholder">
                    <p data-es="Sección en desarrollo" data-en="Section under development">Sección en desarrollo</p>
                </div>
            </div>
        </section>

        <!-- LEGAL SECTION -->
        <section class="legal-section" id="legalSection">
            <div class="container">
                <div class="section-header-top">
                    <button class="section-back-button" id="legalBackButton">&lt;</button>
                    <h2 class="section-title" data-es="Legal" data-en="Legal">Legal</h2>
                </div>
                <div class="section-content-placeholder">
                    <p data-es="Sección en desarrollo" data-en="Section under development">Sección en desarrollo</p>
                </div>
            </div>
        </section>

        <!-- NEWS MODAL -->
        <div class="news-modal" id="newsModal">
            <div class="news-modal-content">
                <button class="news-modal-close" id="newsModalClose">×</button>
                
                <div class="news-modal-image-container">
                    <img class="news-modal-image" id="newsModalImage" src="" alt="News">
                    <div class="news-modal-date" id="newsModalDate"></div>
                    <div class="news-modal-comments-badge">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                        </svg>
                        <span id="newsModalCommentsCount">0</span>
                    </div>
                </div>
                
                <div class="news-modal-body">
                    <h2 class="news-modal-title" id="newsModalTitle"></h2>
                    <p class="news-modal-subtitle" id="newsModalSubtitle"></p>
                    
                    <div class="news-modal-hashtags" id="newsModalHashtags"></div>
                    
                    <div class="news-modal-text" id="newsModalText"></div>
                    
                    <div class="news-modal-actions">
                        <button class="btn-action-news" id="newsModalComment">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                            </svg>
                            <span data-es="Comentar" data-en="Comment">Comentar</span>
                        </button>
                        <button class="btn-action-news" id="newsModalSubscribe">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                                <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                            </svg>
                            <span data-es="Suscribirse" data-en="Subscribe">Suscribirse</span>
                        </button>
                        <button class="btn-action-news" id="newsModalShare">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path>
                                <polyline points="16 6 12 2 8 6"></polyline>
                                <line x1="12" y1="2" x2="12" y2="15"></line>
                            </svg>
                            <span data-es="Compartir" data-en="Share">Compartir</span>
                        </button>
                    </div>
                    
                    <div class="hashtag-view" id="hashtagView">
                        <button class="back-to-comments-btn" id="backToComments">
                            <span>←</span>
                            <span data-es="Volver a comentarios" data-en="Back to comments">Volver a comentarios</span>
                        </button>
                        <h3 class="hashtag-view-title" id="hashtagViewTitle"></h3>
                        
                        <div class="hashtag-section">
                            <h4 class="hashtag-section-title" data-es="Top 10 Más Vistas" data-en="Top 10 Most Viewed">Top 10 Más Vistas</h4>
                            <div class="hashtag-news-list" id="hashtagTopViews"></div>
                        </div>
                        
                        <div class="hashtag-section">
                            <h4 class="hashtag-section-title" data-es="Top 10 Más Recientes" data-en="Top 10 Most Recent">Top 10 Más Recientes</h4>
                            <div class="hashtag-news-list" id="hashtagTopRecent"></div>
                        </div>
                        
                        <div class="hashtag-section">
                            <h4 class="hashtag-section-title" data-es="Top 10 Relacionadas" data-en="Top 10 Related">Top 10 Relacionadas</h4>
                            <div class="hashtag-news-list" id="hashtagTopRelated"></div>
                        </div>
                    </div>
                    
                    <div class="comments-section">
                        <div class="comment-form-container" id="commentFormContainer">
                            <button class="comment-form-close" id="commentFormClose">×</button>
                            <h3 class="comment-form-title" data-es="Deja un comentario" data-en="Leave a comment">Deja un comentario</h3>
                            <p class="comment-form-subtitle" data-es="Tu email no será publicado. Serás notificado si te responden. Todos los campos son obligatorios." data-en="Your email will not be published. You will be notified if someone replies. All fields are required.">Tu email no será publicado. Serás notificado si te responden. Todos los campos son obligatorios.</p>
                            
                            <form id="commentForm">
                                <textarea class="comment-textarea" id="commentText" placeholder="Escribe tu comentario..." data-es-placeholder="Escribe tu comentario..." data-en-placeholder="Write your comment..." required></textarea>
                                <div class="comment-inputs">
                                    <input type="text" class="comment-input" id="commentName" placeholder="Nombre" data-es-placeholder="Nombre" data-en-placeholder="Name" required>
                                    <input type="email" class="comment-input" id="commentEmail" placeholder="Email" required>
                                </div>
                                <input type="hidden" id="commentParentId" value="">
                                <button type="submit" class="comment-submit-btn" data-es="Enviar" data-en="Submit">Enviar</button>
                            </form>
                        </div>
                        
                        <div class="comments-list" id="commentsList"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SUBSCRIBE MODAL -->
        <div class="subscribe-modal" id="subscribeModal">
            <div class="subscribe-modal-content">
                <button class="subscribe-modal-close" id="subscribeModalClose">×</button>
                <h2 class="subscribe-modal-title" data-es="Suscribirse a Notificaciones" data-en="Subscribe to Notifications">Suscribirse a Notificaciones</h2>
                
                <div class="subscribe-options">
                    <label class="subscribe-option">
                        <input type="checkbox" class="subscribe-checkbox" data-category="press" checked>
                        <div class="subscribe-option-text">
                            <div class="subscribe-option-title" data-es="Área de Prensa" data-en="Newsroom">Área de Prensa</div>
                            <div class="subscribe-option-desc" data-es="Noticias corporativas" data-en="Corporate news">Noticias corporativas</div>
                        </div>
                    </label>
                    
                    <label class="subscribe-option">
                        <input type="checkbox" class="subscribe-checkbox" data-category="newsletters" checked>
                        <div class="subscribe-option-text">
                            <div class="subscribe-option-title" data-es="Boletines" data-en="Newsletters">Boletines</div>
                            <div class="subscribe-option-desc" data-es="Noticias sobre cambios en la legalidad o requisitos en los vehículos" data-en="News about changes in legality or vehicle requirements">Noticias sobre cambios en la legalidad o requisitos en los vehículos</div>
                        </div>
                    </label>
                    
                    <label class="subscribe-option">
                        <input type="checkbox" class="subscribe-checkbox" data-category="featured" checked>
                        <div class="subscribe-option-text">
                            <div class="subscribe-option-title" data-es="Destacados" data-en="Featured">Destacados</div>
                            <div class="subscribe-option-desc" data-es="Nuevos productos" data-en="New products">Nuevos productos</div>
                        </div>
                    </label>
                    
                    <label class="subscribe-option">
                        <input type="checkbox" class="subscribe-checkbox" data-category="events" checked>
                        <div class="subscribe-option-text">
                            <div class="subscribe-option-title" data-es="Eventos" data-en="Events">Eventos</div>
                            <div class="subscribe-option-desc" data-es="Relacionados con la industria" data-en="Related to the industry">Relacionados con la industria</div>
                        </div>
                    </label>
                </div>
                
                <input type="email" class="subscribe-email-input" id="subscribeEmailInput" placeholder="Email" required>
                <button class="subscribe-btn" id="subscribeSubmitBtn" data-es="Suscribirse" data-en="Subscribe">Suscribirse</button>
            </div>
        </div>
    </main>

    <!-- FOOTER -->
    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3><a href="#" class="footer-news-link" data-filter="all" data-es="Comunicación" data-en="Communications">Comunicación</a></h3>
                <div class="footer-links">
                    <a href="#" class="footer-news-link" data-filter="press" data-es="Área de prensa" data-en="Newsroom">Área de prensa</a>
                    <a href="#" class="footer-news-link" data-filter="newsletters" data-es="Boletines" data-en="Newsletters">Boletines</a>
                    <a href="#" class="footer-news-link" data-filter="featured" data-es="Destacados" data-en="Featured">Destacados</a>
                    <a href="#" class="footer-news-link" data-filter="events" data-es="Eventos" data-en="Events">Eventos</a>
                </div>
            </div>
            
            <div class="footer-section">
                <h3 data-es="Sobre Nosotros" data-en="About Us">
                    <a href="#" id="footerAboutLink" style="color: inherit; text-decoration: none;">Sobre Nosotros</a>
                </h3>
                <div class="footer-links">
                    <a href="#" class="footer-about-link" data-es="Quiénes Somos" data-en="Who We Are">Quiénes Somos</a>
                    <a href="#" class="footer-about-link" data-es="Nuestra Misión" data-en="Our Mission">Nuestra Misión</a>
                    <a href="#" class="footer-about-link" data-es="Equipo" data-en="Team">Equipo</a>
                </div>
            </div>
            
            <div class="footer-section">
                <h3 data-es="Legal" data-en="Legal">
                    <a href="#" id="footerLegalLink" style="color: inherit; text-decoration: none;">Legal</a>
                </h3>
                <div class="footer-links">
                    <a href="#" class="footer-legal-link" data-es="Términos y Condiciones" data-en="Terms and Conditions">Términos y Condiciones</a>
                    <a href="#" class="footer-legal-link" data-es="Política de Privacidad" data-en="Privacy Policy">Política de Privacidad</a>
                    <a href="#" class="footer-legal-link" data-es="Política de Cookies" data-en="Cookie Policy">Política de Cookies</a>
                </div>
            </div>
        </div>
        
        <div class="footer-kit-digital">
            <img src="https://lh3.googleusercontent.com/d/13QhArniHSTlOWD1WmODl3b_AqwKhRGqY" alt="Tank Iberica">
        </div>
        
        <div class="footer-bottom">
            <p>&copy; 2026 Tank Iberica. <span data-es="Todos los derechos reservados." data-en="All rights reserved.">Todos los derechos reservados.</span></p>
        </div>
    </footer>

    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script>
<script>
// ============================================
        // INICIALIZACIÓN DE VARIABLES GLOBALES
        // ============================================
        // Estas variables se llenarán desde Google Sheets en el segundo script
        window.subcategoriasFromSheets = window.subcategoriasFromSheets || [];
        window.filtrosFromSheets = window.filtrosFromSheets || [];
        
        // ============================================
        // UTILIDADES DE FORMATO
        // ============================================
        
        /**
         * Formatea números con separador de miles (punto)
         * @param {number|string} value - Número a formatear
         * @param {boolean} isYear - Si es true, no aplica separador (para años)
         * @returns {string} Número formateado
         * 
         * Ejemplos:
         * formatNumber(1000) → "1.000"
         * formatNumber(28500) → "28.500"
         * formatNumber(2022, true) → "2022"
         * formatNumber("15000 L") → "15.000" (limpia símbolos)
         */
        function formatNumber(value, isYear = false, useCompactOnMobile = false) {
            // Manejar valores vacíos o inválidos
            if (value === null || value === undefined || value === '') {
                return '';
            }
            
            // Si viene como string, limpiar símbolos (€, L, Kgs, etc.) y separadores
            let cleanValue = value;
            if (typeof value === 'string') {
                cleanValue = value.replace(/[^\d.-]/g, '');
            }
            
            // Convertir a número
            const num = typeof cleanValue === 'string' ? parseFloat(cleanValue) : cleanValue;
            
            // Si no es un número válido, devolver original
            if (isNaN(num)) {
                return value;
            }
            
            // 0a: Si es año, devolver sin separador
            if (isYear) {
                return Math.round(num).toString();
            }
            
            // 0c: Formato compacto con K para inglés en móvil
            const isMobile = window.innerWidth <= 768;
            if (useCompactOnMobile && isMobile && currentLang === 'en' && num >= 1000) {
                const compact = num / 1000;
                return compact % 1 === 0 ? compact + 'k' : compact.toFixed(1) + 'k';
            }
            
            // Separar parte entera y decimal
            const parts = num.toString().split('.');
            const integerPart = parts[0];
            const decimalPart = parts[1];
            
            // 0a: Aplicar separador de miles (PUNTO) a la parte entera
            const formattedInteger = integerPart.replace(/\B(?=(\d{3})+(?!\d))/g, '.');
            
            // Si tiene decimales, mantenerlos con coma
            if (decimalPart !== undefined) {
                return formattedInteger + ',' + decimalPart;
            }
            
            return formattedInteger;
        }
        
        // ============================================
        // VARIABLES GLOBALES Y CONFIGURACIÓN
        // ============================================
        const translations = {
            es: {
                phone: '+34 645 779 594',
                whatsapp: '34645779594',
                email: 'info@tankiberica.com',
                searchPlaceholder: 'Busca por palabras clave',
                disclaimer: '(Producto de intermediación no comercializado directamente por Tank Iberica)'
            },
            en: {
                phone: '+44 0752 2525 233',
                whatsapp: '447522525233',
                email: 'admin@tankiberica.com',
                searchPlaceholder: 'Search by keywords',
                disclaimer: '(Intermediary product not directly marketed by Tank Iberica)'
            }
        };

        let currentLang = 'es';

        // Función para sanitizar nombres para usar como selectores CSS
        function sanitizeName(name) {
            if (!name) return '';
            return name.toString()
                .toLowerCase()
                .normalize('NFD').replace(/[̀-ͯ]/g, '') // Quitar acentos
                .replace(/[^a-z0-9]/g, '_') // Reemplazar caracteres especiales por _
                .replace(/_+/g, '_') // Múltiples _ por uno solo
                .replace(/^_|_$/g, ''); // Quitar _ al inicio/final
        }

        let activeCategories = new Set();
        let activeSubcategory = null;
        let activeNewsFilters = ['press', 'newsletters', 'featured', 'events'];
        let selectedProduct = null;
        let selectedNews = null;
        let isUserLoggedIn = false;
        let userFavorites = new Set();
        let currentView = 'thumbnails';
        let currentSortColumn = null;
        let currentSortDirection = 'asc';
        let currentDisplayedProducts = [];
        let menuVisible = true;
        let showOnlyFavorites = false;
        let currentFilters = {
            priceMin: 0,
            priceMax: 1000000,  // Aumentado temporalmente para debug
            brand: '',
            yearMin: 1900,
            yearMax: 2500,  // Actualizado a 2026
            searchText: '',
            sortBy: 'recommended',
            favoritesOnly: false  // 5c: Filtro de favoritos
        };
        let currentNewsComments = [];
        let commentIdCounter = 1;
        let currentVehicleImageIndex = 0;

        // ============================================
        // DATOS DE MUESTRA
        // ============================================

        // Array de productos - se llena desde Google Sheets
        const sampleProducts = [];

        // Array de noticias - se llena desde Google Sheets
        const sampleNews = [];

        // ============================================
        // FUNCIONES AUXILIARES
        // ============================================
        function updateHeaderLinks() {
            document.getElementById('emailIcon').href = `mailto:${translations[currentLang].email}`;
            document.getElementById('phoneIcon').href = `tel:${translations[currentLang].phone.replace(/\s/g, '')}`;
            document.getElementById('whatsapp-link').href = `https://wa.me/${translations[currentLang].whatsapp}`;
            
            document.getElementById('contactEmailText').textContent = translations[currentLang].email;
            document.getElementById('contactPhoneText').textContent = translations[currentLang].phone;
            document.getElementById('contactWhatsAppText').textContent = translations[currentLang].phone;
            
            document.getElementById('contactEmail').href = `mailto:${translations[currentLang].email}`;
            document.getElementById('contactPhone').href = `tel:${translations[currentLang].phone.replace(/\s/g, '')}`;
            document.getElementById('contactWhatsApp').href = `https://wa.me/${translations[currentLang].whatsapp}`;
        }

        function switchLanguage(lang) {
            currentLang = lang;
            updateHeaderLinks();
            
            // Actualizar selector de idioma DESKTOP
            document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
            document.querySelector(`.lang-btn[data-lang="${lang}"]`)?.classList.add('active');
            
            // Actualizar selector de idioma móvil
            const mobileLangFlag = document.getElementById('mobileLangFlag');
            const mobileLangAlt = document.getElementById('mobileLangAlt');
            if (mobileLangFlag && mobileLangAlt) {
                mobileLangFlag.src = lang === 'es' ? 'https://flagcdn.com/w40/es.png' : 'https://flagcdn.com/w40/gb.png';
                mobileLangFlag.alt = lang.toUpperCase();
                const otherLang = lang === 'es' ? 'en' : 'es';
                mobileLangAlt.dataset.lang = otherLang;
                mobileLangAlt.querySelector('img').src = otherLang === 'es' ? 'https://flagcdn.com/w40/es.png' : 'https://flagcdn.com/w40/gb.png';
                mobileLangAlt.querySelector('img').alt = otherLang.toUpperCase();
            }
            
            document.querySelectorAll('[data-es][data-en]').forEach(el => {
                if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
                    if (el.hasAttribute(`data-${lang}-placeholder`)) {
                        el.placeholder = el.getAttribute(`data-${lang}-placeholder`);
                    }
                } else if (el.tagName === 'OPTION') {
                    el.textContent = el.getAttribute(`data-${lang}`);
                } else {
                    el.textContent = el.getAttribute(`data-${lang}`);
                }
            });
            
            filterAndRenderProducts();
            renderNews();
        }
        
        // Funciones para menús móviles
        function toggleLangMenu(e) {
            e.stopPropagation();
            const menu = document.getElementById('mobileLangMenu');
            menu.classList.toggle('active');
        }
        
        function setLang(lang) {
            document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
            document.querySelector(`.lang-btn[data-lang="${lang}"]`)?.classList.add('active');
            document.getElementById('mobileLangMenu')?.classList.remove('active');
            switchLanguage(lang);
        }

        function generateProductTitle(product) {
            const parts = [];
            
            // 1. Subcategoría (nombre legible)
            if (product.subcategory) {
                const subcatName = getSubcategoryName(product.subcategory);
                if (subcatName) parts.push(subcatName);
            }
            
            // 2. Tipo o Clase desde filtros_json
            if (product.filtros_json) {
                const tipoRaw = product.filtros_json.tipo || product.filtros_json.Tipo || 
                            product.filtros_json.clase || product.filtros_json.Clase || '';
                const tipo = getFiltroValue(tipoRaw);
                if (tipo) parts.push(tipo);
            }
            
            // 3. Marca
            const brand = (product.brand || '').trim();
            if (brand) parts.push(brand);
            
            // 4. Año entre paréntesis
            const year = product.year || '';
            
            let title = parts.join(' ');
            if (year) title += ' (' + year + ')';
            
            return title || (currentLang === 'es' ? 'Vehículo' : 'Vehicle');
        }

        // Función para obtener valor de filtro según idioma
        // Soporta formato antiguo (string) y nuevo ({ es: "...", en: "..." })
        function getFiltroValue(value) {
            if (!value) return '';
            if (typeof value === 'object' && value !== null) {
                // Formato nuevo bilingüe
                return currentLang === 'en' ? (value.en || value.EN || value.es || value.ES || '') : (value.es || value.ES || value.en || value.EN || '');
            }
            // Formato antiguo (string)
            return String(value);
        }

        function getSubcategoryName(subcategory) {
            if (!subcategory) return '';
            
            const subcatLower = subcategory.toLowerCase();
            
            // Primero buscar en subcategorías cargadas de Sheets
            if (window.subcategoriasFromSheets && window.subcategoriasFromSheets.length > 0) {
                const found = window.subcategoriasFromSheets.find(s => 
                    (s.nombre || '').toLowerCase() === subcatLower
                );
                if (found) {
                    return currentLang === 'en' && found.nombre_en ? found.nombre_en : found.nombre;
                }
            }
            
            // Fallback a nombres hardcodeados
            const names = {
                cisternas: { es: 'Cisterna', en: 'Tanker' },
                tractoras: { es: 'Tractora', en: 'Truck Tractor' },
                rigidos: { es: 'Rígido', en: 'Rigid Truck' },
                semirremolques: { es: 'Semirremolque', en: 'Semi-trailer' },
                remolques: { es: 'Remolque', en: 'Trailer' },
                otros: { es: 'Otro', en: 'Other' }
            };
            return names[subcatLower] ? names[subcatLower][currentLang] : subcategory;
        }

        // ============================================
        // SCROLL LATERAL PARA CATEGORÍAS/SUBCATEGORÍAS/FILTROS
        // ============================================
        function setupHorizontalScroll(wrapperId, containerId, leftBtnId, rightBtnId) {
            const wrapper = document.getElementById(wrapperId);
            const container = document.getElementById(containerId);
            const leftBtn = document.getElementById(leftBtnId);
            const rightBtn = document.getElementById(rightBtnId);
            
            if (!wrapper || !container || !leftBtn || !rightBtn) return;

            let isDown = false;
            let startX;
            let scrollLeft;

            // Drag to scroll
            wrapper.addEventListener('mousedown', (e) => {
                isDown = true;
                startX = e.pageX - wrapper.offsetLeft;
                scrollLeft = wrapper.scrollLeft;
            });

            wrapper.addEventListener('mouseleave', () => {
                isDown = false;
            });

            wrapper.addEventListener('mouseup', () => {
                isDown = false;
            });

            wrapper.addEventListener('mousemove', (e) => {
                if (!isDown) return;
                e.preventDefault();
                const x = e.pageX - wrapper.offsetLeft;
                const walk = (x - startX) * 2;
                wrapper.scrollLeft = scrollLeft - walk;
            });

            // Button navigation
            leftBtn.addEventListener('click', () => {
                wrapper.scrollBy({ left: -200, behavior: 'smooth' });
            });

            rightBtn.addEventListener('click', () => {
                wrapper.scrollBy({ left: 200, behavior: 'smooth' });
            });

            // Show/hide buttons based on scroll position
            function updateScrollButtons() {
                const maxScroll = wrapper.scrollWidth - wrapper.clientWidth;
                
                if (wrapper.scrollLeft <= 0) {
                    leftBtn.classList.add('hidden');
                } else {
                    leftBtn.classList.remove('hidden');
                }
                
                if (wrapper.scrollLeft >= maxScroll - 1) {
                    rightBtn.classList.add('hidden');
                } else {
                    rightBtn.classList.remove('hidden');
                }
            }

            wrapper.addEventListener('scroll', updateScrollButtons);
            window.addEventListener('resize', updateScrollButtons);
            updateScrollButtons();
        }

        setupHorizontalScroll('categoriesWrapper', 'categoriesContainer', 'categoriesScrollLeft', 'categoriesScrollRight');
        setupHorizontalScroll('subcategoriesWrapper', 'subcategoriesContainer', 'subcategoriesScrollLeft', 'subcategoriesScrollRight');
        setupHorizontalScroll('filtersWrapper', 'filtersWrapper', 'filtersScrollLeft', 'filtersScrollRight');
        setupHorizontalScroll('topNewsBar', 'topNewsWrapper', 'topNewsScrollLeft', 'topNewsScrollRight');

        // ============================================
        // BANNER
        // ============================================
        // Los listeners del banner se manejan en initBannerDinamico()
        // ya que el contenido se genera dinámicamente

        // Banner visibility se maneja en initBannerDinamico()

        // ============================================
        // HEADER SCROLL
        // ============================================
        window.addEventListener('scroll', () => {
            const header = document.getElementById('header');
            if (window.scrollY > 30) {
                header.classList.add('scrolled');
            } else {
                header.classList.remove('scrolled');
            }
        });

        // ============================================
        // LANGUAGE SWITCH
        // ============================================
        document.querySelectorAll('.lang-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                switchLanguage(btn.dataset.lang);
            });
        });

        // ============================================
        // LOGO NAVIGATION
        // ============================================
        document.getElementById('logoBtn').addEventListener('click', () => {
            // Ocultar secciones activas
            document.getElementById('newsSection').classList.remove('active');
            
            // Resetear categorías
            document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('active'));
            activeCategories.clear();
            
            // Resetear subcategoría
            activeSubcategory = null;
            document.querySelectorAll('.subcategory-btn').forEach(btn => btn.classList.remove('active'));
            
            // Resetear filtros a valores por defecto
            currentFilters.priceMin = 0;
            currentFilters.priceMax = 1000000;
            currentFilters.brand = '';
            currentFilters.yearMin = 1900;
            currentFilters.yearMax = 2500;
            
            // Resetear elementos UI de filtros
            const brandFilter = document.getElementById('brandFilter');
            if (brandFilter) brandFilter.value = '';
            
            // Actualizar filtros con vehículos visibles (todos)
            updateAdvancedFilters();
            
            // Re-renderizar
            filterAndRenderProducts();
            
            // Scroll al inicio
            window.scrollTo(0, 0);
            
            console.log('🔄 Todo reseteado desde logo');
        });

        // ============================================
        // ACCOUNT MODALS
        // ============================================
        // CÓDIGO VIEJO COMENTADO - Ahora usa auth-system.js
        /*
        document.getElementById('accountBtn').addEventListener('click', () => {
            document.getElementById('accountModal').classList.add('active');
        });

        document.getElementById('accountModalClose').addEventListener('click', () => {
            document.getElementById('accountModal').classList.remove('active');
            document.getElementById('accountInputGroup').classList.remove('active');
            // 13c: Ocultar línea divisoria
            document.querySelector('.account-divider').classList.remove('active');
        });
        
        // 12a: Click en backdrop cierra modal
        document.getElementById('accountModal').addEventListener('click', (e) => {
            if (e.target.id === 'accountModal') {
                document.getElementById('accountModal').classList.remove('active');
                document.getElementById('accountInputGroup').classList.remove('active');
                // 13c: Ocultar línea divisoria
                document.querySelector('.account-divider').classList.remove('active');
            }
        });

        document.querySelectorAll('.account-option').forEach(option => {
            option.addEventListener('click', () => {
                const provider = option.dataset.provider;
                
                if (provider === 'phone' || provider === 'email') {
                    // 13c: Mostrar línea divisoria y formulario
                    document.querySelector('.account-divider').classList.add('active');
                    document.getElementById('accountInputGroup').classList.add('active');
                    
                    // Actualizar placeholder según el método
                    const input = document.getElementById('accountInput');
                    if (provider === 'email') {
                        input.placeholder = currentLang === 'es' ? 'Email' : 'Email';
                        input.type = 'email';
                    } else {
                        input.placeholder = currentLang === 'es' ? 'Teléfono' : 'Phone';
                        input.type = 'tel';
                    }
                } else {
                    document.getElementById('accountModal').classList.remove('active');
                    document.getElementById('devModal').classList.add('active');
                }
            });
        });

        document.getElementById('accountContinueBtn').addEventListener('click', () => {
            const inputValue = document.getElementById('accountInput').value;
            if (inputValue) {
                document.getElementById('accountModal').classList.remove('active');
                document.getElementById('devModal').classList.add('active');
            }
        });
        */

        document.getElementById('devModalClose').addEventListener('click', () => {
            document.getElementById('devModal').classList.remove('active');
        });
        
        // 12a: Click en backdrop cierra modal
        document.getElementById('devModal').addEventListener('click', (e) => {
            if (e.target.id === 'devModal') {
                document.getElementById('devModal').classList.remove('active');
            }
        });

        document.getElementById('devModalSubmit').addEventListener('click', () => {
            const emailInput = document.getElementById('devModalInput');
            if (emailInput.value) {
                alert(currentLang === 'es' ? 
                    '¡Gracias! Te avisaremos cuando esté disponible.' : 
                    'Thank you! We will notify you when it\'s available.');
                document.getElementById('devModal').classList.remove('active');
                emailInput.value = '';
            }
        });

        // ============================================
        // FAVORITES
        // ============================================
        document.getElementById('favoritesNotificationClose').addEventListener('click', () => {
            document.getElementById('favoritesNotification').classList.remove('active');
        });

        document.getElementById('favoritesLoginBtn').addEventListener('click', () => {
            document.getElementById('favoritesNotification').classList.remove('active');
            // Abrir modal de autenticación
            if (typeof abrirModalAuth === 'function') {
                abrirModalAuth();
            } else {
                document.getElementById('authModal').classList.add('active');
            }
        });

        // ============================================
        // CATEGORIES
        // ============================================
        document.querySelectorAll('.category-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const category = btn.dataset.category;
                
                if (category === 'anunciate') {
                    document.getElementById('advertiseModal').classList.add('active');
                    document.body.style.overflow = 'hidden';
                    return;
                }
                
                if (activeCategories.has(category)) {
                    activeCategories.delete(category);
                    btn.classList.remove('active');
                } else {
                    activeCategories.add(category);
                    btn.classList.add('active');
                }
                
                updateSubcategories();
                updateAdvancedFilters();
                filterAndRenderProducts();
            });
        });

        // ============================================
        // SUBCATEGORIES - Solo una a la vez
        // ============================================
        document.querySelectorAll('.subcategory-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                if (btn.classList.contains('disabled')) return;
                
                const subcategory = btn.dataset.subcategory;
                
                if (activeSubcategory === subcategory) {
                    activeSubcategory = null;
                    btn.classList.remove('active');
                } else {
                    document.querySelectorAll('.subcategory-btn').forEach(b => b.classList.remove('active'));
                    activeSubcategory = subcategory;
                    btn.classList.add('active');
                }
                
                updateAdvancedFilters();
                filterAndRenderProducts();
            });
        });

        function updateSubcategories() {
            const subcategoryBtns = document.querySelectorAll('.subcategory-btn');
            
            if (activeCategories.size === 0) {
                subcategoryBtns.forEach(btn => {
                    btn.classList.remove('disabled');
                });
                updateAdvancedFilters();
                return;
            }
            
            const availableSubcategories = new Set();
            sampleProducts.forEach(product => {
                // Verificar si alguna categoría del producto está activa
                const productCategories = product.categories && product.categories.length > 0 ? product.categories : [product.category];
                const matchesCategory = productCategories.some(cat => activeCategories.has(cat));
                if (matchesCategory) {
                    availableSubcategories.add(product.subcategory);
                }
            });
            
            subcategoryBtns.forEach(btn => {
                const subcategory = btn.dataset.subcategory;
                if (availableSubcategories.has(subcategory)) {
                    btn.classList.remove('disabled');
                } else {
                    btn.classList.add('disabled');
                    if (activeSubcategory === subcategory) {
                        btn.classList.remove('active');
                        activeSubcategory = null;
                    }
                }
            });
            
            updateAdvancedFilters();
        }

        // ============================================
        // ADVANCED FILTERS
        // ============================================
        // ============================================
        function updateAdvancedFilters() {
            const advancedFiltersContainer = document.getElementById('advancedFilters');
            advancedFiltersContainer.innerHTML = '';
            
            // Obtener vehiculos visibles (filtrados por categoria y subcategoria SOLAMENTE)
            let vehiculosVisibles = sampleProducts.filter(p => {
                if (activeCategories.size > 0) {
                    // Verificar si alguna categoría del producto está activa
                    const productCategories = p.categories && p.categories.length > 0 ? p.categories : [p.category];
                    if (!productCategories.some(cat => activeCategories.has(cat))) return false;
                }
                if (activeSubcategory && (p.subcategory || '').toLowerCase() !== activeSubcategory.toLowerCase()) return false;
                return true;
            });
            
            console.log('Vehiculos visibles para filtros:', vehiculosVisibles.length);
            
            if (vehiculosVisibles.length === 0) return;
            
            // ========================================
            // RESETEAR FILTROS ESTATICOS (Precio, Marca, Año)
            // ========================================
            
            // PRECIO - resetear a min/max de vehiculos visibles
            // Usar price_rent cuando se filtra solo por alquiler
            const soloAlquilerFiltro = activeCategories.size === 1 && activeCategories.has('alquiler');
            const vehiculosConPrecio = vehiculosVisibles.filter(v => {
                if (v.category === 'terceros' || v.categories?.includes('terceros')) return false;
                if (soloAlquilerFiltro) {
                    return (v.price_rent && v.price_rent > 0) || (v.price && v.price > 0);
                }
                return v.price > 0;
            });
            const priceMinSlider = document.getElementById('priceMin');
            const priceMaxSlider = document.getElementById('priceMax');
            const priceMinValue = document.getElementById('priceMinValue');
            const priceMaxValue = document.getElementById('priceMaxValue');
            
            if (priceMinSlider && priceMaxSlider && vehiculosConPrecio.length > 0) {
                // Usar precio correcto según filtro
                const precios = vehiculosConPrecio.map(v => {
                    if (soloAlquilerFiltro) {
                        return v.price_rent && v.price_rent > 0 ? v.price_rent : v.price;
                    }
                    return v.price;
                }).filter(p => p > 0);
                const precioMin = Math.min(...precios);
                const precioMax = Math.max(...precios);
                
                // Sufijo según tipo
                const precioSufijo = soloAlquilerFiltro ? '€/mes' : '€';
                
                // Resetear sliders completamente
                priceMinSlider.min = precioMin;
                priceMinSlider.max = precioMax;
                priceMinSlider.value = precioMin;
                
                priceMaxSlider.min = precioMin;
                priceMaxSlider.max = precioMax;
                priceMaxSlider.value = precioMax;
                
                priceMinValue.textContent = formatNumber(precioMin) + precioSufijo;
                priceMaxValue.textContent = formatNumber(precioMax) + precioSufijo;
                
                currentFilters.priceMin = precioMin;
                currentFilters.priceMax = precioMax;
                
                console.log('Precio reseteado:', precioMin, '-', precioMax);
            } else if (priceMinSlider && priceMaxSlider) {
                priceMinSlider.min = 0;
                priceMinSlider.max = 1000000;
                priceMinSlider.value = 0;
                priceMaxSlider.min = 0;
                priceMaxSlider.max = 1000000;
                priceMaxSlider.value = 1000000;
                priceMinValue.textContent = '0€';
                priceMaxValue.textContent = '1.000.000€';
                currentFilters.priceMin = 0;
                currentFilters.priceMax = 1000000;
            }
            
            // MARCA - mostrar solo marcas de vehiculos visibles, resetear seleccion
            const marcasVisibles = [...new Set(vehiculosVisibles.map(v => (v.brand || '').toLowerCase()).filter(Boolean))];
            const brandFilter = document.getElementById('brandFilter');
            
            if (brandFilter) {
                brandFilter.innerHTML = '<option value="" data-es="Todas" data-en="All">' + (currentLang === 'en' ? 'All' : 'Todas') + '</option>';
                marcasVisibles.sort().forEach(marca => {
                    const option = document.createElement('option');
                    option.value = marca;
                    option.textContent = marca.charAt(0).toUpperCase() + marca.slice(1);
                    brandFilter.appendChild(option);
                });
                brandFilter.value = '';
                currentFilters.brand = '';
                
                console.log('Marcas reseteadas:', marcasVisibles);
            }
            
            // AÑO - resetear a min/max de vehiculos visibles
            const years = vehiculosVisibles.map(v => v.year).filter(y => y > 1900 && y < 2500);
            const yearMinSlider = document.getElementById('yearMin');
            const yearMaxSlider = document.getElementById('yearMax');
            const yearMinValue = document.getElementById('yearMinValue');
            const yearMaxValue = document.getElementById('yearMaxValue');
            
            if (yearMinSlider && yearMaxSlider && years.length > 0) {
                const yearMin = Math.min(...years);
                const yearMax = Math.max(...years);
                
                yearMinSlider.min = yearMin;
                yearMinSlider.max = yearMax;
                yearMinSlider.value = yearMin;
                
                yearMaxSlider.min = yearMin;
                yearMaxSlider.max = yearMax;
                yearMaxSlider.value = yearMax;
                
                yearMinValue.textContent = yearMin;
                yearMaxValue.textContent = yearMax;
                
                currentFilters.yearMin = yearMin;
                currentFilters.yearMax = yearMax;
                
                console.log('Año reseteado:', yearMin, '-', yearMax);
            } else if (yearMinSlider && yearMaxSlider) {
                yearMinSlider.min = 1900;
                yearMinSlider.max = 2500;
                yearMinSlider.value = 1900;
                yearMaxSlider.min = 1900;
                yearMaxSlider.max = 2500;
                yearMaxSlider.value = 2500;
                yearMinValue.textContent = '1900';
                yearMaxValue.textContent = '2500';
                currentFilters.yearMin = 1900;
                currentFilters.yearMax = 2500;
            }
            
            // ========================================
            // FILTROS DINAMICOS DE SHEETS
            // ========================================
            if (!window.filtrosFromSheets || window.filtrosFromSheets.length === 0) {
                console.log('No hay filtros de Sheets cargados');
                return;
            }
            
            // Calcular filtros que TODOS los vehiculos visibles tienen (minimo comun)
            const filtrosComunes = [];
            
            window.filtrosFromSheets.forEach(filtro => {
                // filtrosFromSheets ya contiene solo los publicados, no verificar de nuevo
                const nombreFiltro = (filtro.nombre || '').toLowerCase();
                
                const todosTienen = vehiculosVisibles.every(v => {
                    if (!v.filtros_json || typeof v.filtros_json !== 'object') return false;
                    const keys = Object.keys(v.filtros_json).map(k => k.toLowerCase());
                    return keys.includes(nombreFiltro);
                });
                
                console.log('Filtro "' + filtro.nombre + '": ' + (todosTienen ? 'todos tienen' : 'no todos tienen'));
                
                if (todosTienen) {
                    filtrosComunes.push(filtro);
                }
            });
            
            console.log('Filtros comunes:', filtrosComunes.map(f => f.nombre));
            
            if (filtrosComunes.length > 0) {
                renderFiltrosDinamicos(filtrosComunes);
                switchLanguage(currentLang);
            }
        }

        // Renderizar filtros dinámicos desde Sheets
        function renderFiltrosDinamicos(filtros) {
            const container = document.getElementById('advancedFilters');
            
            // Calcular qué filtros deben ocultarse basándose en ticks activos
            const filtrosAOcultar = new Set();
            filtros.forEach(f => {
                if (f.tipo === 'tick' && f.ocultar_filtros) {
                    const nombreLower = sanitizeName(f.nombre);
                    const tickEl = document.getElementById('filtro_' + nombreLower);
                    if (tickEl && tickEl.checked) {
                        // Este tick está activo, ocultar los filtros especificados
                        const ocultarList = f.ocultar_filtros.split(',').map(x => x.trim()).filter(x => x);
                        ocultarList.forEach(nombre => filtrosAOcultar.add(nombre.toLowerCase()));
                    }
                }
            });
            
            // Obtener vehículos actualmente visibles (después de todos los filtros excepto los dinámicos)
            const vehiculosFiltrados = sampleProducts.filter(p => {
                // Filtro por categorías - verificar si alguna categoría del producto está activa
                if (activeCategories.size > 0) {
                    const productCategories = p.categories && p.categories.length > 0 ? p.categories : [p.category];
                    if (!productCategories.some(cat => activeCategories.has(cat))) return false;
                }
                // Filtro por subcategoría
                if (activeSubcategory && (p.subcategory || '').toLowerCase() !== activeSubcategory.toLowerCase()) return false;
                // Filtro por precio
                if (p.category !== 'terceros') {
                    if (p.price < currentFilters.priceMin || p.price > currentFilters.priceMax) return false;
                }
                // Filtro por marca
                if (currentFilters.brand && p.brand !== currentFilters.brand) return false;
                // Filtro por año
                if (p.year < currentFilters.yearMin || p.year > currentFilters.yearMax) return false;
                return true;
            });
            
            if (vehiculosFiltrados.length === 0) return;
            
            filtros.forEach(filtro => {
                const nombre = filtro.nombre || '';
                
                // Si este filtro debe ocultarse, saltar
                if (filtrosAOcultar.has(nombre.toLowerCase())) {
                    // Ocultar el elemento si existe
                    const existingEl = document.querySelector('[data-filtro-nombre="' + nombre.toLowerCase() + '"]');
                    if (existingEl) existingEl.style.display = 'none';
                    return;
                }
                
                const nombreEn = filtro.nombre_en || nombre;
                const tipo = filtro.tipo || 'desplegable';
                const unidad = filtro.unidad || '';
                const nombreLower = sanitizeName(nombre);
                
                // Obtener valores únicos del stock FILTRADO (case insensitive en keys)
                let valores = [];
                vehiculosFiltrados.forEach(v => {
                    if (v.filtros_json && typeof v.filtros_json === 'object') {
                        // Buscar la clave de forma case-insensitive
                        const key = Object.keys(v.filtros_json).find(k => k.toLowerCase() === nombreLower);
                        if (key) {
                            const val = v.filtros_json[key];
                            if (val !== undefined && val !== null && val !== '') {
                                valores.push(val);
                            }
                        }
                    }
                });
                
                const valoresUnicos = [...new Set(valores)].filter(Boolean);
                console.log('Filtro "' + nombre + '" valores:', valoresUnicos);
                
                // Si no hay valores, no mostrar
                if (valoresUnicos.length === 0) return;
                
                // Para sliders, necesitamos al menos 2 valores numéricos diferentes
                if ((tipo === 'slider' || tipo === 'calc')) {
                    const nums = valoresUnicos.filter(v => !isNaN(parseFloat(v))).map(Number);
                    if (nums.length < 2 || Math.min(...nums) === Math.max(...nums)) return;
                }
                
                valores = valoresUnicos.sort((a, b) => {
                    // Ordenar numéricamente si son números
                    if (!isNaN(a) && !isNaN(b)) return parseFloat(a) - parseFloat(b);
                    return String(a).localeCompare(String(b));
                });
                
                let html = '';
                const labelText = (currentLang === 'en' && nombreEn ? nombreEn : nombre) + (unidad ? ' (' + unidad + ')' : '');
                
                switch (tipo) {
                    case 'desplegable':
                        html = `
                            <div class="filter-group" data-filtro-nombre="${nombre.toLowerCase()}">
                                <label class="filter-label">${labelText}:</label>
                                <select id="filtro_${nombreLower}" onchange="filterAndRenderProducts()">
                                    <option value="">${currentLang === 'es' ? 'Todos' : 'All'}</option>
                                    ${valores.map(v => `<option value="${v}">${v}</option>`).join('')}
                                </select>
                            </div>
                        `;
                        break;
                        
                    case 'desplegable_tick':
                        html = `
                            <div class="filter-group" data-filtro-nombre="${nombre.toLowerCase()}">
                                <label class="filter-label">${labelText}:</label>
                                <div class="checkbox-group-dynamic">
                                    ${valores.map(v => `
                                        <label class="checkbox-container">
                                            <input type="checkbox" class="filtro_${nombreLower}_check" value="${v}" onchange="filterAndRenderProducts()">
                                            <span class="checkbox-label">${v}</span>
                                        </label>
                                    `).join('')}
                                </div>
                            </div>
                        `;
                        break;
                        
                    case 'tick':
                        // Solo mostrar tick si hay vehículos que lo tengan activo
                        const tieneActivos = valores.some(v => v === true || v === 'TRUE' || v === 'Sí' || v === 'Si');
                        if (!tieneActivos && valores.length === 0) return;
                        html = `
                            <div class="filter-group" data-filtro-nombre="${nombre.toLowerCase()}">
                                <label class="checkbox-container">
                                    <input type="checkbox" id="filtro_${nombreLower}" onchange="filterAndRenderProducts()">
                                    <span class="checkbox-label">${nombre}</span>
                                </label>
                            </div>
                        `;
                        break;
                        
                    case 'slider':
                    case 'calc':
                        const nums = valores.filter(v => !isNaN(parseFloat(v))).map(Number);
                        const min = Math.min(...nums);
                        const max = Math.max(...nums);
                        html = `
                            <div class="filter-group" data-filtro-nombre="${nombre.toLowerCase()}">
                                <label class="filter-label">${nombre}:</label>
                                <div class="slider-container">
                                    <div class="slider-values">
                                        <span id="filtro_${nombreLower}_min_val">${min}</span>${unidad ? '<small>' + unidad + '</small>' : ''}
                                        <span>-</span>
                                        <span id="filtro_${nombreLower}_max_val">${max}</span>${unidad ? '<small>' + unidad + '</small>' : ''}
                                    </div>
                                    <div class="slider-range">
                                        <input type="range" id="filtro_${nombreLower}_min" min="${min}" max="${max}" value="${min}" step="1" 
                                            oninput="document.getElementById('filtro_${nombreLower}_min_val').textContent=this.value; filterAndRenderProducts()">
                                        <input type="range" id="filtro_${nombreLower}_max" min="${min}" max="${max}" value="${max}" step="1"
                                            oninput="document.getElementById('filtro_${nombreLower}_max_val').textContent=this.value; filterAndRenderProducts()">
                                    </div>
                                </div>
                            </div>
                        `;
                        break;
                        
                    default:
                        html = `
                            <div class="filter-group" data-filtro-nombre="${nombre.toLowerCase()}">
                                <label class="filter-label">${nombre}:</label>
                                <select id="filtro_${nombreLower}" onchange="filterAndRenderProducts()">
                                    <option value="">${currentLang === 'es' ? 'Todos' : 'All'}</option>
                                    ${valores.map(v => `<option value="${v}">${v}</option>`).join('')}
                                </select>
                            </div>
                        `;
                }
                
                if (html) {
                    container.insertAdjacentHTML('beforeend', html);
                }
            });
        }

        function updateRigidosCisternaFilters() {
            const rigidosCisternaCheck = document.getElementById('rigidosCisternaCheck');
            if (!rigidosCisternaCheck) return;
            
            const advancedFiltersContainer = document.getElementById('advancedFilters');
            const existingCisternaFilters = document.getElementById('rigidosCisternaFilters');
            const existingCapacidadFilter = document.getElementById('rigidosCapacidadFilter');
            
            if (existingCisternaFilters) existingCisternaFilters.remove();
            if (existingCapacidadFilter) existingCapacidadFilter.remove();
            
            if (rigidosCisternaCheck.checked) {
                const cisternaFiltersHTML = `
                    <div id="rigidosCisternaFilters" style="display: contents;">
                        <div class="filter-group" data-filtro-nombre="${nombre.toLowerCase()}">
                            <label class="filter-label" data-es="Tipo:" data-en="Type:">Tipo:</label>
                            <select id="rigidosCisternaType">
                                <option value="" data-es="Todos" data-en="All">Todos</option>
                                <option value="alimentaria">Alimentaria</option>
                                <option value="combustible">Combustible</option>
                                <option value="quimica">Química</option>
                                <option value="agua">Agua</option>
                            </select>
                        </div>
                        <div class="filter-group" data-filtro-nombre="${nombre.toLowerCase()}">
                            <label class="filter-label" data-es="Volumen:" data-en="Volume:">Volumen:</label>
                            <div class="slider-container">
                                <div class="slider-values">
                                    <span id="rigidosVolumeMinValue">5000L</span>
                                    <span>-</span>
                                    <span id="rigidosVolumeMaxValue">40000L</span>
                                </div>
                                <div class="slider-range">
                                    <input type="range" id="rigidosVolumeMin" min="5000" max="40000" value="5000" step="1000">
                                    <input type="range" id="rigidosVolumeMax" min="5000" max="40000" value="40000" step="1000">
                                </div>
                            </div>
                        </div>
                        <div class="filter-group" data-filtro-nombre="${nombre.toLowerCase()}">
                            <label class="filter-label" data-es="Comp.:" data-en="Comp.:">Comp.:</label>
                            <select id="rigidosCompartments">
                                <option value="" data-es="Todos" data-en="All">Todos</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5+</option>
                            </select>
                        </div>
                    </div>
                `;
                advancedFiltersContainer.insertAdjacentHTML('beforeend', cisternaFiltersHTML);
                
                const rigidosVolumeMinSlider = document.getElementById('rigidosVolumeMin');
                const rigidosVolumeMaxSlider = document.getElementById('rigidosVolumeMax');
                const rigidosVolumeMinValue = document.getElementById('rigidosVolumeMinValue');
                const rigidosVolumeMaxValue = document.getElementById('rigidosVolumeMaxValue');
                
                rigidosVolumeMinSlider.addEventListener('input', (e) => {
                    const value = parseInt(e.target.value);
                    if (value < parseInt(rigidosVolumeMaxSlider.value)) {
                        rigidosVolumeMinValue.textContent = value + 'L';
                        filterAndRenderProducts();
                    }
                });
                
                rigidosVolumeMaxSlider.addEventListener('input', (e) => {
                    const value = parseInt(e.target.value);
                    if (value > parseInt(rigidosVolumeMinSlider.value)) {
                        rigidosVolumeMaxValue.textContent = value + 'L';
                        filterAndRenderProducts();
                    }
                });
                
                document.getElementById('rigidosCisternaType').addEventListener('change', filterAndRenderProducts);
                document.getElementById('rigidosCompartments').addEventListener('change', filterAndRenderProducts);
            } else {
                const capacidadFilterHTML = `
                    <!-- 3c: Filtro Tipo para rígidos NO cisterna -->
                    <div id="rigidosOtrosTipoFilter" class="filter-group">
                        <label class="filter-label" data-es="Tipo:" data-en="Type:">Tipo:</label>
                        <select id="rigidosOtrosTipo">
                            <option value="" data-es="Todos" data-en="All">Todos</option>
                            <option value="plataforma" data-es="Plataforma" data-en="Platform">Plataforma</option>
                            <option value="caja" data-es="Caja" data-en="Box">Caja</option>
                            <option value="volquete" data-es="Volquete" data-en="Tipper">Volquete</option>
                            <option value="frigorifico" data-es="Frigorífico" data-en="Refrigerated">Frigorífico</option>
                            <option value="grua" data-es="Grúa" data-en="Crane">Grúa</option>
                            <option value="otros" data-es="Otros" data-en="Others">Otros</option>
                        </select>
                    </div>
                    <div id="rigidosCapacidadFilter" class="filter-group">
                        <label class="filter-label" data-es="Capacidad:" data-en="Capacity:">Capacidad:</label>
                        <div class="slider-container">
                            <div class="slider-values">
                                <span id="capacidadMinValue">5000kg</span>
                                <span>-</span>
                                <span id="capacidadMaxValue">30000kg</span>
                            </div>
                            <div class="slider-range">
                                <input type="range" id="capacidadMin" min="5000" max="30000" value="5000" step="1000">
                                <input type="range" id="capacidadMax" min="5000" max="30000" value="30000" step="1000">
                            </div>
                        </div>
                    </div>
                `;
                advancedFiltersContainer.insertAdjacentHTML('beforeend', capacidadFilterHTML);
                
                // 3c: Event listener para filtro Tipo
                document.getElementById('rigidosOtrosTipo').addEventListener('change', filterAndRenderProducts);
                
                const capacidadMinSlider = document.getElementById('capacidadMin');
                const capacidadMaxSlider = document.getElementById('capacidadMax');
                const capacidadMinValue = document.getElementById('capacidadMinValue');
                const capacidadMaxValue = document.getElementById('capacidadMaxValue');
                
                capacidadMinSlider.addEventListener('input', (e) => {
                    const value = parseInt(e.target.value);
                    if (value < parseInt(capacidadMaxSlider.value)) {
                        capacidadMinValue.textContent = value + 'kg';
                        filterAndRenderProducts();
                    }
                });
                
                capacidadMaxSlider.addEventListener('input', (e) => {
                    const value = parseInt(e.target.value);
                    if (value > parseInt(capacidadMinSlider.value)) {
                        capacidadMaxValue.textContent = value + 'kg';
                        filterAndRenderProducts();
                    }
                });
            }
            
            switchLanguage(currentLang);
        }

        function updateRemolquesCisternaFilters() {
            const remolquesCisternaCheck = document.getElementById('remolquesCisternaCheck');
            if (!remolquesCisternaCheck) return;
            
            const advancedFiltersContainer = document.getElementById('advancedFilters');
            const existingCisternaFilters = document.getElementById('remolquesCisternaFilters');
            
            if (remolquesCisternaCheck.checked && !existingCisternaFilters) {
                const cisternaFiltersHTML = `
                    <div id="remolquesCisternaFilters" style="display: contents;">
                        <div class="filter-group" data-filtro-nombre="${nombre.toLowerCase()}">
                            <label class="filter-label" data-es="Tipo:" data-en="Type:">Tipo:</label>
                            <select id="remolquesCisternaType">
                                <option value="" data-es="Todos" data-en="All">Todos</option>
                                <option value="alimentaria">Alimentaria</option>
                                <option value="combustible">Combustible</option>
                                <option value="quimica">Química</option>
                                <option value="agua">Agua</option>
                            </select>
                        </div>
                        <div class="filter-group" data-filtro-nombre="${nombre.toLowerCase()}">
                            <label class="filter-label" data-es="Volumen:" data-en="Volume:">Volumen:</label>
                            <div class="slider-container">
                                <div class="slider-values">
                                    <span id="remolquesVolumeMinValue">5000L</span>
                                    <span>-</span>
                                    <span id="remolquesVolumeMaxValue">40000L</span>
                                </div>
                                <div class="slider-range">
                                    <input type="range" id="remolquesVolumeMin" min="5000" max="40000" value="5000" step="1000">
                                    <input type="range" id="remolquesVolumeMax" min="5000" max="40000" value="40000" step="1000">
                                </div>
                            </div>
                        </div>
                        <div class="filter-group" data-filtro-nombre="${nombre.toLowerCase()}">
                            <label class="filter-label" data-es="Comp.:" data-en="Comp.:">Comp.:</label>
                            <select id="remolquesCompartments">
                                <option value="" data-es="Todos" data-en="All">Todos</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5+</option>
                            </select>
                        </div>
                    </div>
                `;
                advancedFiltersContainer.insertAdjacentHTML('beforeend', cisternaFiltersHTML);
                
                const remolquesVolumeMinSlider = document.getElementById('remolquesVolumeMin');
                const remolquesVolumeMaxSlider = document.getElementById('remolquesVolumeMax');
                const remolquesVolumeMinValue = document.getElementById('remolquesVolumeMinValue');
                const remolquesVolumeMaxValue = document.getElementById('remolquesVolumeMaxValue');
                
                remolquesVolumeMinSlider.addEventListener('input', (e) => {
                    const value = parseInt(e.target.value);
                    if (value < parseInt(remolquesVolumeMaxSlider.value)) {
                        remolquesVolumeMinValue.textContent = value + 'L';
                        filterAndRenderProducts();
                    }
                });
                
                remolquesVolumeMaxSlider.addEventListener('input', (e) => {
                    const value = parseInt(e.target.value);
                    if (value > parseInt(remolquesVolumeMinSlider.value)) {
                        remolquesVolumeMaxValue.textContent = value + 'L';
                        filterAndRenderProducts();
                    }
                });
                
                document.getElementById('remolquesCisternaType').addEventListener('change', filterAndRenderProducts);
                document.getElementById('remolquesCompartments').addEventListener('change', filterAndRenderProducts);
                
                switchLanguage(currentLang);
            } else if (!remolquesCisternaCheck.checked) {
                // 3c: Filtros para remolques NO cisterna
                if (existingCisternaFilters) existingCisternaFilters.remove();
                
                const existingRemolquesOtrosFilters = document.getElementById('remolquesOtrosFilters');
                if (existingRemolquesOtrosFilters) existingRemolquesOtrosFilters.remove();
                
                const otrosFiltersHTML = `
                    <div id="remolquesOtrosFilters" style="display: contents;">
                        <div class="filter-group" data-filtro-nombre="${nombre.toLowerCase()}">
                            <label class="filter-label" data-es="Tipo:" data-en="Type:">Tipo:</label>
                            <select id="remolquesOtrosTipo">
                                <option value="" data-es="Todos" data-en="All">Todos</option>
                                <option value="plataforma" data-es="Plataforma" data-en="Platform">Plataforma</option>
                                <option value="caja" data-es="Caja" data-en="Box">Caja</option>
                                <option value="lona" data-es="Lona" data-en="Tarp">Lona</option>
                                <option value="frigorifico" data-es="Frigorífico" data-en="Refrigerated">Frigorífico</option>
                                <option value="portacontenedores" data-es="Portacontenedores" data-en="Container carrier">Portacontenedores</option>
                                <option value="otros" data-es="Otros" data-en="Others">Otros</option>
                            </select>
                        </div>
                        <div class="filter-group" data-filtro-nombre="${nombre.toLowerCase()}">
                            <label class="filter-label" data-es="Capacidad:" data-en="Capacity:">Capacidad:</label>
                            <div class="slider-container">
                                <div class="slider-values">
                                    <span id="remolquesCapacidadMinValue">5000kg</span>
                                    <span>-</span>
                                    <span id="remolquesCapacidadMaxValue">30000kg</span>
                                </div>
                                <div class="slider-range">
                                    <input type="range" id="remolquesCapacidadMin" min="5000" max="30000" value="5000" step="1000">
                                    <input type="range" id="remolquesCapacidadMax" min="5000" max="30000" value="30000" step="1000">
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                advancedFiltersContainer.insertAdjacentHTML('beforeend', otrosFiltersHTML);
                
                // Event listeners
                document.getElementById('remolquesOtrosTipo').addEventListener('change', filterAndRenderProducts);
                
                const remolquesCapacidadMinSlider = document.getElementById('remolquesCapacidadMin');
                const remolquesCapacidadMaxSlider = document.getElementById('remolquesCapacidadMax');
                const remolquesCapacidadMinValue = document.getElementById('remolquesCapacidadMinValue');
                const remolquesCapacidadMaxValue = document.getElementById('remolquesCapacidadMaxValue');
                
                remolquesCapacidadMinSlider.addEventListener('input', (e) => {
                    const value = parseInt(e.target.value);
                    if (value < parseInt(remolquesCapacidadMaxSlider.value)) {
                        remolquesCapacidadMinValue.textContent = value + 'kg';
                        filterAndRenderProducts();
                    }
                });
                
                remolquesCapacidadMaxSlider.addEventListener('input', (e) => {
                    const value = parseInt(e.target.value);
                    if (value > parseInt(remolquesCapacidadMinSlider.value)) {
                        remolquesCapacidadMaxValue.textContent = value + 'kg';
                        filterAndRenderProducts();
                    }
                });
                
                switchLanguage(currentLang);
            }
        }

        // 3c: Función para manejar filtros de semirremolques
        function updateSemirremolquesCisternaFilters() {
            const semirremolquesCisternaCheck = document.getElementById('semirremolquesCisternaCheck');
            if (!semirremolquesCisternaCheck) return;
            
            const advancedFiltersContainer = document.getElementById('advancedFilters');
            const existingCisternaFilters = document.getElementById('semirremolquesCisternaFilters');
            
            if (semirremolquesCisternaCheck.checked) {
                // Filtros para semirremolques cisterna
                if (existingCisternaFilters) existingCisternaFilters.remove();
                
                const existingOtrosFilters = document.getElementById('semirremolquesOtrosFilters');
                if (existingOtrosFilters) existingOtrosFilters.remove();
                
                const cisternaFiltersHTML = `
                    <div id="semirremolquesCisternaFilters" style="display: contents;">
                        <div class="filter-group" data-filtro-nombre="${nombre.toLowerCase()}">
                            <label class="filter-label" data-es="Tipo:" data-en="Type:">Tipo:</label>
                            <select id="semirremolquesCisternaType">
                                <option value="" data-es="Todos" data-en="All">Todos</option>
                                <option value="alimentaria">Alimentaria</option>
                                <option value="combustible">Combustible</option>
                                <option value="quimica">Química</option>
                                <option value="agua">Agua</option>
                            </select>
                        </div>
                        <div class="filter-group" data-filtro-nombre="${nombre.toLowerCase()}">
                            <label class="filter-label" data-es="Volumen:" data-en="Volume:">Volumen:</label>
                            <div class="slider-container">
                                <div class="slider-values">
                                    <span id="semirremolquesVolumeMinValue">10000L</span>
                                    <span>-</span>
                                    <span id="semirremolquesVolumeMaxValue">50000L</span>
                                </div>
                                <div class="slider-range">
                                    <input type="range" id="semirremolquesVolumeMin" min="10000" max="50000" value="10000" step="1000">
                                    <input type="range" id="semirremolquesVolumeMax" min="10000" max="50000" value="50000" step="1000">
                                </div>
                            </div>
                        </div>
                        <div class="filter-group" data-filtro-nombre="${nombre.toLowerCase()}">
                            <label class="filter-label" data-es="Comp.:" data-en="Comp.:">Comp.:</label>
                            <select id="semirremolquesCompartments">
                                <option value="" data-es="Todos" data-en="All">Todos</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5+</option>
                            </select>
                        </div>
                    </div>
                `;
                advancedFiltersContainer.insertAdjacentHTML('beforeend', cisternaFiltersHTML);
                
                // Event listeners
                document.getElementById('semirremolquesCisternaType').addEventListener('change', filterAndRenderProducts);
                document.getElementById('semirremolquesCompartments').addEventListener('change', filterAndRenderProducts);
                
                const volumeMinSlider = document.getElementById('semirremolquesVolumeMin');
                const volumeMaxSlider = document.getElementById('semirremolquesVolumeMax');
                const volumeMinValue = document.getElementById('semirremolquesVolumeMinValue');
                const volumeMaxValue = document.getElementById('semirremolquesVolumeMaxValue');
                
                volumeMinSlider.addEventListener('input', (e) => {
                    const value = parseInt(e.target.value);
                    if (value < parseInt(volumeMaxSlider.value)) {
                        volumeMinValue.textContent = value + 'L';
                        filterAndRenderProducts();
                    }
                });
                
                volumeMaxSlider.addEventListener('input', (e) => {
                    const value = parseInt(e.target.value);
                    if (value > parseInt(volumeMinSlider.value)) {
                        volumeMaxValue.textContent = value + 'L';
                        filterAndRenderProducts();
                    }
                });
                
                switchLanguage(currentLang);
            } else {
                // 3c: Filtros para semirremolques NO cisterna
                if (existingCisternaFilters) existingCisternaFilters.remove();
                
                const existingOtrosFilters = document.getElementById('semirremolquesOtrosFilters');
                if (existingOtrosFilters) existingOtrosFilters.remove();
                
                const otrosFiltersHTML = `
                    <div id="semirremolquesOtrosFilters" style="display: contents;">
                        <div class="filter-group" data-filtro-nombre="${nombre.toLowerCase()}">
                            <label class="filter-label" data-es="Tipo:" data-en="Type:">Tipo:</label>
                            <select id="semirremolquesOtrosTipo">
                                <option value="" data-es="Todos" data-en="All">Todos</option>
                                <option value="plataforma" data-es="Plataforma" data-en="Platform">Plataforma</option>
                                <option value="caja" data-es="Caja" data-en="Box">Caja</option>
                                <option value="lona" data-es="Lona" data-en="Tarp">Lona</option>
                                <option value="frigorifico" data-es="Frigorífico" data-en="Refrigerated">Frigorífico</option>
                                <option value="portacontenedores" data-es="Portacontenedores" data-en="Container carrier">Portacontenedores</option>
                                <option value="otros" data-es="Otros" data-en="Others">Otros</option>
                            </select>
                        </div>
                        <div class="filter-group" data-filtro-nombre="${nombre.toLowerCase()}">
                            <label class="filter-label" data-es="Capacidad:" data-en="Capacity:">Capacidad:</label>
                            <div class="slider-container">
                                <div class="slider-values">
                                    <span id="semirremolquesCapacidadMinValue">5000kg</span>
                                    <span>-</span>
                                    <span id="semirremolquesCapacidadMaxValue">35000kg</span>
                                </div>
                                <div class="slider-range">
                                    <input type="range" id="semirremolquesCapacidadMin" min="5000" max="35000" value="5000" step="1000">
                                    <input type="range" id="semirremolquesCapacidadMax" min="5000" max="35000" value="35000" step="1000">
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                advancedFiltersContainer.insertAdjacentHTML('beforeend', otrosFiltersHTML);
                
                // Event listeners
                document.getElementById('semirremolquesOtrosTipo').addEventListener('change', filterAndRenderProducts);
                
                const capacidadMinSlider = document.getElementById('semirremolquesCapacidadMin');
                const capacidadMaxSlider = document.getElementById('semirremolquesCapacidadMax');
                const capacidadMinValue = document.getElementById('semirremolquesCapacidadMinValue');
                const capacidadMaxValue = document.getElementById('semirremolquesCapacidadMaxValue');
                
                capacidadMinSlider.addEventListener('input', (e) => {
                    const value = parseInt(e.target.value);
                    if (value < parseInt(capacidadMaxSlider.value)) {
                        capacidadMinValue.textContent = value + 'kg';
                        filterAndRenderProducts();
                    }
                });
                
                capacidadMaxSlider.addEventListener('input', (e) => {
                    const value = parseInt(e.target.value);
                    if (value > parseInt(capacidadMinSlider.value)) {
                        capacidadMaxValue.textContent = value + 'kg';
                        filterAndRenderProducts();
                    }
                });
                
                switchLanguage(currentLang);
            }
        }

        // ============================================
        // FILTERS
        // ============================================
        const priceMinSlider = document.getElementById('priceMin');
        const priceMaxSlider = document.getElementById('priceMax');
        const priceMinValue = document.getElementById('priceMinValue');
        const priceMaxValue = document.getElementById('priceMaxValue');

        priceMinSlider.addEventListener('input', (e) => {
            let value = parseInt(e.target.value);
            const maxVal = parseInt(priceMaxSlider.value);
            
            // Si mínimo >= máximo, ajustar
            if (value >= maxVal) {
                value = maxVal - 100;
                if (value < parseInt(priceMinSlider.min)) value = parseInt(priceMinSlider.min);
                priceMinSlider.value = value;
            }
            
            currentFilters.priceMin = value;
            priceMinValue.textContent = currentLang === 'en' && value >= 1000 ? `${(value/1000).toFixed(0)}k€` : `${formatNumber(value)}€`;
            filterAndRenderProducts();
        });

        priceMaxSlider.addEventListener('input', (e) => {
            let value = parseInt(e.target.value);
            const minVal = parseInt(priceMinSlider.value);
            
            // Si máximo <= mínimo, ajustar
            if (value <= minVal) {
                value = minVal + 100;
                if (value > parseInt(priceMaxSlider.max)) value = parseInt(priceMaxSlider.max);
                priceMaxSlider.value = value;
            }
            
            currentFilters.priceMax = value;
            priceMaxValue.textContent = currentLang === 'en' && value >= 1000 ? `${(value/1000).toFixed(0)}k€` : `${formatNumber(value)}€`;
            filterAndRenderProducts();
        });

        const yearMinSlider = document.getElementById('yearMin');
        const yearMaxSlider = document.getElementById('yearMax');
        const yearMinValue = document.getElementById('yearMinValue');
        const yearMaxValue = document.getElementById('yearMaxValue');

        yearMinSlider.addEventListener('input', (e) => {
            let value = parseInt(e.target.value);
            const maxVal = parseInt(yearMaxSlider.value);
            
            // Si mínimo >= máximo, ajustar máximo automáticamente
            if (value >= maxVal) {
                value = maxVal - 1;
                yearMinSlider.value = value;
            }
            
            currentFilters.yearMin = value;
            yearMinValue.textContent = value;
            filterAndRenderProducts();
        });

        yearMaxSlider.addEventListener('input', (e) => {
            let value = parseInt(e.target.value);
            const minVal = parseInt(yearMinSlider.value);
            
            // Si máximo <= mínimo, ajustar mínimo automáticamente
            if (value <= minVal) {
                value = minVal + 1;
                yearMaxSlider.value = value;
            }
            
            currentFilters.yearMax = value;
            yearMaxValue.textContent = value;
            filterAndRenderProducts();
        });

        // ============================================
        // 4e: SOLUCION SLIDERS - Eventos
        // ============================================
        function setupDualSlider(minId, maxId) {
            const minSlider = document.getElementById(minId);
            const maxSlider = document.getElementById(maxId);
            
            if (!minSlider || !maxSlider) return;
            
            [minSlider, maxSlider].forEach(slider => {
                slider.addEventListener('mousedown', (e) => e.stopPropagation(), { passive: true });
                slider.addEventListener('touchstart', (e) => e.stopPropagation(), { passive: true });
            });
        }
        
        setupDualSlider('priceMin', 'priceMax');
        setupDualSlider('yearMin', 'yearMax');


        // ============================================
        // SEARCH - usando el input existente
        // ============================================
        const searchInput = document.getElementById('searchInput');
        if (searchInput) {
            searchInput.addEventListener('input', (e) => {
                currentFilters.searchText = e.target.value.toLowerCase();
                filterAndRenderProducts();
                
                // Mostrar/ocultar botón X
                const clearBtn = document.getElementById('searchClearBtn');
                if (clearBtn) {
                    clearBtn.style.display = e.target.value.length > 0 ? 'flex' : 'none';
                }
            });
        }
        
        // Botón X para limpiar búsqueda
        const searchClearBtn = document.getElementById('searchClearBtn');
        if (searchClearBtn) {
            searchClearBtn.addEventListener('click', () => {
                const input = document.getElementById('searchInput');
                if (input) {
                    input.value = '';
                    currentFilters.searchText = '';
                    filterAndRenderProducts();
                    searchClearBtn.style.display = 'none';
                }
            });
        }
        
        // Buscador móvil
        const searchInputMobile = document.getElementById('searchInputMobile');
        if (searchInputMobile) {
            searchInputMobile.addEventListener('input', (e) => {
                currentFilters.searchText = e.target.value.toLowerCase();
                filterAndRenderProducts();
                // Sincronizar con desktop
                if (searchInput) searchInput.value = e.target.value;
            });
        }

        // ============================================
        // 5c: FAVORITES BUTTON (Mostrar Favoritos)
        // ============================================
        const favoritesBtn = document.getElementById('favoritesBtn');
        let showingFavoritesOnly = false;

        if (favoritesBtn) {
            favoritesBtn.addEventListener('click', () => {
                // Verificar si usuario está logueado
                const isLoggedIn = sessionStorage.getItem('isLoggedIn') === 'true';
                
                if (!isLoggedIn) {
                    // Mostrar modal de login
                    showLoginModal();
                    return;
                }

                // Toggle favoritos filter
                showingFavoritesOnly = !showingFavoritesOnly;
                favoritesBtn.classList.toggle('active', showingFavoritesOnly);
                
                // Aplicar filtro de favoritos
                currentFilters.favoritesOnly = showingFavoritesOnly;
                filterAndRenderProducts();
            });
        }

        // ============================================
        // NOTIFICATION BUTTON
        // ============================================
        const notificationBtnWrapper = document.getElementById('notificationBtnWrapper');
        const catalogControls = document.getElementById('catalogControls');

        window.addEventListener('scroll', () => {
            const controlsRect = catalogControls.getBoundingClientRect();
            if (controlsRect.bottom < 0) {
                notificationBtnWrapper.classList.add('sticky');
            } else {
                notificationBtnWrapper.classList.remove('sticky');
            }
        });

        const notificationBtn = document.getElementById('notificationBtn');
        console.log('🔍 notificationBtn:', notificationBtn);
        
        if (notificationBtn) {
            notificationBtn.addEventListener('click', () => {
                console.log('🔵 Click en notificationBtn detectado!');
                const demandModal = document.getElementById('demandModal');
                console.log('🔍 demandModal:', demandModal);
                if (demandModal) {
                    demandModal.classList.add('active');
                    document.body.style.overflow = 'hidden';
                    console.log('✅ Modal Demand abierto');
                } else {
                    console.error('❌ Modal Demand NO encontrado');
                }
            });
        } else {
            console.error('❌ Botón notificationBtn NO encontrado');
        }

        // ============================================
        // FILTER AND RENDER PRODUCTS
        // ============================================
        // ============================================
        // 16a: BÚSQUEDA CON CORRECCIÓN TIPOGRÁFICA
        // ============================================
        
        // Función para calcular distancia de Levenshtein simplificada
        function fuzzyMatch(str1, str2, maxDistance = 2) {
            str1 = str1.toLowerCase();
            str2 = str2.toLowerCase();
            
            // Si coincide exactamente, perfecto
            if (str1.includes(str2) || str2.includes(str1)) {
                return true;
            }
            
            // Si la diferencia de longitud es muy grande, no coincide
            if (Math.abs(str1.length - str2.length) > maxDistance) {
                return false;
            }
            
            // Calcular distancia de Levenshtein
            const matrix = [];
            for (let i = 0; i <= str2.length; i++) {
                matrix[i] = [i];
            }
            for (let j = 0; j <= str1.length; j++) {
                matrix[0][j] = j;
            }
            
            for (let i = 1; i <= str2.length; i++) {
                for (let j = 1; j <= str1.length; j++) {
                    if (str2.charAt(i - 1) === str1.charAt(j - 1)) {
                        matrix[i][j] = matrix[i - 1][j - 1];
                    } else {
                        matrix[i][j] = Math.min(
                            matrix[i - 1][j - 1] + 1, // sustitución
                            matrix[i][j - 1] + 1,     // inserción
                            matrix[i - 1][j] + 1      // borrado
                        );
                    }
                }
            }
            
            return matrix[str2.length][str1.length] <= maxDistance;
        }
        
        // Función para buscar con tolerancia a errores
        function fuzzySearch(text, searchQuery) {
            const textWords = text.toLowerCase().split(/\s+/);
            const searchWords = searchQuery.toLowerCase().split(/\s+/);
            
            // Buscar coincidencias palabra por palabra
            for (const searchWord of searchWords) {
                let found = false;
                for (const textWord of textWords) {
                    if (fuzzyMatch(textWord, searchWord, 2)) {
                        found = true;
                        break;
                    }
                }
                if (!found) return false;
            }
            return true;
        }

        function filterAndRenderProducts() {
            console.log('🎨 filterAndRenderProducts - Inicio');
            console.log('📦 sampleProducts.length:', sampleProducts.length);
            console.log('📦 sampleProducts:', sampleProducts);
            
            let filtered = [...sampleProducts];
            console.log('📦 filtered inicial:', filtered.length);
            
            // Si hay categorías seleccionadas, filtrar por ellas
            // Un vehículo pasa si ALGUNA de sus categorías está seleccionada
            const allCategories = ['alquiler', 'venta', 'terceros'];
            if (activeCategories.size > 0 && activeCategories.size < allCategories.length) {
                console.log('🔍 Filtrando por categorías:', [...activeCategories]);
                filtered = filtered.filter(p => {
                    // Si tiene array de categorías, verificar si alguna coincide
                    if (p.categories && Array.isArray(p.categories) && p.categories.length > 0) {
                        const pasa = p.categories.some(cat => activeCategories.has(cat));
                        if (!pasa) console.log('❌ No pasa filtro cat:', p.brand, p.model, 'cats:', p.categories);
                        return pasa;
                    }
                    // Fallback a categoría única
                    const pasa = activeCategories.has(p.category);
                    if (!pasa) console.log('❌ No pasa filtro cat (single):', p.brand, p.model, 'cat:', p.category);
                    return pasa;
                });
                console.log('📦 Después filtro categorías:', filtered.length);
            }
            
            // Si hay subcategoría seleccionada, filtrar por ella
            if (activeSubcategory) {
                filtered = filtered.filter(p => {
                    const pSubcat = (p.subcategory || '').toLowerCase();
                    const activeSubcat = activeSubcategory.toLowerCase();
                    return pSubcat === activeSubcat;
                });
                console.log('📦 Después filtro subcategoría:', filtered.length, '| activeSubcategory:', activeSubcategory);
            }
            
            // Determinar qué precio mostrar según filtros activos
            const soloAlquiler = activeCategories.size === 1 && activeCategories.has('alquiler');
            
            console.log('💰 Filtro PRECIO - Min:', currentFilters.priceMin, 'Max:', currentFilters.priceMax, 'soloAlquiler:', soloAlquiler);
            filtered = filtered.filter(p => {
                // Terceros no tienen precio filtrable
                if (p.categories?.includes('terceros') || p.category === 'terceros') return true;
                
                // Si se filtra solo por alquiler
                if (soloAlquiler) {
                    // Si tiene precio_alquiler válido, filtrar por ese
                    if (p.price_rent && p.price_rent > 0) {
                        const pasa = p.price_rent >= currentFilters.priceMin && p.price_rent <= currentFilters.priceMax;
                        console.log('  💰 Alquiler con price_rent:', p.brand, p.model, 'price_rent:', p.price_rent, 'pasa:', pasa);
                        return pasa;
                    }
                    // Si NO tiene precio_alquiler, incluirlo sin filtrar por precio
                    console.log('  💰 Alquiler SIN price_rent:', p.brand, p.model, '- incluido');
                    return true;
                }
                
                // Filtro normal por precio de venta
                if (!p.price || p.price <= 0) return true;
                return p.price >= currentFilters.priceMin && p.price <= currentFilters.priceMax;
            });
            console.log('📦 Después filtro precio:', filtered.length);
            
            if (currentFilters.brand) {
                filtered = filtered.filter(p => p.brand === currentFilters.brand);
                console.log('📦 Después filtro marca:', filtered.length);
            }
            
            console.log('📅 Filtro AÑO - Min:', currentFilters.yearMin, 'Max:', currentFilters.yearMax);
            filtered = filtered.filter(p => {
                const pass = p.year >= currentFilters.yearMin && p.year <= currentFilters.yearMax;
                if (!pass) console.log('❌ Filtrado por año:', p.brand, p.model, 'Año:', p.year);
                return pass;
            });
            console.log('📦 Después filtro año:', filtered.length);
            
            // 16a: Búsqueda con corrección tipográfica
            if (currentFilters.searchText) {
                filtered = filtered.filter(p => {
                    const searchStr = `${p.brand} ${p.model} ${p.year} ${p.subcategory} ${p.location}`;
                    return fuzzySearch(searchStr, currentFilters.searchText);
                });
            }
            
            // Filtros avanzados
            if (activeSubcategory === 'rigidos') {
                const powerMin = document.getElementById('powerMin')?.value;
                const powerMax = document.getElementById('powerMax')?.value;
                if (powerMin && powerMax) {
                    filtered = filtered.filter(p => {
                        if (!p.power) return true;
                        return p.power >= parseInt(powerMin) && p.power <= parseInt(powerMax);
                    });
                }
                
                const rigidosCisternaCheck = document.getElementById('rigidosCisternaCheck');
                if (rigidosCisternaCheck) {
                    if (rigidosCisternaCheck.checked) {
                        filtered = filtered.filter(p => p.isCisterna === true);
                        
                        const cisternaType = document.getElementById('rigidosCisternaType')?.value;
                        if (cisternaType) {
                            filtered = filtered.filter(p => {
                                if (!p.cisternType) return true;
                                return p.cisternType === cisternaType;
                            });
                        }
                    } else {
                        const capacidadMin = document.getElementById('capacidadMin')?.value;
                        const capacidadMax = document.getElementById('capacidadMax')?.value;
                        if (capacidadMin && capacidadMax) {
                            filtered = filtered.filter(p => {
                                if (!p.capacity) return true;
                                return p.capacity >= parseInt(capacidadMin) && p.capacity <= parseInt(capacidadMax);
                            });
                        }
                    }
                }
            }
            
            if (activeSubcategory === 'remolques') {
                const remolquesCisternaCheck = document.getElementById('remolquesCisternaCheck');
                if (remolquesCisternaCheck && remolquesCisternaCheck.checked) {
                    filtered = filtered.filter(p => p.isCisterna === true);
                }
            }
            
            if (activeSubcategory === 'otros') {
                const otrosType = document.getElementById('otrosTypeFilter')?.value;
                if (otrosType) {
                    filtered = filtered.filter(p => {
                        if (!p.otherType) return true;
                        return p.otherType === otrosType;
                    });
                }
            }
            
            // 5c: Filtro de favoritos
            if (currentFilters.favoritesOnly) {
                const userFavorites = JSON.parse(localStorage.getItem('userFavorites') || '[]');
                filtered = filtered.filter(p => userFavorites.includes(p.id));
            }
            
            // NUEVO: Aplicar filtros dinámicos de Sheets
            if (window.filtrosFromSheets && window.filtrosFromSheets.length > 0) {
                window.filtrosFromSheets.forEach(filtro => {
                    const nombreLower = sanitizeName(filtro.nombre);
                    const tipo = filtro.tipo || 'desplegable';
                    
                    // Buscar elemento de filtro en el DOM
                    const selectEl = document.getElementById(`filtro_${nombreLower}`);
                    const checkEl = document.getElementById(`filtro_${nombreLower}`);
                    const minEl = document.getElementById(`filtro_${nombreLower}_min`);
                    const maxEl = document.getElementById(`filtro_${nombreLower}_max`);
                    const checkboxes = document.querySelectorAll(`.filtro_${nombreLower}_check:checked`);
                    
                    if (tipo === 'desplegable' && selectEl && selectEl.value) {
                        filtered = filtered.filter(p => {
                            const val = p.filtros_json?.[nombreLower] || p[nombreLower];
                            return String(val) === selectEl.value;
                        });
                    }
                    
                    if (tipo === 'tick' && checkEl && checkEl.checked) {
                        filtered = filtered.filter(p => {
                            const val = p.filtros_json?.[nombreLower] || p[nombreLower];
                            return val === true || val === 'TRUE' || val === 'Sí' || val === 'Si';
                        });
                    }
                    
                    if ((tipo === 'slider' || tipo === 'calc') && minEl && maxEl) {
                        const min = parseFloat(minEl.value);
                        const max = parseFloat(maxEl.value);
                        filtered = filtered.filter(p => {
                            const val = parseFloat(p.filtros_json?.[nombreLower] || p[nombreLower]);
                            if (isNaN(val)) return true;
                            return val >= min && val <= max;
                        });
                    }
                    
                    if (tipo === 'desplegable_tick' && checkboxes.length > 0) {
                        const selectedVals = Array.from(checkboxes).map(cb => cb.value);
                        filtered = filtered.filter(p => {
                            const val = String(p.filtros_json?.[nombreLower] || p[nombreLower]);
                            return selectedVals.includes(val);
                        });
                    }
                });
            }
            
            switch (currentFilters.sortBy) {
                case 'price-asc':
                    filtered.sort((a, b) => a.price - b.price);
                    break;
                case 'price-desc':
                    filtered.sort((a, b) => b.price - a.price);
                    break;
                case 'year-asc':
                    filtered.sort((a, b) => a.year - b.year);
                    break;
                case 'year-desc':
                    filtered.sort((a, b) => b.year - a.year);
                    break;
            }
            
            renderProducts(filtered);
        }

        function renderProducts(products) {
            console.log('🖼️ renderProducts - Inicio');
            console.log('🖼️ products.length:', products.length);
            console.log('🖼️ currentView:', currentView);
            
            if (currentView === 'table') {
                renderTableView(products);
            } else {
                renderThumbnailsView(products);
            }
        }

        function renderThumbnailsView(products) {
            console.log('🎴 renderThumbnailsView - Inicio');
            console.log('🎴 products.length:', products.length);
            console.log('🎴 products:', products);
            
            const catalog = document.getElementById('catalog');
            console.log('🎴 catalog element:', catalog);
            
            if (!catalog) {
                console.error('❌ Elemento #catalog no encontrado en el DOM');
                return;
            }
            
            catalog.classList.remove('table-view');
            catalog.innerHTML = '';
            
            if (products.length === 0) {
                console.warn('⚠️ No hay productos para mostrar');
                catalog.innerHTML = '<p style="text-align: center; padding: 2rem;">No se encontraron vehículos</p>';
                return;
            }
            
            console.log('🎴 Renderizando', products.length, 'productos');
            
            products.forEach((product, index) => {
                console.log(`🎴 Renderizando producto ${index + 1}:`, product);
                
                // 8b: No mostrar "Otro" en miniaturas (sí en tabla)
                if (product.subcategory === 'otros') {
                    console.log('⏭️ Saltando producto "otros"');
                    return; // Skip este producto
                }
                
                const card = document.createElement('div');
                card.className = 'product-card';
                
                // Determinar categoría a mostrar según filtros activos
                const soloAlquiler = activeCategories.size === 1 && activeCategories.has('alquiler');
                const esTerceros = product.categories?.includes('terceros') || product.category === 'terceros';
                const esAlquiler = product.categories?.includes('alquiler') || product.category === 'alquiler';
                const esVenta = product.categories?.includes('venta') || product.category === 'venta';
                const esDual = esVenta && esAlquiler;
                
                // Categoría a mostrar: 
                // - Si es dual y NO se filtra solo por alquiler → mostrar Venta
                // - Si se filtra solo por alquiler → mostrar Alquiler
                // - Si no, mostrar la categoría principal
                let categoryToShow = product.category;
                if (esDual && !soloAlquiler) {
                    categoryToShow = 'venta';
                } else if (soloAlquiler && esAlquiler) {
                    categoryToShow = 'alquiler';
                }
                const categoryText = getCategoryText(categoryToShow);
                
                // Precio:
                // - Si es terceros → Consultar
                // - Si se filtra SOLO por alquiler y tiene precio alquiler → precio alquiler
                // - En cualquier otro caso → precio venta
                let priceText;
                if (esTerceros) {
                    priceText = currentLang === 'es' ? 'Consultar' : 'Consult';
                } else if (soloAlquiler && product.price_rent) {
                    priceText = `${formatNumber(product.price_rent)}€/mes`;
                } else {
                    priceText = product.price ? `${formatNumber(product.price)}€` : (currentLang === 'es' ? 'Consultar' : 'Consult');
                }
                
                let specsHTML = '';
                const specs = getProductSpecs(product);
                specs.forEach(spec => {
                    specsHTML += `
                        <div class="spec-item">
                            <span class="spec-label">${spec.label}</span>
                            <span class="spec-value">${spec.value}</span>
                        </div>
                    `;
                });
                
                // 8c: Banner amarillo para terceros
                const tercerosBanner = esTerceros ? 
                    `<div class="product-terceros-banner">${currentLang === 'es' ? 
                        'Producto de intermediación no comercializado directamente por Tank Iberica' : 
                        'Intermediation product not directly marketed by Tank Iberica'}</div>` : '';
                
                card.innerHTML = `
                    <div class="product-image-container">
                        <img class="product-image" src="${product.images[0]}" alt="${product.model}" data-index="0">
                        ${product.images.length > 1 ? `
                            <div class="image-nav">
                                <button class="image-nav-btn prev">◀</button>
                                <button class="image-nav-btn next">▶</button>
                            </div>
                        ` : ''}
                        <div class="image-indicators">
                            ${product.images.map((_, i) => `<div class="indicator ${i === 0 ? 'active' : ''}"></div>`).join('')}
                        </div>
                        <div class="image-overlay-category">${categoryText}</div>
                        <div class="image-overlay-location">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="#C41E3A" stroke="#C41E3A" stroke-width="2">
                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                <circle cx="12" cy="10" r="3" fill="white"></circle>
                            </svg>
                            <span>${product.location}</span>
                        </div>
                        <div class="image-overlay-price">${priceText}</div>
                    </div>
                    <div class="product-info">
                        ${tercerosBanner}
                        <h3 class="product-title">${generateProductTitle(product)}</h3>
                        <div class="product-specs">${specsHTML}</div>
                    </div>
                `;
                
                if (product.images.length > 1) {
                    let currentImageIndex = 0;
                    const img = card.querySelector('.product-image');
                    const indicators = card.querySelectorAll('.indicator');
                    const prevBtn = card.querySelector('.prev');
                    const nextBtn = card.querySelector('.next');
                    
                    prevBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        currentImageIndex = (currentImageIndex - 1 + product.images.length) % product.images.length;
                        img.src = product.images[currentImageIndex];
                        indicators.forEach((ind, i) => {
                            ind.classList.toggle('active', i === currentImageIndex);
                        });
                    });
                    
                    nextBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        currentImageIndex = (currentImageIndex + 1) % product.images.length;
                        img.src = product.images[currentImageIndex];
                        indicators.forEach((ind, i) => {
                            ind.classList.toggle('active', i === currentImageIndex);
                        });
                    });
                }
                
                card.addEventListener('click', () => showVehicleDetail(product));
                catalog.appendChild(card);
            });
        }
        
        // Helper para generar badges de categorías múltiples
        function getCategoryBadgesHTML(product) {
            let html = '';
            const cats = product.categories && product.categories.length > 0 ? product.categories : [product.category];
            cats.forEach(cat => {
                if (cat) html += `<span class="table-category ${cat}">${getCategoryText(cat)}</span> `;
            });
            return html;
        }

        function renderTableView(products) {
            const catalog = document.getElementById('catalog');
            catalog.classList.add('table-view');
            
            // 9a: Detectar qué columnas tienen valores
            const hasType = products.some(p => p.type);
            const hasVolume = products.some(p => p.volume);
            const hasCapacity = products.some(p => p.capacity);
            const hasCompartments = products.some(p => p.compartments);
            const hasPower = products.some(p => p.power);
            const hasVolumeOrCapacity = hasVolume || hasCapacity;
            
            // Headers dinámicos (solo mostrar columnas con datos)
            let headersHTML = `
                <th>${currentLang === 'es' ? 'Imagen' : 'Image'}</th>
                <th class="sortable" data-sort="category">${currentLang === 'es' ? 'Categoría' : 'Category'}</th>
                <th class="sortable" data-sort="price">${currentLang === 'es' ? 'Precio' : 'Price'}</th>
                <th class="sortable" data-sort="product">${currentLang === 'es' ? 'Producto' : 'Product'}</th>
                ${hasType ? `<th class="sortable" data-sort="type">${currentLang === 'es' ? 'Tipo' : 'Type'}</th>` : ''}
                <th class="sortable" data-sort="brand">${currentLang === 'es' ? 'Marca' : 'Brand'}</th>
                <th class="sortable" data-sort="model">${currentLang === 'es' ? 'Modelo' : 'Model'}</th>
                <th class="sortable" data-sort="year">${currentLang === 'es' ? 'Año' : 'Year'}</th>
                ${hasVolumeOrCapacity ? `<th class="sortable" data-sort="volume">${currentLang === 'es' ? 'Vol./Cap.' : 'Vol./Cap.'}</th>` : ''}
                ${hasCompartments ? `<th class="sortable" data-sort="compartments">${currentLang === 'es' ? 'Comp.' : 'Comp.'}</th>` : ''}
                ${hasPower ? `<th class="sortable" data-sort="power">${currentLang === 'es' ? 'Potencia' : 'Power'}</th>` : ''}
                <th class="sortable" data-sort="location">${currentLang === 'es' ? 'Ubicación' : 'Location'}</th>
                <th style="text-align:center">${currentLang === 'es' ? 'Acciones' : 'Actions'}</th>
            `;
            
            let rowsHTML = '';
            products.forEach(product => {
                const subcategoryName = getSubcategoryName(product.subcategory);
                const brandUpper = product.brand.charAt(0).toUpperCase() + product.brand.slice(1);
                
                // Precio - usar categorías múltiples
                const esTerceros = product.categories?.includes('terceros') || product.category === 'terceros';
                const esAlquiler = product.categories?.includes('alquiler') || product.category === 'alquiler';
                const soloAlquiler = activeCategories.size === 1 && activeCategories.has('alquiler');
                
                let priceText;
                if (esTerceros) {
                    priceText = currentLang === 'es' ? 'Consultar' : 'Consult';
                } else if (soloAlquiler && product.price_rent) {
                    priceText = `${formatNumber(product.price_rent)}€/mes`;
                } else {
                    priceText = product.price ? `${formatNumber(product.price)}€` : (currentLang === 'es' ? 'Consultar' : 'Consult');
                }
                
                // Tipo - Primera letra mayúscula
                let typeText = '-';
                if (product.type) {
                    typeText = product.type.charAt(0).toUpperCase() + product.type.slice(1);
                }
                
                // Modelo - Primera letra mayúscula
                const modelUpper = product.model.charAt(0).toUpperCase() + product.model.slice(1);
                
                // Volumen/Capacidad
                let volumeCapacityText = '-';
                if (product.volume) {
                    volumeCapacityText = formatNumber(product.volume) + ' L';
                } else if (product.capacity) {
                    volumeCapacityText = formatNumber(product.capacity) + ' kg';
                }
                
                // Compartimentos
                let compartmentsText = product.compartments ? product.compartments.toString() : '-';
                
                // Potencia
                let powerText = product.power ? formatNumber(product.power) + ' CV' : '-';
                
                // Favorito SVG
                const isFavorite = userFavorites.has(product.id);
                const favoriteIcon = isFavorite ? 
                    `<svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2">
                        <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                    </svg>` : 
                    `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                    </svg>`;
                const favoriteClass = isFavorite ? 'active' : '';
                
                // Título del producto: usar misma función que fichas y página de vehículo
                const productTitle = generateProductTitle(product);
                
                rowsHTML += `
                    <tr class="table-row" data-product-id="${product.id}">
                        <td><img src="${product.images[0]}" class="table-image" alt="${product.model}"></td>
                        <td>${getCategoryBadgesHTML(product)}</td>
                        <td class="table-price">${priceText}</td>
                        <td>${productTitle}</td>
                        ${hasType ? `<td>${typeText}</td>` : ''}
                        <td>${brandUpper}</td>
                        <td>${modelUpper}</td>
                        <td>${formatNumber(product.year, true)}</td>
                        ${hasVolumeOrCapacity ? `<td>${volumeCapacityText}</td>` : ''}
                        ${hasCompartments ? `<td>${compartmentsText}</td>` : ''}
                        ${hasPower ? `<td>${powerText}</td>` : ''}
                        <td class="table-location">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="#C41E3A" stroke="#C41E3A" stroke-width="2" style="display: inline-block; vertical-align: middle; margin-right: 4px;">
                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                <circle cx="12" cy="10" r="3" fill="white"></circle>
                            </svg>
                            ${product.location}
                        </td>
                        <td class="table-actions-cell">
                            <div style="display:flex;gap:4px;justify-content:center">
                                <button class="table-icon-btn favorite-btn ${favoriteClass}" data-product-id="${product.id}" title="${currentLang === 'es' ? 'Favorito' : 'Favorite'}">
                                    ${favoriteIcon}
                                </button>
                                <button class="table-icon-btn share-btn" data-product-id="${product.id}" title="${currentLang === 'es' ? 'Compartir' : 'Share'}">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2"></path>
                                        <polyline points="7 9 12 4 17 9"></polyline>
                                        <line x1="12" y1="4" x2="12" y2="16"></line>
                                    </svg>
                                </button>
                                <button class="table-icon-btn download-btn" data-product-id="${product.id}" title="${currentLang === 'es' ? 'Descargar folleto' : 'Download brochure'}">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                        <polyline points="14 2 14 8 20 8"></polyline>
                                        <line x1="12" y1="18" x2="12" y2="12"></line>
                                        <polyline points="9 15 12 18 15 15"></polyline>
                                    </svg>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            catalog.innerHTML = `
                <div class="table-wrapper">
                    <table class="catalog-table">
                        <thead>
                            <tr>${headersHTML}</tr>
                        </thead>
                        <tbody id="tableBody">${rowsHTML}</tbody>
                    </table>
                </div>
            `;
            
            // Guardar productos actuales
            currentDisplayedProducts = products;
            
            // 9d: Event listeners para ordenar por columna
            catalog.querySelectorAll('.sortable').forEach(th => {
                th.addEventListener('click', () => {
                    const sortKey = th.dataset.sort;
                    
                    // Cambiar dirección si es la misma columna
                    if (currentSortColumn === sortKey) {
                        currentSortDirection = currentSortDirection === 'asc' ? 'desc' : 'asc';
                    } else {
                        currentSortDirection = 'asc';
                        currentSortColumn = sortKey;
                    }
                    
                    // Añadir "Personalizado" al dropdown
                    const sortSelect = document.getElementById('sortProducts');
                    if (sortSelect) {
                        let customOption = sortSelect.querySelector('option[value="custom"]');
                        if (!customOption) {
                            customOption = document.createElement('option');
                            customOption.value = 'custom';
                            customOption.setAttribute('data-es', 'Personalizado');
                            customOption.setAttribute('data-en', 'Custom');
                            customOption.textContent = currentLang === 'es' ? 'Personalizado' : 'Custom';
                            sortSelect.appendChild(customOption);
                        }
                        sortSelect.value = 'custom';
                    }
                    
                    // Ordenar productos
                    const sortedProducts = sortProductsByColumn(currentDisplayedProducts, sortKey, currentSortDirection);
                    
                    // SOLO actualizar tbody, NO re-renderizar todo
                    updateTableBody(sortedProducts);
                    
                    // Actualizar indicadores visuales
                    catalog.querySelectorAll('.sortable').forEach(h => h.classList.remove('sorted-asc', 'sorted-desc'));
                    th.classList.add(`sorted-${currentSortDirection}`);
                });
            });
            
            // Event listeners para todo (filas, favoritos, compartir)
            setupTableEventListeners(products);
            
            // Setup drag-to-scroll
            setupTableDragScroll();
        }

        // ============================================
        // UPDATE TABLE BODY (sin re-renderizar headers)
        // ============================================
        
        function updateTableBody(products) {
            const tbody = document.getElementById('tableBody');
            if (!tbody) return;
            
            // Detectar columnas visibles (misma lógica que renderTableView)
            const hasType = currentDisplayedProducts.some(p => p.type);
            const hasVolume = currentDisplayedProducts.some(p => p.volume);
            const hasCapacity = currentDisplayedProducts.some(p => p.capacity);
            const hasCompartments = currentDisplayedProducts.some(p => p.compartments);
            const hasPower = currentDisplayedProducts.some(p => p.power);
            const hasVolumeOrCapacity = hasVolume || hasCapacity;
            
            let rowsHTML = '';
            products.forEach(product => {
                const subcategoryName = getSubcategoryName(product.subcategory);
                const brandUpper = product.brand.charAt(0).toUpperCase() + product.brand.slice(1);
                const modelUpper = product.model.charAt(0).toUpperCase() + product.model.slice(1);
                
                // Precio - Si se filtra SOLO por alquiler, mostrar precio alquiler; si no, precio venta
                const esTerceros = product.categories?.includes('terceros') || product.category === 'terceros';
                const soloAlquiler = activeCategories.size === 1 && activeCategories.has('alquiler');
                
                let priceText;
                if (esTerceros) {
                    priceText = currentLang === 'es' ? 'Consultar' : 'Consult';
                } else if (soloAlquiler && product.price_rent) {
                    priceText = `${formatNumber(product.price_rent)}€/mes`;
                } else {
                    priceText = product.price ? `${formatNumber(product.price)}€` : (currentLang === 'es' ? 'Consultar' : 'Consult');
                }
                
                let typeText = '-';
                if (product.type) {
                    typeText = product.type.charAt(0).toUpperCase() + product.type.slice(1);
                }
                
                let volumeCapacityText = '-';
                if (product.volume) {
                    volumeCapacityText = formatNumber(product.volume) + ' L';
                } else if (product.capacity) {
                    volumeCapacityText = formatNumber(product.capacity) + ' kg';
                }
                
                let compartmentsText = product.compartments ? product.compartments.toString() : '-';
                let powerText = product.power ? formatNumber(product.power) + ' CV' : '-';
                
                const isFavorite = userFavorites.has(product.id);
                const favoriteIcon = isFavorite ? 
                    `<svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2">
                        <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                    </svg>` : 
                    `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                    </svg>`;
                const favoriteClass = isFavorite ? 'active' : '';
                
                rowsHTML += `
                    <tr class="table-row" data-product-id="${product.id}">
                        <td><img src="${product.images[0]}" class="table-image" alt="${product.model}"></td>
                        <td>${getCategoryBadgesHTML(product)}</td>
                        <td class="table-price">${priceText}</td>
                        <td>${subcategoryName}</td>
                        ${hasType ? `<td>${typeText}</td>` : ''}
                        <td>${brandUpper}</td>
                        <td>${modelUpper}</td>
                        <td>${formatNumber(product.year, true)}</td>
                        ${hasVolumeOrCapacity ? `<td>${volumeCapacityText}</td>` : ''}
                        ${hasCompartments ? `<td>${compartmentsText}</td>` : ''}
                        ${hasPower ? `<td>${powerText}</td>` : ''}
                        <td class="table-location">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="#C41E3A" stroke="#C41E3A" stroke-width="2" style="display: inline-block; vertical-align: middle; margin-right: 4px;">
                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                <circle cx="12" cy="10" r="3" fill="white"></circle>
                            </svg>
                            ${product.location}
                        </td>
                        <td>
                            <button class="table-icon-btn favorite-btn ${favoriteClass}" data-product-id="${product.id}">
                                ${favoriteIcon}
                            </button>
                        </td>
                        <td>
                            <button class="table-icon-btn share-btn" data-product-id="${product.id}">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2"></path>
                                    <polyline points="7 9 12 4 17 9"></polyline>
                                    <line x1="12" y1="4" x2="12" y2="16"></line>
                                </svg>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = rowsHTML;
            
            // Re-aplicar event listeners
            setupTableEventListeners(products);
        }
        
        function setupTableEventListeners(products) {
            const catalog = document.getElementById('catalog');
            
            // Event listeners filas
            catalog.querySelectorAll('.table-row').forEach((row, index) => {
                row.addEventListener('click', (e) => {
                    if (e.target.classList.contains('table-icon-btn') || 
                        e.target.closest('.table-icon-btn')) {
                        return;
                    }
                    showVehicleDetail(products[index]);
                });
            });
            
            // Event listeners favoritos
            catalog.querySelectorAll('.favorite-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const productId = parseInt(btn.dataset.productId);
                    
                    if (userFavorites.has(productId)) {
                        userFavorites.delete(productId);
                        btn.classList.remove('active');
                        btn.innerHTML = `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                        </svg>`;
                    } else {
                        userFavorites.add(productId);
                        btn.classList.add('active');
                        btn.innerHTML = `<svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2">
                            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                        </svg>`;
                    }
                });
            });
            
            // Event listeners compartir
            catalog.querySelectorAll('.share-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const productId = parseInt(btn.dataset.productId);
                    const product = products.find(p => p.id === productId);
                    
                    if (navigator.share) {
                        navigator.share({
                            title: generateProductTitle(product),
                            text: `${generateProductTitle(product)} - ${formatNumber(product.price)}€`,
                            url: window.location.href
                        }).catch(() => {});
                    } else {
                        const shareText = `${generateProductTitle(product)} - ${formatNumber(product.price)}€`;
                        navigator.clipboard.writeText(shareText).then(() => {
                            alert(currentLang === 'es' ? 'Enlace copiado' : 'Link copied');
                        });
                    }
                });
            });
            
            // Event listeners descargar folleto PDF
            catalog.querySelectorAll('.download-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const productId = parseInt(btn.dataset.productId);
                    const product = products.find(p => p.id === productId);
                    if (product) {
                        generarFolletoPDF(product);
                    }
                });
            });
        }

        // ============================================
        // 9d: SORT PRODUCTS BY COLUMN
        // ============================================
        
        function sortProductsByColumn(products, column, direction) {
            const sortedProducts = [...products];
            
            sortedProducts.sort((a, b) => {
                let aVal, bVal;
                
                switch(column) {
                    case 'category':
                        aVal = a.category;
                        bVal = b.category;
                        break;
                    case 'price':
                        aVal = a.price || 0;
                        bVal = b.price || 0;
                        break;
                    case 'product':
                        aVal = a.subcategory;
                        bVal = b.subcategory;
                        break;
                    case 'type':
                        aVal = a.type || '';
                        bVal = b.type || '';
                        break;
                    case 'brand':
                        aVal = a.brand;
                        bVal = b.brand;
                        break;
                    case 'model':
                        aVal = a.model;
                        bVal = b.model;
                        break;
                    case 'year':
                        aVal = a.year || 0;
                        bVal = b.year || 0;
                        break;
                    case 'volume':
                        aVal = a.volume || a.capacity || 0;
                        bVal = b.volume || b.capacity || 0;
                        break;
                    case 'compartments':
                        aVal = a.compartments || 0;
                        bVal = b.compartments || 0;
                        break;
                    case 'power':
                        aVal = a.power || 0;
                        bVal = b.power || 0;
                        break;
                    case 'location':
                        aVal = a.location;
                        bVal = b.location;
                        break;
                    default:
                        return 0;
                }
                
                // Comparar según tipo
                if (typeof aVal === 'string') {
                    return direction === 'asc' ? 
                        aVal.localeCompare(bVal) : 
                        bVal.localeCompare(aVal);
                } else {
                    return direction === 'asc' ? 
                        aVal - bVal : 
                        bVal - aVal;
                }
            });
            
            return sortedProducts;
        }

        // ============================================
        // TABLE DRAG-TO-SCROLL
        // ============================================
        
        function setupTableDragScroll() {
            const tableWrapper = document.querySelector('.table-wrapper');
            if (!tableWrapper) return;
            
            let isDown = false;
            let startX;
            let scrollLeft;
            
            tableWrapper.addEventListener('mousedown', (e) => {
                // Solo activar si no se hace click en botones
                if (e.target.classList.contains('table-icon-btn') || 
                    e.target.closest('.table-icon-btn')) {
                    return;
                }
                
                isDown = true;
                tableWrapper.classList.add('active');
                startX = e.pageX - tableWrapper.offsetLeft;
                scrollLeft = tableWrapper.scrollLeft;
                tableWrapper.style.cursor = 'grabbing';
            });
            
            tableWrapper.addEventListener('mouseleave', () => {
                isDown = false;
                tableWrapper.classList.remove('active');
                tableWrapper.style.cursor = 'grab';
            });
            
            tableWrapper.addEventListener('mouseup', () => {
                isDown = false;
                tableWrapper.classList.remove('active');
                tableWrapper.style.cursor = 'grab';
            });
            
            tableWrapper.addEventListener('mousemove', (e) => {
                if (!isDown) return;
                e.preventDefault();
                const x = e.pageX - tableWrapper.offsetLeft;
                const walk = (x - startX) * 2; // Velocidad del scroll
                tableWrapper.scrollLeft = scrollLeft - walk;
            });
            
            // Touch support para móviles
            let touchStartX;
            let touchScrollLeft;
            
            tableWrapper.addEventListener('touchstart', (e) => {
                touchStartX = e.touches[0].pageX - tableWrapper.offsetLeft;
                touchScrollLeft = tableWrapper.scrollLeft;
            }, { passive: true });
            
            tableWrapper.addEventListener('touchmove', (e) => {
                const x = e.touches[0].pageX - tableWrapper.offsetLeft;
                const walk = (x - touchStartX) * 2;
                tableWrapper.scrollLeft = touchScrollLeft - walk;
            }, { passive: true });
        }

        function getCategoryText(category) {
            if (currentLang === 'es') {
                return category === 'alquiler' ? 'Alquiler' : 
                       category === 'venta' ? 'Venta' : 'Terceros';
            } else {
                return category === 'alquiler' ? 'Rental' : 
                       category === 'venta' ? 'Sale' : 'Third Party';
            }
        }

        function getProductSpecs(product) {
            const specs = [];
            const excludeKeys = ['marca', 'modelo', 'año', 'brand', 'model', 'year'];
            
            // Función para buscar filtro en publicados u ocultos
            const buscarFiltro = (key) => {
                return window.filtrosFromSheets?.find(f => (f.nombre || '').toLowerCase() === key.toLowerCase()) ||
                       window.filtrosOcultosFromSheets?.find(f => (f.nombre || '').toLowerCase() === key.toLowerCase());
            };
            
            // Primero añadir filtros (tienen prioridad)
            if (product.filtros_json && typeof product.filtros_json === 'object') {
                Object.entries(product.filtros_json).forEach(([key, value]) => {
                    const displayValue = getFiltroValue(value);
                    if (displayValue && !excludeKeys.includes(key.toLowerCase())) {
                        // Buscar nombre en inglés si está disponible
                        const filtro = buscarFiltro(key);
                        const label = currentLang === 'en' && filtro?.nombre_en ? filtro.nombre_en : key;
                        specs.push({ label: label, value: displayValue });
                    }
                });
            }
            
            // Completar con características adicionales hasta 6
            if (specs.length < 6 && product.caracteristicas_json && typeof product.caracteristicas_json === 'object') {
                Object.entries(product.caracteristicas_json).forEach(([key, value]) => {
                    if (specs.length < 6 && value && !excludeKeys.includes(key.toLowerCase())) {
                        specs.push({ label: key, value: String(value) });
                    }
                });
            }
            
            return specs.slice(0, 6);
        }
// ============================================
        // VEHICLE DETAIL MODAL - GAMMA STYLE
        // ============================================
        function showVehicleDetail(product) {
            selectedProduct = product;
            currentVehicleImageIndex = 0;
            const modal = document.getElementById('vehicleDetailModal');
            
            document.getElementById('vehicleName').textContent = generateProductTitle(product);
            
            // Precio - Si se filtra SOLO por alquiler, mostrar precio alquiler; si no, precio venta
            const esTerceros = product.categories?.includes('terceros') || product.category === 'terceros';
            const esVenta = product.categories?.includes('venta') || product.category === 'venta';
            const esAlquiler = product.categories?.includes('alquiler') || product.category === 'alquiler';
            const soloAlquiler = activeCategories.size === 1 && activeCategories.has('alquiler');
            const esDual = esVenta && esAlquiler;
            
            let priceText;
            if (esTerceros) {
                priceText = currentLang === 'es' ? 'Consultar' : 'Consult';
            } else if (soloAlquiler && product.price_rent) {
                priceText = `${formatNumber(product.price_rent)}€/mes`;
            } else {
                priceText = product.price ? `${formatNumber(product.price)}€` : (currentLang === 'es' ? 'Consultar' : 'Consult');
            }
            document.getElementById('vehiclePrice').textContent = priceText;
            
            // 14b: Actualizar categoría badge - Si es dual y no se filtra solo alquiler, mostrar Venta
            let categoryToShow = product.category;
            if (esDual && !soloAlquiler) {
                categoryToShow = 'venta';
            } else if (soloAlquiler && esAlquiler) {
                categoryToShow = 'alquiler';
            }
            const categoryBadge = document.getElementById('vehicleCategory');
            categoryBadge.textContent = getCategoryText(categoryToShow);
            categoryBadge.className = `vehicle-category-badge ${categoryToShow}`;
            
            // 14b: Actualizar ubicación
            document.getElementById('vehicleLocation').innerHTML = `
                <svg width="14" height="14" viewBox="0 0 24 24" fill="#C41E3A" stroke="#C41E3A" stroke-width="2" style="display: inline-block; vertical-align: middle; margin-right: 4px;">
                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                    <circle cx="12" cy="10" r="3" fill="white"></circle>
                </svg>
                ${product.location}
            `;
            
            if (esTerceros) {
                document.getElementById('vehicleDisclaimerContainer').textContent = translations[currentLang].disclaimer;
            } else {
                document.getElementById('vehicleDisclaimerContainer').textContent = '';
            }
            
            document.getElementById('vehicleMainImage').src = product.images[0];
            
            const thumbnailsHTML = product.images.map((img, index) => `
                <img src="${img}" class="vehicle-thumbnail ${index === 0 ? 'active' : ''}" data-index="${index}" alt="Thumbnail ${index + 1}">
            `).join('');
            document.getElementById('vehicleThumbnailsContainer').innerHTML = thumbnailsHTML;
            
            document.querySelectorAll('.vehicle-thumbnail').forEach(thumb => {
                thumb.addEventListener('click', () => {
                    const index = parseInt(thumb.dataset.index);
                    currentVehicleImageIndex = index;
                    document.getElementById('vehicleMainImage').src = product.images[index];
                    document.querySelectorAll('.vehicle-thumbnail').forEach(t => t.classList.remove('active'));
                    thumb.classList.add('active');
                });
            });
            
            document.getElementById('vehicleDescriptionText').textContent = currentLang === 'en' && product.description_en ? product.description_en : product.description;
            
            // Generar grid de características (sin Marca, Modelo, Año - ya están en el título)
            const charGridHTML = [];
            const excludeKeys = ['marca', 'modelo', 'año', 'brand', 'model', 'year'];
            
            // Función para buscar filtro en publicados u ocultos
            const buscarFiltro = (key) => {
                return window.filtrosFromSheets?.find(f => (f.nombre || '').toLowerCase() === key.toLowerCase()) ||
                       window.filtrosOcultosFromSheets?.find(f => (f.nombre || '').toLowerCase() === key.toLowerCase());
            };
            
            // Añadir filtros_json
            if (product.filtros_json && typeof product.filtros_json === 'object') {
                Object.entries(product.filtros_json).forEach(([key, value]) => {
                    const displayValue = getFiltroValue(value);
                    if (displayValue && !excludeKeys.includes(key.toLowerCase())) {
                        const filtro = buscarFiltro(key);
                        const label = currentLang === 'en' && filtro?.nombre_en ? filtro.nombre_en : key;
                        charGridHTML.push(`
                            <div class="vehicle-char-item">
                                <span class="vehicle-char-label">${label.toUpperCase()}</span>
                                <span class="vehicle-char-value">${displayValue}</span>
                            </div>
                        `);
                    }
                });
            }
            
            // Añadir caracteristicas_json
            if (product.caracteristicas_json && typeof product.caracteristicas_json === 'object') {
                Object.entries(product.caracteristicas_json).forEach(([key, value]) => {
                    if (value && !excludeKeys.includes(key.toLowerCase())) {
                        charGridHTML.push(`
                            <div class="vehicle-char-item">
                                <span class="vehicle-char-label">${key.toUpperCase()}</span>
                                <span class="vehicle-char-value">${value}</span>
                            </div>
                        `);
                    }
                });
            }
            
            document.getElementById('vehicleCharGrid').innerHTML = charGridHTML.join('');
            
            const favoriteBtn = document.getElementById('vehicleFavoriteBtn');
            if (userFavorites.has(product.id)) {
                favoriteBtn.classList.add('active');
                favoriteBtn.innerHTML = `<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2">
                    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                </svg>`;
            } else {
                favoriteBtn.classList.remove('active');
                favoriteBtn.innerHTML = `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                </svg>`;
            }
            
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
            
            // Event listener para el botón sticky dentro del modal de vehículo
            const vehicleSticky = document.getElementById('vehicleStickyNotification');
            console.log('🔍 vehicleStickyNotification:', vehicleSticky);
            
            if (vehicleSticky) {
                // Remover event listeners anteriores para evitar duplicados
                const newVehicleSticky = vehicleSticky.cloneNode(true);
                vehicleSticky.parentNode.replaceChild(newVehicleSticky, vehicleSticky);
                
                console.log('✅ vehicleStickyNotification encontrado y clonado');
                
                // Añadir nuevo event listener
                newVehicleSticky.addEventListener('click', () => {
                    console.log('🔵 Click en vehicleStickyNotification detectado!');
                    const demandModal = document.getElementById('demandModal');
                    console.log('🔍 demandModal desde vehicleSticky:', demandModal);
                    if (demandModal) {
                        demandModal.classList.add('active');
                        document.body.style.overflow = 'hidden';
                        console.log('✅ Modal Demand abierto desde vehículo');
                    } else {
                        console.error('❌ Modal Demand NO encontrado desde vehículo');
                    }
                });
            } else {
                console.error('❌ vehicleStickyNotification NO encontrado');
            }
        }

        document.getElementById('vehicleCloseBtn').addEventListener('click', () => {
            document.getElementById('vehicleDetailModal').classList.remove('active');
            document.body.style.overflow = '';
        });
        
        // 12a: Click en backdrop cierra modal
        document.getElementById('vehicleDetailModal').addEventListener('click', (e) => {
            if (e.target.id === 'vehicleDetailModal') {
                document.getElementById('vehicleDetailModal').classList.remove('active');
                document.body.style.overflow = '';
            }
        });

        document.getElementById('vehicleImagePrev').addEventListener('click', () => {
            if (!selectedProduct) return;
            currentVehicleImageIndex = (currentVehicleImageIndex - 1 + selectedProduct.images.length) % selectedProduct.images.length;
            document.getElementById('vehicleMainImage').src = selectedProduct.images[currentVehicleImageIndex];
            document.querySelectorAll('.vehicle-thumbnail').forEach((t, i) => {
                t.classList.toggle('active', i === currentVehicleImageIndex);
            });
        });

        document.getElementById('vehicleImageNext').addEventListener('click', () => {
            if (!selectedProduct) return;
            currentVehicleImageIndex = (currentVehicleImageIndex + 1) % selectedProduct.images.length;
            document.getElementById('vehicleMainImage').src = selectedProduct.images[currentVehicleImageIndex];
            document.querySelectorAll('.vehicle-thumbnail').forEach((t, i) => {
                t.classList.toggle('active', i === currentVehicleImageIndex);
            });
        });

        document.getElementById('vehicleContactBtn').addEventListener('click', () => {
            document.getElementById('contactModal').classList.add('active');
        });

        document.getElementById('vehicleShareBtn').addEventListener('click', () => {
            if (navigator.share) {
                navigator.share({
                    title: generateProductTitle(selectedProduct),
                    text: selectedProduct.description,
                    url: window.location.href
                });
            } else {
                alert(currentLang === 'es' ? 'Enlace copiado' : 'Link copied');
            }
        });

        document.getElementById('vehicleFavoriteBtn').addEventListener('click', () => {
            if (!isUserLoggedIn) {
                document.getElementById('favoritesNotification').classList.add('active');
                return;
            }
            
            const btn = document.getElementById('vehicleFavoriteBtn');
            if (userFavorites.has(selectedProduct.id)) {
                userFavorites.delete(selectedProduct.id);
                btn.classList.remove('active');
                btn.innerHTML = `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                </svg>`;
            } else {
                userFavorites.add(selectedProduct.id);
                btn.classList.add('active');
                btn.innerHTML = `<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2">
                    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                </svg>`;
            }
        });
        // =====================================================
        // GENERADOR DE FOLLETO PDF
        // =====================================================
        
        // Cargar jsPDF dinámicamente
        const jspdfScript = document.createElement('script');
        jspdfScript.src = 'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js';
        document.head.appendChild(jspdfScript);
        
        async function generarFolletoPDF(product) {
            if (typeof window.jspdf === 'undefined') {
                alert(currentLang === 'es' ? 'Cargando... Intente de nuevo en un momento.' : 'Loading... Please try again in a moment.');
                return;
            }
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('p', 'mm', 'a4');
            const pageWidth = 210;
            const pageHeight = 297;
            const margin = 12;
            const contentWidth = pageWidth - (margin * 2);
            
            // Colores corporativos
            const petrolBlue = [15, 42, 46];
            const white = [255, 255, 255];
            
            // ========== CALCULAR CONTENIDO PARA ADAPTAR TAMAÑOS ==========
            const numImages = product.images ? product.images.length : 0;
            const hasDescription = product.description && product.description.length > 0;
            const descLength = hasDescription ? product.description.length : 0;
            
            // Recopilar caracteristicas
            const caracteristicas = [];
            if (product.filtros_json) {
                Object.entries(product.filtros_json).forEach(([key, value]) => {
                    const displayValue = getFiltroValue(value);
                    if (displayValue && !['marca', 'modelo', 'ano', 'year', 'brand', 'model'].includes(key.toLowerCase())) {
                        caracteristicas.push({ label: key, value: displayValue });
                    }
                });
            }
            if (product.caracteristicas_json) {
                Object.entries(product.caracteristicas_json).forEach(([key, value]) => {
                    if (value) caracteristicas.push({ label: key, value: String(value) });
                });
            }
            
            // Calcular espacio disponible y adaptar tamaños
            const headerHeight = 32;
            const footerHeight = 14;
            const titleHeight = 22;
            const charsHeight = Math.min(caracteristicas.length * 4.5 + 8, 45);
            const descHeight = hasDescription ? Math.min(Math.ceil(descLength / 80) * 4 + 10, 40) : 0;
            const galleryNeeded = numImages > 1;
            
            // Espacio disponible para imagenes
            const fixedContent = headerHeight + titleHeight + charsHeight + descHeight + footerHeight + 20;
            const availableForImages = pageHeight - fixedContent;
            
            // Distribuir espacio entre portada y galeria
            let portadaHeight, galleryHeight;
            if (galleryNeeded) {
                portadaHeight = Math.min(Math.max(availableForImages * 0.6, 50), 85);
                galleryHeight = Math.min(Math.max(availableForImages * 0.35, 25), 45);
            } else {
                portadaHeight = Math.min(Math.max(availableForImages * 0.9, 60), 100);
                galleryHeight = 0;
            }
            
            // ========== HEADER ==========
            doc.setFillColor(...petrolBlue);
            doc.rect(0, 0, pageWidth, headerHeight, 'F');
            
            try {
                const logoUrl = 'https://lh3.googleusercontent.com/d/1LoKrBHe5pLXYdXDAhNdMTiP4Xkm_jDbD';
                const logoImg = await loadImageAsBase64(logoUrl);
                if (logoImg) {
                    doc.addImage(logoImg, 'PNG', margin, 9, 75, 11);
                }
            } catch(e) {
                doc.setTextColor(...white);
                doc.setFontSize(18);
                doc.setFont('helvetica', 'bold');
                doc.text('TANK IBERICA', margin, 20);
            }
            
            doc.setTextColor(...white);
            doc.setFontSize(8);
            doc.setFont('helvetica', 'normal');
            const contactX = pageWidth - margin;
            doc.text('TANKIBERICA.COM', contactX, 12, { align: 'right' });
            doc.text(translations[currentLang]?.email || 'info@tankiberica.com', contactX, 18, { align: 'right' });
            doc.text(translations[currentLang]?.phone || '+34 645 779 594', contactX, 24, { align: 'right' });
            
            let yPos = headerHeight + 8;
            
            // ========== IMAGEN PORTADA ==========
            const portadaIndex = product.portada_index || 0;
            const imagenPortada = product.images?.[portadaIndex] || product.images?.[0];
            
            if (imagenPortada) {
                try {
                    const mainImg = await loadImageAsBase64(imagenPortada);
                    if (mainImg) {
                        // Mantener aspect ratio 4:3
                        let imgWidth = contentWidth;
                        let imgHeight = imgWidth * 0.5625;
                        
                        if (imgHeight > portadaHeight) {
                            imgHeight = portadaHeight;
                            imgWidth = imgHeight / 0.5625;
                        }
                        
                        const xOffset = margin + (contentWidth - imgWidth) / 2;
                        doc.addImage(mainImg, 'JPEG', xOffset, yPos, imgWidth, imgHeight);
                        yPos += imgHeight + 6;
                    }
                } catch(e) {
                    yPos += 10;
                }
            }
            
            // ========== TITULO Y PRECIO ==========
            doc.setTextColor(31, 42, 42);
            doc.setFontSize(16);
            doc.setFont('helvetica', 'bold');
            const titulo = generateProductTitle(product);
            doc.text(titulo, margin, yPos);
            yPos += 6;
            
            // Precio
            const esTerceros = product.categories?.includes('terceros') || product.category === 'terceros';
            let priceText;
            if (esTerceros) {
                priceText = currentLang === 'es' ? 'Precio: Consultar' : 'Price: Consult';
            } else if (product.price) {
                priceText = (currentLang === 'es' ? 'Precio: ' : 'Price: ') + formatNumber(product.price) + ' EUR';
            } else {
                priceText = currentLang === 'es' ? 'Precio: Consultar' : 'Price: Consult';
            }
            doc.setFontSize(12);
            doc.setTextColor(...petrolBlue);
            doc.text(priceText, margin, yPos);
            yPos += 5;
            
            // Ubicacion
            if (product.location) {
                doc.setFontSize(9);
                doc.setTextColor(74, 90, 90);
                doc.setFont('helvetica', 'normal');
                doc.text((currentLang === 'es' ? 'Ubicacion: ' : 'Location: ') + product.location, margin, yPos);
                yPos += 6;
            }
            
            // ========== CARACTERISTICAS ==========
            doc.setDrawColor(...petrolBlue);
            doc.setLineWidth(0.3);
            doc.line(margin, yPos, pageWidth - margin, yPos);
            yPos += 5;
            
            doc.setFontSize(10);
            doc.setFont('helvetica', 'bold');
            doc.setTextColor(31, 42, 42);
            doc.text(currentLang === 'es' ? 'CARACTERISTICAS' : 'SPECIFICATIONS', margin, yPos);
            yPos += 5;
            
            doc.setFontSize(8);
            const colWidth = contentWidth / 2;
            let col = 0;
            const maxChars = 10;
            
            caracteristicas.slice(0, maxChars).forEach(car => {
                const xPos = margin + (col * colWidth);
                doc.setFont('helvetica', 'bold');
                doc.setTextColor(74, 90, 90);
                doc.text(car.label + ':', xPos, yPos);
                doc.setFont('helvetica', 'normal');
                doc.setTextColor(31, 42, 42);
                const labelWidth = Math.min(doc.getTextWidth(car.label + ': '), 28);
                doc.text(car.value.substring(0, 20), xPos + labelWidth + 1, yPos);
                
                col++;
                if (col >= 2) {
                    col = 0;
                    yPos += 4.5;
                }
            });
            if (col === 1) yPos += 4.5;
            yPos += 3;
            
            // ========== GALERIA DE IMAGENES ==========
            if (numImages > 1 && galleryHeight > 0) {
                doc.setDrawColor(...petrolBlue);
                doc.line(margin, yPos, pageWidth - margin, yPos);
                yPos += 5;
                
                doc.setFontSize(10);
                doc.setFont('helvetica', 'bold');
                doc.setTextColor(31, 42, 42);
                doc.text(currentLang === 'es' ? 'GALERIA DE IMAGENES' : 'IMAGE GALLERY', margin, yPos);
                yPos += 5;
                
                // Calcular tamaño de thumbnails
                const maxThumbsPerRow = 4;
                const thumbGap = 4;
                const thumbWidth = (contentWidth - (thumbGap * (maxThumbsPerRow - 1))) / maxThumbsPerRow;
                const thumbHeight = Math.min(thumbWidth * 0.65, galleryHeight - 10);
                
                let thumbX = margin;
                let thumbCount = 0;
                
                for (let i = 0; i < product.images.length && thumbCount < 8; i++) {
                    if (i === portadaIndex) continue;
                    
                    try {
                        const thumbImg = await loadImageAsBase64(product.images[i]);
                        if (thumbImg) {
                            doc.addImage(thumbImg, 'JPEG', thumbX, yPos, thumbWidth, thumbHeight);
                            thumbX += thumbWidth + thumbGap;
                            thumbCount++;
                            
                            if (thumbCount % maxThumbsPerRow === 0) {
                                thumbX = margin;
                                yPos += thumbHeight + 3;
                            }
                        }
                    } catch(e) {}
                }
                
                if (thumbCount % maxThumbsPerRow !== 0) {
                    yPos += thumbHeight + 3;
                }
                yPos += 2;
            }
            
            // ========== DESCRIPCION ==========
            if (hasDescription) {
                doc.setDrawColor(...petrolBlue);
                doc.line(margin, yPos, pageWidth - margin, yPos);
                yPos += 5;
                
                doc.setFontSize(10);
                doc.setFont('helvetica', 'bold');
                doc.setTextColor(31, 42, 42);
                doc.text(currentLang === 'es' ? 'DESCRIPCION' : 'DESCRIPTION', margin, yPos);
                yPos += 5;
                
                doc.setFontSize(8);
                doc.setFont('helvetica', 'normal');
                doc.setTextColor(74, 90, 90);
                
                const descripcion = currentLang === 'en' && product.description_en ? product.description_en : product.description;
                const splitDesc = doc.splitTextToSize(descripcion, contentWidth);
                
                // Calcular cuantas lineas caben hasta el footer
                const remainingSpace = pageHeight - yPos - footerHeight - 5;
                const maxLines = Math.floor(remainingSpace / 4);
                const linesToShow = splitDesc.slice(0, Math.max(maxLines, 3));
                
                linesToShow.forEach(line => {
                    doc.text(line, margin, yPos);
                    yPos += 4;
                });
                
                if (splitDesc.length > linesToShow.length) {
                    doc.text('...', margin, yPos);
                }
            }
            
            // ========== FOOTER ==========
            const footerY = pageHeight - footerHeight;
            doc.setFillColor(...petrolBlue);
            doc.rect(0, footerY, pageWidth, footerHeight, 'F');
            
            doc.setFontSize(8);
            doc.setTextColor(...white);
            doc.text('TANKIBERICA.COM', pageWidth / 2, footerY + 8, { align: 'center' });
            
            // ========== GUARDAR ==========
            const fileName = 'TankIberica_' + (product.brand || '') + '_' + (product.model || '') + '.pdf';
            doc.save(fileName.replace(/\s+/g, '_'));
        }
        
        // Función auxiliar para cargar imagen como base64
        async function loadImageAsBase64(url) {
            return new Promise((resolve) => {
                const img = new Image();
                img.crossOrigin = 'anonymous';
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    canvas.width = img.width;
                    canvas.height = img.height;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0);
                    try {
                        resolve(canvas.toDataURL('image/jpeg', 0.8));
                    } catch(e) {
                        resolve(null);
                    }
                };
                img.onerror = () => resolve(null);
                // Usar proxy para evitar CORS
                img.src = url;
            });
        }
        
        // Event listener para el botón PDF
        document.getElementById('vehiclePdfBtn').addEventListener('click', () => {
            if (selectedProduct) {
                generarFolletoPDF(selectedProduct);
            }
        });


        // ============================================
        // CONTACT MODAL
        // ============================================
        document.getElementById('contactModalClose').addEventListener('click', () => {
            document.getElementById('contactModal').classList.remove('active');
        });
        
        // 12a: Click en backdrop cierra modal
        document.getElementById('contactModal').addEventListener('click', (e) => {
            if (e.target.id === 'contactModal') {
                document.getElementById('contactModal').classList.remove('active');
            }
        });

        // ============================================
        // NEWS SECTION
        // ============================================
        function renderNews() {
            const newsGrid = document.getElementById('newsGrid');
            const topNewsList = document.getElementById('topNewsList');
            
            const sevenDaysAgo = new Date();
            sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
            
            const recentNews = sampleNews.filter(news => {
                const newsDate = new Date(news.date.split('/').reverse().join('-'));
                return newsDate >= sevenDaysAgo;
            });
            
            const sortedByViews = [...recentNews].sort((a, b) => b.views - a.views);
            const top3 = sortedByViews.slice(0, 3);
            
            topNewsList.innerHTML = top3.map((news, index) => {
                const medals = ['🥇', '🥈', '🥉'];
                return `
                    <a href="#" class="top-news-item" data-news-id="${news.id}">
                        <span>${medals[index]}</span>
                        <span>${news.title[currentLang]}</span>
                    </a>
                `;
            }).join('');
            
            document.querySelectorAll('.top-news-item').forEach(item => {
                item.onclick = (e) => {
                    e.preventDefault();
                    const news = sampleNews.find(n => n.id === parseInt(item.dataset.newsId));
                    if (news) showNewsModal(news, false); // NO scroll a comentarios, abrir desde arriba
                };
            });
            
            // Si todas las cajas están activadas o ninguna está activada, mostrar todas
            const allFilters = ['press', 'newsletters', 'featured', 'events'];
            const effectiveFilters = (activeNewsFilters.length === 0 || activeNewsFilters.length === allFilters.length) 
                ? allFilters 
                : activeNewsFilters;
            
            let filteredNews = sampleNews.filter(news => 
                effectiveFilters.includes(news.category) && news.recent
            );
            
            // 16a: Aplicar búsqueda fuzzy si hay query
            if (currentNewsSearchQuery && currentNewsSearchQuery.trim().length > 0) {
                filteredNews = filteredNews.filter(news => {
                    const searchStr = `${news.title.es} ${news.title.en} ${news.subtitle.es} ${news.subtitle.en} ${news.hashtags.join(' ')}`;
                    return fuzzySearch(searchStr, currentNewsSearchQuery);
                });
            }
            
            newsGrid.innerHTML = '';
            
            filteredNews.slice(0, 9).forEach((news, index) => {
                const card = document.createElement('div');
                card.className = 'news-card';
                
                const categoryLabel = getCategoryLabel(news.category);
                
                card.innerHTML = `
                    <div class="news-image-container">
                        <img src="${news.image}" alt="${news.title[currentLang]}" class="news-image">
                        <div class="news-image-overlay">
                            <span class="news-date-badge">${news.date}</span>
                            <span class="news-category-badge">${categoryLabel}</span>
                        </div>
                        <div class="news-comments-badge">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                            </svg>
                            <span>${news.comments ? news.comments.length : 0}</span>
                        </div>
                    </div>
                    <div class="news-content">
                        <h3 class="news-title">${news.title[currentLang]}</h3>
                        <p class="news-subtitle">${news.subtitle[currentLang]}</p>
                    </div>
                `;
                card.onclick = () => showNewsModal(news);
                newsGrid.appendChild(card);
            });
        }

        function getCategoryLabel(category) {
            if (currentLang === 'es') {
                return category === 'press' ? 'Área de prensa' : 
                       category === 'newsletters' ? 'Boletines' : 
                       category === 'featured' ? 'Destacados' : 'Eventos';
            } else {
                return category === 'press' ? 'Newsroom' : 
                       category === 'newsletters' ? 'Newsletters' : 
                       category === 'featured' ? 'Featured' : 'Events';
            }
        }

        function showNewsModal(news, scrollToComments = false) {
            selectedNews = news;
            document.getElementById('newsModal').classList.add('active');
            document.getElementById('newsModal').scrollTop = 0;
            
            document.getElementById('newsModalImage').src = news.image;
            document.getElementById('newsModalDate').textContent = news.date;
            document.getElementById('newsModalTitle').textContent = news.title[currentLang];
            document.getElementById('newsModalSubtitle').textContent = news.subtitle[currentLang];
            document.getElementById('newsModalText').textContent = news.text[currentLang];
            
            // 15a: Actualizar contador de comentarios en badge del modal
            const commentsCount = news.comments ? news.comments.length : 0;
            document.getElementById('newsModalCommentsCount').textContent = commentsCount;
            
            const categoryHashtag = `#${getCategoryLabel(news.category).replace(/ /g, '_')}`;
            const hashtagsContainer = document.getElementById('newsModalHashtags');
            hashtagsContainer.innerHTML = [categoryHashtag, ...news.hashtags].map(tag => 
                `<span class="hashtag" data-hashtag="${tag}">${tag}</span>`
            ).join('');
            
            document.querySelectorAll('.hashtag').forEach(tag => {
                tag.addEventListener('click', () => {
                    const hashtag = tag.dataset.hashtag;
                    showHashtagView(hashtag);
                });
            });
            
            renderComments();
            
            // 15d: Scroll automático a comentarios si se solicita
            if (scrollToComments) {
                setTimeout(() => {
                    const commentsSection = document.querySelector('.comments-section');
                    if (commentsSection) {
                        commentsSection.scrollIntoView({ 
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                }, 300);
            }
        }

        function showHashtagView(hashtag) {
            document.querySelector('.comments-section').style.display = 'none';
            document.getElementById('hashtagView').classList.add('active');
            document.getElementById('hashtagViewTitle').textContent = hashtag;
            
            // Scroll al inicio del modal
            const newsModal = document.getElementById('newsModal');
            newsModal.scrollTop = 0;
            
            const relatedNews = sampleNews.filter(n => {
                const categoryHashtag = `#${getCategoryLabel(n.category).replace(/ /g, '_')}`;
                return n.hashtags.includes(hashtag) || categoryHashtag === hashtag;
            });
            
            const byViews = [...relatedNews].sort((a, b) => b.views - a.views).slice(0, 10);
            const byDate = [...relatedNews].sort((a, b) => {
                const dateA = new Date(a.date.split('/').reverse().join('-'));
                const dateB = new Date(b.date.split('/').reverse().join('-'));
                return dateB - dateA;
            }).slice(0, 10);
            const byRelevance = [...relatedNews].slice(0, 10);
            
            document.getElementById('hashtagTopViews').innerHTML = byViews.map(n => `
                <div class="hashtag-news-item" onclick="showNewsModal(sampleNews.find(news => news.id === ${n.id}), true); document.getElementById('hashtagView').classList.remove('active'); document.querySelector('.comments-section').style.display = 'block';">
                    <div class="hashtag-news-title">${n.title[currentLang]}</div>
                    <div class="hashtag-news-meta">
                        <div class="hashtag-news-date">${n.date}</div>
                        <div class="hashtag-news-comments">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                            </svg>
                            <span>${n.comments ? n.comments.length : 0}</span>
                        </div>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('hashtagTopRecent').innerHTML = byDate.map(n => `
                <div class="hashtag-news-item" onclick="showNewsModal(sampleNews.find(news => news.id === ${n.id}), true); document.getElementById('hashtagView').classList.remove('active'); document.querySelector('.comments-section').style.display = 'block';">
                    <div class="hashtag-news-title">${n.title[currentLang]}</div>
                    <div class="hashtag-news-meta">
                        <div class="hashtag-news-date">${n.date}</div>
                        <div class="hashtag-news-comments">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                            </svg>
                            <span>${n.comments ? n.comments.length : 0}</span>
                        </div>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('hashtagTopRelated').innerHTML = byRelevance.map(n => `
                <div class="hashtag-news-item" onclick="showNewsModal(sampleNews.find(news => news.id === ${n.id}), true); document.getElementById('hashtagView').classList.remove('active'); document.querySelector('.comments-section').style.display = 'block';">
                    <div class="hashtag-news-title">${n.title[currentLang]}</div>
                    <div class="hashtag-news-meta">
                        <div class="hashtag-news-date">${n.date}</div>
                        <div class="hashtag-news-comments">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                            </svg>
                            <span>${n.comments ? n.comments.length : 0}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        document.getElementById('backToComments').addEventListener('click', () => {
            document.getElementById('hashtagView').classList.remove('active');
            document.querySelector('.comments-section').style.display = 'block';
        });

        function renderComments() {
            const commentsList = document.getElementById('commentsList');
            const newsComments = currentNewsComments.filter(c => c.newsId === selectedNews.id);
            
            if (newsComments.length === 0) {
                commentsList.innerHTML = `
                    <div class="comment-item">
                        <div class="comment-header">
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <span class="comment-author">Usuario Ejemplo</span>
                                <span class="comment-pending" data-es="Comentario provisional pendiente de moderación" data-en="Provisional comment pending moderation">Comentario provisional pendiente de moderación</span>
                            </div>
                            <span class="comment-date">10/01/2026 14:30</span>
                        </div>
                        <p class="comment-text">Este es un comentario de ejemplo que está pendiente de moderación.</p>
                        <button class="reply-btn" data-es="Responder" data-en="Reply">Responder</button>
                    </div>
                `;
            } else {
                // 15c: Renderizado jerárquico
                const topLevelComments = newsComments.filter(c => !c.parentId);
                commentsList.innerHTML = topLevelComments.map(comment => 
                    renderCommentThread(comment, newsComments)
                ).join('');
            }
            
            // Añadir event listeners a botones de responder
            document.querySelectorAll('.reply-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const commentId = btn.dataset.commentId;
                    document.getElementById('commentParentId').value = commentId || '';
                    document.getElementById('commentFormContainer').classList.add('active');
                    document.getElementById('commentText').focus();
                });
            });
            
            switchLanguage(currentLang);
        }
        
        // 15c: Función recursiva para renderizar thread de comentarios
        function renderCommentThread(comment, allComments, depth = 0) {
            const replies = allComments.filter(c => c.parentId === comment.id);
            
            let html = `
                <div class="comment-thread">
                    <div class="comment-item">
                        <div class="comment-header">
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <span class="comment-author">${comment.name}</span>
                                <span class="comment-pending" data-es="Pendiente de moderación" data-en="Pending moderation">Pendiente de moderación</span>
                            </div>
                            <span class="comment-date">${comment.date}</span>
                        </div>
                        <p class="comment-text">${comment.text}</p>
                        <button class="reply-btn" data-comment-id="${comment.id}" data-es="Responder" data-en="Reply">Responder</button>
                    </div>`;
            
            if (replies.length > 0) {
                html += `<div class="comment-replies">`;
                replies.forEach(reply => {
                    html += renderCommentThread(reply, allComments, depth + 1);
                });
                html += `</div>`;
            }
            
            html += `</div>`;
            return html;
        }

        document.getElementById('newsModalClose').addEventListener('click', () => {
            document.getElementById('newsModal').classList.remove('active');
            document.getElementById('commentFormContainer').classList.remove('active');
            document.getElementById('hashtagView').classList.remove('active');
            document.querySelector('.comments-section').style.display = 'block';
        });
        
        // 15: Click en badge comentarios → scroll a comentarios
        document.querySelector('.news-modal-comments-badge')?.addEventListener('click', () => {
            const commentsSection = document.querySelector('.comments-section');
            if (commentsSection) {
                commentsSection.scrollIntoView({ 
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
        
        // 12a: Click en backdrop cierra modal
        document.getElementById('newsModal').addEventListener('click', (e) => {
            if (e.target.id === 'newsModal') {
                document.getElementById('newsModal').classList.remove('active');
                document.getElementById('commentFormContainer').classList.remove('active');
                document.getElementById('hashtagView').classList.remove('active');
                document.querySelector('.comments-section').style.display = 'block';
            }
        });

        document.getElementById('newsModalComment').addEventListener('click', () => {
            document.getElementById('commentFormContainer').classList.add('active');
            document.getElementById('commentText').focus();
        });

        document.getElementById('commentFormClose').addEventListener('click', () => {
            document.getElementById('commentFormContainer').classList.remove('active');
            document.getElementById('commentForm').reset();
            document.getElementById('commentParentId').value = '';
        });

        document.getElementById('commentForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const commentText = document.getElementById('commentText').value;
            const commentName = document.getElementById('commentName').value;
            const commentEmail = document.getElementById('commentEmail').value;
            const parentId = document.getElementById('commentParentId').value;
            
            const now = new Date();
            const dateStr = `${now.getDate().toString().padStart(2, '0')}/${(now.getMonth() + 1).toString().padStart(2, '0')}/${now.getFullYear()} ${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
            
            const newComment = {
                id: commentIdCounter++,
                newsId: selectedNews.id,
                text: commentText,
                name: commentName,
                email: commentEmail,
                date: dateStr,
                parentId: parentId ? parseInt(parentId) : null
            };
            
            // 15b: Añadir comentario al array global Y al objeto news
            currentNewsComments.push(newComment);
            
            if (!selectedNews.comments) {
                selectedNews.comments = [];
            }
            selectedNews.comments.push(newComment);
            
            // Actualizar también en sampleNews para persistencia
            const newsInSample = sampleNews.find(n => n.id === selectedNews.id);
            if (newsInSample) {
                if (!newsInSample.comments) {
                    newsInSample.comments = [];
                }
                newsInSample.comments.push(newComment);
            }
            
            try {
                await sendCommentNotification(newComment);
                alert(currentLang === 'es' ? 
                    'Comentario enviado. Será visible tras moderación. Recibirás un email de confirmación.' : 
                    'Comment submitted. It will be visible after moderation. You will receive a confirmation email.');
            } catch (error) {
                alert(currentLang === 'es' ? 
                    'Comentario enviado. Será visible tras moderación.' : 
                    'Comment submitted. It will be visible after moderation.');
            }
            
            document.getElementById('commentFormContainer').classList.remove('active');
            document.getElementById('commentForm').reset();
            document.getElementById('commentParentId').value = '';
            
            // 15b: Re-renderizar comentarios (NO desaparecen porque están en el array)
            renderComments();
            
            // Actualizar contador en badge del modal
            document.getElementById('newsModalCommentsCount').textContent = selectedNews.comments.length;
            
            // Actualizar badge en la tarjeta de la noticia si está visible
            renderNews();
        });

        async function sendCommentNotification(comment) {
            console.log('Enviando notificación de comentario:', {
                to: comment.email,
                subject: currentLang === 'es' ? 'Comentario recibido - Tank Iberica' : 'Comment received - Tank Iberica',
                body: currentLang === 'es' ? 
                    `Gracias por tu comentario en "${selectedNews.title[currentLang]}". Te notificaremos cuando sea aprobado.` :
                    `Thank you for your comment on "${selectedNews.title[currentLang]}". We will notify you when it is approved.`
            });
            
            return new Promise((resolve) => {
                setTimeout(() => resolve(), 500);
            });
        }

        document.getElementById('newsModalSubscribe').addEventListener('click', () => {
            document.getElementById('subscribeModal').classList.add('active');
        });

        document.getElementById('subscribeModalClose').addEventListener('click', () => {
            document.getElementById('subscribeModal').classList.remove('active');
        });
        
        // 12a: Click en backdrop cierra modal
        document.getElementById('subscribeModal').addEventListener('click', (e) => {
            if (e.target.id === 'subscribeModal') {
                document.getElementById('subscribeModal').classList.remove('active');
            }
        });

        document.getElementById('subscribeSubmitBtn').addEventListener('click', () => {
            const email = document.getElementById('subscribeEmailInput').value;
            if (email) {
                alert(currentLang === 'es' ? 
                    '¡Suscripción exitosa!' : 
                    'Subscription successful!');
                document.getElementById('subscribeModal').classList.remove('active');
                document.getElementById('subscribeEmailInput').value = '';
            }
        });

        document.getElementById('newsModalShare').addEventListener('click', () => {
            if (navigator.share) {
                navigator.share({
                    title: selectedNews.title[currentLang],
                    text: selectedNews.subtitle[currentLang],
                    url: window.location.href
                });
            } else {
                alert(currentLang === 'es' ? 'Enlace copiado' : 'Link copied');
            }
        });

        document.getElementById('newsBackButton').addEventListener('click', () => {
            // Solo remover clase active de newsSection, el CSS :has() mostrará automáticamente categories-section
            document.getElementById('newsSection').classList.remove('active');
        });

        document.querySelectorAll('.news-filter-checkbox').forEach(checkbox => {
            checkbox.addEventListener('change', () => {
                const checkedBoxes = document.querySelectorAll('.news-filter-checkbox:checked');
                activeNewsFilters = Array.from(checkedBoxes).map(cb => cb.dataset.filter);
                renderNews();
            });
        });
        
        // 16a: Búsqueda con corrección tipográfica en noticias
        const newsSearchInput = document.getElementById('newsSearchInput');
        if (newsSearchInput) {
            newsSearchInput.addEventListener('input', (e) => {
                currentNewsSearchQuery = e.target.value;
                renderNews();
            });
        }
        
        // Variable global para búsqueda de noticias
        let currentNewsSearchQuery = '';


        document.querySelectorAll('.footer-news-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const filter = link.dataset.filter;
                
                // El CSS con :has() oculta automáticamente .categories-section
                document.getElementById('newsSection').classList.add('active');
                
                const filterCheckboxes = document.querySelectorAll('.news-filter-checkbox');
                if (filter === 'all') {
                    filterCheckboxes.forEach(cb => cb.checked = true);
                    activeNewsFilters = ['press', 'newsletters', 'featured', 'events'];
                } else {
                    filterCheckboxes.forEach(cb => {
                        cb.checked = cb.dataset.filter === filter;
                    });
                    activeNewsFilters = [filter];
                }
                
                renderNews();
                window.scrollTo(0, 0);
            });
        });

        // ============================================
        // ADVERTISE MODAL (P0-03)
        // ============================================
        // ============================================
        // ADVERTISE MODAL - Iteración 6
        // ============================================
        
        // Cerrar modal
        document.getElementById('advertiseModalClose').addEventListener('click', () => {
            document.getElementById('advertiseModal').classList.remove('active');
            document.body.style.overflow = '';
            document.getElementById('advertiseForm').reset();
            document.getElementById('advertisePhotoPreview').innerHTML = '';
        });
        
        // 12a: Click en backdrop cierra modal
        document.getElementById('advertiseModal').addEventListener('click', (e) => {
            if (e.target.id === 'advertiseModal') {
                document.getElementById('advertiseModal').classList.remove('active');
                document.body.style.overflow = '';
                document.getElementById('advertiseForm').reset();
                document.getElementById('advertisePhotoPreview').innerHTML = '';
            }
        });

        // Lógica de campos condicionales según tipo de vehículo
        const advertiseVehicleSelect = document.getElementById('advertiseVehicle');
        const advertiseTankerCheckGroup = document.getElementById('advertiseTankerCheckGroup');
        const advertiseTankerCheck = document.getElementById('advertiseTankerCheck');
        const advertiseTipoGroup = document.getElementById('advertiseTipoGroup');
        const advertiseTipo = document.getElementById('advertiseTipo');
        const advertiseVolumeGroup = document.getElementById('advertiseVolumeGroup');
        const advertiseCompartmentsGroup = document.getElementById('advertiseCompartmentsGroup');
        const advertiseCapacityGroup = document.getElementById('advertiseCapacityGroup');
        const advertisePowerGroup = document.getElementById('advertisePowerGroup');

        function updateAdvertiseConditionalFields() {
            const vehicleType = advertiseVehicleSelect.value;
            const isTankerChecked = advertiseTankerCheck.checked;
            
            // Reset all conditional fields
            advertiseTankerCheckGroup.style.display = 'none';
            advertiseTipoGroup.style.display = 'none';
            advertiseVolumeGroup.style.display = 'none';
            advertiseCompartmentsGroup.style.display = 'none';
            advertiseCapacityGroup.style.display = 'none';
            advertisePowerGroup.style.display = 'none';
            
            // Reset required
            advertiseTipo.required = false;
            document.getElementById('advertiseVolume').required = false;
            document.getElementById('advertiseCapacity').required = false;
            document.getElementById('advertisePower').required = false;
            
            // Lógica según tipo de vehículo
            if (vehicleType === 'cisterna') {
                // Cisterna directa: mostrar Tipo, Volumen, Compartimentos
                advertiseTipoGroup.style.display = 'block';
                advertiseVolumeGroup.style.display = 'block';
                advertiseCompartmentsGroup.style.display = 'block';
                advertiseTipo.required = true;
                document.getElementById('advertiseVolume').required = true;
            } 
            else if (vehicleType === 'rigido' || vehicleType === 'remolque') {
                // Rígido/Remolque: mostrar checkbox cisterna
                advertiseTankerCheckGroup.style.display = 'block';
                
                if (isTankerChecked) {
                    // Si es cisterna: Tipo, Volumen, Compartimentos
                    advertiseTipoGroup.style.display = 'block';
                    advertiseVolumeGroup.style.display = 'block';
                    advertiseCompartmentsGroup.style.display = 'block';
                    advertiseTipo.required = true;
                    document.getElementById('advertiseVolume').required = true;
                } else {
                    // Si no es cisterna: Capacidad
                    advertiseCapacityGroup.style.display = 'block';
                    document.getElementById('advertiseCapacity').required = true;
                }
            }
            else if (vehicleType === 'tractora') {
                // Tractora: Potencia
                advertisePowerGroup.style.display = 'block';
                document.getElementById('advertisePower').required = true;
            }
            else if (vehicleType === 'semirremolque') {
                // Semirremolque: Capacidad
                advertiseCapacityGroup.style.display = 'block';
                document.getElementById('advertiseCapacity').required = true;
            }
        }

        advertiseVehicleSelect.addEventListener('change', updateAdvertiseConditionalFields);
        advertiseTankerCheck.addEventListener('change', updateAdvertiseConditionalFields);

        // Manejo de upload de fotos con drag & drop
        const advertisePhotoUpload = document.getElementById('advertisePhotoUpload');
        const advertisePhotosInput = document.getElementById('advertisePhotos');
        const advertisePhotoPreview = document.getElementById('advertisePhotoPreview');
        let advertisedPhotosArray = [];

        advertisePhotoUpload.addEventListener('click', () => {
            advertisePhotosInput.click();
        });

        advertisePhotoUpload.addEventListener('dragover', (e) => {
            e.preventDefault();
            advertisePhotoUpload.style.borderColor = 'var(--petrol-blue)';
            advertisePhotoUpload.style.background = '#f0f4f5';
        });

        advertisePhotoUpload.addEventListener('dragleave', (e) => {
            e.preventDefault();
            advertisePhotoUpload.style.borderColor = '';
            advertisePhotoUpload.style.background = '';
        });

        advertisePhotoUpload.addEventListener('drop', (e) => {
            e.preventDefault();
            advertisePhotoUpload.style.borderColor = '';
            advertisePhotoUpload.style.background = '';
            const files = Array.from(e.dataTransfer.files).filter(f => f.type.startsWith('image/'));
            handleAdvertisePhotos(files);
        });

        advertisePhotosInput.addEventListener('change', (e) => {
            const files = Array.from(e.target.files);
            handleAdvertisePhotos(files);
        });

        function handleAdvertisePhotos(files) {
            files.forEach(file => {
                advertisedPhotosArray.push(file);
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    const previewItem = document.createElement('div');
                    previewItem.className = 'photo-preview-item';
                    previewItem.innerHTML = `
                        <img src="${e.target.result}" alt="Preview">
                        <button type="button" class="photo-preview-remove" data-index="${advertisedPhotosArray.length - 1}">×</button>
                    `;
                    advertisePhotoPreview.appendChild(previewItem);
                    
                    previewItem.querySelector('.photo-preview-remove').addEventListener('click', function() {
                        const index = parseInt(this.dataset.index);
                        advertisedPhotosArray.splice(index, 1);
                        previewItem.remove();
                        updatePhotoIndexes();
                    });
                };
                reader.readAsDataURL(file);
            });
        }

        function updatePhotoIndexes() {
            const removeButtons = advertisePhotoPreview.querySelectorAll('.photo-preview-remove');
            removeButtons.forEach((btn, idx) => {
                btn.dataset.index = idx;
            });
        }

        // Manejo de upload de ficha técnica
        const advertiseTechSheetUpload = document.getElementById('advertiseTechSheetUpload');
        const advertiseTechSheetInput = document.getElementById('advertiseTechSheet');
        const advertiseTechSheetPreview = document.getElementById('advertiseTechSheetPreview');
        let techSheetFile = null;

        advertiseTechSheetUpload.addEventListener('click', () => {
            advertiseTechSheetInput.click();
        });

        advertiseTechSheetUpload.addEventListener('dragover', (e) => {
            e.preventDefault();
            advertiseTechSheetUpload.style.borderColor = 'var(--petrol-blue)';
            advertiseTechSheetUpload.style.background = '#f0f4f5';
        });

        advertiseTechSheetUpload.addEventListener('dragleave', (e) => {
            e.preventDefault();
            advertiseTechSheetUpload.style.borderColor = '';
            advertiseTechSheetUpload.style.background = '';
        });

        advertiseTechSheetUpload.addEventListener('drop', (e) => {
            e.preventDefault();
            advertiseTechSheetUpload.style.borderColor = '';
            advertiseTechSheetUpload.style.background = '';
            const files = Array.from(e.dataTransfer.files).filter(f => f.type.startsWith('image/'));
            if (files.length > 0) {
                handleTechSheet(files[0]);
            }
        });

        advertiseTechSheetInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleTechSheet(e.target.files[0]);
            }
        });

        function handleTechSheet(file) {
            techSheetFile = file;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                advertiseTechSheetPreview.innerHTML = `
                    <div class="photo-preview-item">
                        <img src="${e.target.result}" alt="Ficha técnica">
                        <button type="button" class="photo-preview-remove" id="removeTechSheet">×</button>
                    </div>
                `;
                
                document.getElementById('removeTechSheet').addEventListener('click', function() {
                    techSheetFile = null;
                    advertiseTechSheetPreview.innerHTML = '';
                    advertiseTechSheetInput.value = '';
                });
            };
            reader.readAsDataURL(file);
        }

        // Validación y envío del formulario
        document.getElementById('advertiseForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            // Validar mínimo 3 fotos del vehículo
            if (advertisedPhotosArray.length < 3) {
                alert(currentLang === 'es' ? 
                    'Debe subir mínimo 3 fotos del vehículo.' : 
                    'You must upload at least 3 vehicle photos.');
                return;
            }
            
            // Validar ficha técnica
            if (!techSheetFile) {
                alert(currentLang === 'es' ? 
                    'Debe subir una foto legible de la ficha técnica.' : 
                    'You must upload a legible photo of the technical sheet.');
                return;
            }
            
            // Validar aceptación de términos
            if (!document.getElementById('advertiseAccept').checked) {
                alert(currentLang === 'es' ? 
                    'Debe aceptar los términos para continuar.' : 
                    'You must accept the terms to continue.');
                return;
            }
            
            // Simulación de envío exitoso
            alert(currentLang === 'es' ? 
                '¡Solicitud enviada correctamente! Le contactaremos pronto para revisar su anuncio.' : 
                'Request submitted successfully! We will contact you soon to review your ad.');
            
            // Cerrar modal y resetear
            document.getElementById('advertiseModal').classList.remove('active');
            document.body.style.overflow = '';
            document.getElementById('advertiseForm').reset();
            advertisePhotoPreview.innerHTML = '';
            advertisedPhotosArray = [];
        });
        // ============================================
        // DEMAND MODAL (P0-04) - COMPLETO
        // ============================================
        
        // Cerrar modal
        document.getElementById('demandModalClose').addEventListener('click', () => {
            document.getElementById('demandModal').classList.remove('active');
            document.body.style.overflow = '';
            document.getElementById('demandForm').reset();
        });
        
        // 12a: Click en backdrop cierra modal
        document.getElementById('demandModal').addEventListener('click', (e) => {
            if (e.target.id === 'demandModal') {
                document.getElementById('demandModal').classList.remove('active');
                document.body.style.overflow = '';
                document.getElementById('demandForm').reset();
            }
        });

        // Referencias a elementos del formulario
        const demandVehicle = document.getElementById('demandVehicle');
        const demandIsCisternGroup = document.getElementById('demandIsCisternGroup');
        const demandIsCistern = document.getElementById('demandIsCistern');
        const demandCisternTypeGroup = document.getElementById('demandCisternTypeGroup');
        const demandCisternType = document.getElementById('demandCisternType');

        // Función para actualizar campos condicionales
        function updateDemandFields() {
            const vehicleType = demandVehicle.value;
            const isCistern = demandIsCistern.checked;
            
            // Ocultar todos los campos condicionales primero
            document.querySelectorAll('.conditional-cistern').forEach(el => el.style.display = 'none');
            document.querySelectorAll('.conditional-rigid').forEach(el => el.style.display = 'none');
            document.querySelectorAll('.conditional-power').forEach(el => el.style.display = 'none');
            
            // Mostrar/ocultar checkbox cisterna según vehículo
            if (['cisternas', 'rigidos', 'remolques', 'remolques_completos'].includes(vehicleType)) {
                demandIsCisternGroup.style.display = 'flex';
            } else {
                demandIsCisternGroup.style.display = 'none';
                demandIsCistern.checked = false;
            }
            
            // Mostrar tipo de cisterna si es cisterna
            if (vehicleType === 'cisternas' || isCistern) {
                demandCisternTypeGroup.style.display = 'flex';
                demandCisternType.required = true;
            } else {
                demandCisternTypeGroup.style.display = 'none';
                demandCisternType.required = false;
                demandCisternType.value = '';
            }
            
            // Mostrar campos específicos según tipo
            if (vehicleType === 'cisternas' || isCistern) {
                // Mostrar volumen y compartimentos para cisternas
                document.querySelectorAll('.conditional-cistern').forEach(el => {
                    el.style.display = 'block';
                });
            }
            
            if (vehicleType === 'rigidos' && !isCistern) {
                // Mostrar capacidad solo para rígidos no cisterna
                document.querySelectorAll('.conditional-rigid').forEach(el => {
                    el.style.display = 'block';
                });
            }
            
            if (['tractoras', 'rigidos'].includes(vehicleType)) {
                // Mostrar potencia para tractoras y rígidos
                document.querySelectorAll('.conditional-power').forEach(el => {
                    el.style.display = 'block';
                });
            }
        }

        // Event listeners para campos condicionales
        demandVehicle.addEventListener('change', updateDemandFields);
        demandIsCistern.addEventListener('change', updateDemandFields);

        // Inicializar campos condicionales
        updateDemandFields();

        // ============================================
        // SLIDERS DOBLES MIN-MAX
        // ============================================
        
        // Configuración de todos los sliders
        const demandSliders = [
            { 
                min: 'demandPriceMin', 
                max: 'demandPriceMax', 
                minVal: 'demandPriceMinValue', 
                maxVal: 'demandPriceMaxValue', 
                format: (v) => formatNumber(v) + '€',
                step: 1000
            },
            { 
                min: 'demandYearMin', 
                max: 'demandYearMax', 
                minVal: 'demandYearMinValue', 
                maxVal: 'demandYearMaxValue', 
                format: (v) => v.toString(),
                step: 1
            },
            { 
                min: 'demandVolumeMin', 
                max: 'demandVolumeMax', 
                minVal: 'demandVolumeMinValue', 
                maxVal: 'demandVolumeMaxValue', 
                format: (v) => formatNumber(v) + ' L',
                step: 1000
            },
            { 
                min: 'demandCompartmentsMin', 
                max: 'demandCompartmentsMax', 
                minVal: 'demandCompartmentsMinValue', 
                maxVal: 'demandCompartmentsMaxValue', 
                format: (v) => v.toString(),
                step: 1
            },
            { 
                min: 'demandCapacityMin', 
                max: 'demandCapacityMax', 
                minVal: 'demandCapacityMinValue', 
                maxVal: 'demandCapacityMaxValue', 
                format: (v) => formatNumber(v) + ' kg',
                step: 500
            },
            { 
                min: 'demandPowerMin', 
                max: 'demandPowerMax', 
                minVal: 'demandPowerMinValue', 
                maxVal: 'demandPowerMaxValue', 
                format: (v) => formatNumber(v) + ' CV',
                step: 10
            }
        ];

        // Inicializar cada slider doble
        demandSliders.forEach(({ min, max, minVal, maxVal, format }) => {
            const minSlider = document.getElementById(min);
            const maxSlider = document.getElementById(max);
            const minValueSpan = document.getElementById(minVal);
            const maxValueSpan = document.getElementById(maxVal);
            
            if (!minSlider || !maxSlider) return; // Skip si no existe
            
            function updateSliderValues() {
                let minValue = parseInt(minSlider.value);
                let maxValue = parseInt(maxSlider.value);
                
                // SIEMPRE actualizar los textos (sin restricciones)
                if (minValueSpan) minValueSpan.textContent = format(minValue);
                if (maxValueSpan) maxValueSpan.textContent = format(maxValue);
            }
            
            // Event listeners
            minSlider.addEventListener('input', updateSliderValues);
            maxSlider.addEventListener('input', updateSliderValues);
            
            // Inicializar valores
            updateSliderValues();
        });

        // ============================================
        // VALIDACIÓN Y ENVÍO DEL FORMULARIO
        // ============================================
        
        document.getElementById('demandForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            // Validar al menos una forma de contacto
            const emailChecked = document.getElementById('demandContactEmail').checked;
            const phoneChecked = document.getElementById('demandContactPhone').checked;
            const whatsappChecked = document.getElementById('demandContactWhatsApp').checked;
            
            if (!emailChecked && !phoneChecked && !whatsappChecked) {
                alert(currentLang === 'es' ? 
                    'Debe seleccionar al menos una forma de contacto.' : 
                    'You must select at least one contact method.');
                return;
            }
            
            // Validar tipo de cisterna si corresponde
            const vehicleType = demandVehicle.value;
            const isCistern = demandIsCistern.checked;
            
            if ((vehicleType === 'cisternas' || isCistern) && !demandCisternType.value) {
                alert(currentLang === 'es' ? 
                    'Debe seleccionar el tipo de cisterna.' : 
                    'You must select the tanker type.');
                return;
            }
            
            // Validar aceptación de términos
            if (!document.getElementById('demandAccept').checked) {
                alert(currentLang === 'es' ? 
                    'Debe aceptar los términos para continuar.' : 
                    'You must accept the terms to continue.');
                return;
            }
            
            // Simulación de envío
            alert(currentLang === 'es' ? 
                '¡Solicitud enviada correctamente! Le avisaremos cuando tengamos vehículos que cumplan sus criterios.' : 
                'Request sent successfully! We will notify you when we have vehicles that meet your criteria.');
            
            // Cerrar modal y resetear formulario
            document.getElementById('demandModal').classList.remove('active');
            document.body.style.overflow = '';
            document.getElementById('demandForm').reset();
            
            // Restablecer campos condicionales
            updateDemandFields();
        });        // SISTEMA UNIFICADO DE CIERRE DE MODALES (P0-02)
        // ============================================
        function setupModalCloseHandlers() {
            const modals = [
                'accountModal',
                'devModal',
                'contactModal',
                'vehicleDetailModal',
                'newsModal',
                'favoritesNotification',
                'subscribeModal',
                'advertiseModal',
                'demandModal'
            ];
            
            modals.forEach(modalId => {
                const modal = document.getElementById(modalId);
                if (!modal) return;
                
                // Click en backdrop cierra modal
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.classList.remove('active');
                        document.body.style.overflow = '';
                    }
                });
            });
        }

        // ============================================
        // INITIALIZE
        // ============================================
        
        // ============================================
        // NUEVAS SECCIONES: Sobre nosotros + Legal
        // ============================================
        
        // Enlaces footer
        document.getElementById('footerAboutLink')?.addEventListener('click', (e) => {
            e.preventDefault();
            document.getElementById('newsSection').classList.remove('active');
            document.getElementById('legalSection').classList.remove('active');
            document.getElementById('aboutSection').classList.add('active');
            window.scrollTo(0, 0);
        });

        document.querySelectorAll('.footer-about-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                document.getElementById('newsSection').classList.remove('active');
                document.getElementById('legalSection').classList.remove('active');
                document.getElementById('aboutSection').classList.add('active');
                window.scrollTo(0, 0);
            });
        });

        document.getElementById('footerLegalLink')?.addEventListener('click', (e) => {
            e.preventDefault();
            document.getElementById('newsSection').classList.remove('active');
            document.getElementById('aboutSection').classList.remove('active');
            document.getElementById('legalSection').classList.add('active');
            window.scrollTo(0, 0);
        });

        document.querySelectorAll('.footer-legal-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                document.getElementById('newsSection').classList.remove('active');
                document.getElementById('aboutSection').classList.remove('active');
                document.getElementById('legalSection').classList.add('active');
                window.scrollTo(0, 0);
            });
        });

        // Botones volver
        document.getElementById('aboutBackButton')?.addEventListener('click', () => {
            document.getElementById('aboutSection').classList.remove('active');
        });

        document.getElementById('legalBackButton')?.addEventListener('click', () => {
            document.getElementById('legalSection').classList.remove('active');
        });

        // Asegurar que todos los modales estén cerrados al inicio
        document.querySelectorAll('.demand-modal, .advertise-modal, .vehicle-detail-modal, .contact-modal, .news-modal').forEach(modal => {
            modal.classList.remove('active');
        });
        document.body.style.overflow = '';
        
        updateHeaderLinks();
        filterAndRenderProducts();
        renderNews();
        setupModalCloseHandlers();
    </script>

    <!-- GOOGLE SHEETS API - YA ESTÁ CARGADO EN HEAD -->
    <script>
        // ============================================
        // INTEGRACIÓN GOOGLE SHEETS
        // ============================================
        
        // Variables globales para datos de Sheets
        let vehiculosFromSheets = [];
        let noticiasFromSheets = [];
        let useGoogleSheets = false;
        
        // Constantes de configuración de Google Sheets
        const SPREADSHEET_ID = '1GdmirqWFKVt39QvEJxdMH3zW0-itl64YuqYEsOAkF30';
        const API_KEY = 'AIzaSyCzN8LEMBXM75Mkop9NH0iGqa4XTmLX0i4';
        
        // Funciones para Google Sheets (siempre usar versión inline para consistencia)
        window.readSheetData = async function(sheetName) {
            // Soportar tanto CONFIG.SPREADSHEET_ID como SPREADSHEET_ID directo
            const spreadsheetId = (typeof CONFIG !== 'undefined' && CONFIG.SPREADSHEET_ID) || (typeof SPREADSHEET_ID !== 'undefined' && SPREADSHEET_ID);
            const apiKey = (typeof CONFIG !== 'undefined' && CONFIG.API_KEY) || (typeof API_KEY !== 'undefined' && API_KEY);
            
            if (!spreadsheetId || !apiKey) {
                console.warn('⚠️ Google Sheets no configurado: SPREADSHEET_ID o API_KEY no definidos');
                return [];
            }
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${sheetName}?key=${apiKey}`;
            console.log('📡 Cargando hoja:', sheetName);
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    console.error('❌ Error HTTP al cargar', sheetName, ':', response.status);
                    return [];
                }
                const data = await response.json();
                if (!data.values || data.values.length < 2) {
                    console.warn('⚠️ Hoja', sheetName, 'vacía o sin datos');
                    return [];
                }
                const headers = data.values[0];
                console.log('📋 Headers de', sheetName, ':', headers);
                const result = data.values.slice(1).map(row => {
                    const obj = {};
                    headers.forEach((h, i) => {
                        let val = row[i] || '';
                        if (val === 'TRUE') val = true;
                        else if (val === 'FALSE') val = false;
                        else if ((h === 'filtros_json' || h === 'caracteristicas_json') && val) {
                            try { val = JSON.parse(val); } catch { val = {}; }
                        }
                        obj[h] = val;
                    });
                    return obj;
                });
                console.log('✅ Cargados', result.length, 'registros de', sheetName);
                return result;
            } catch (e) {
                console.error('❌ Error cargando ' + sheetName + ':', e);
                return [];
            }
        };
        
        if (typeof loadConfig === 'undefined') {
            window.loadConfig = async function() {
                const rows = await readSheetData('config');
                const config = {};
                rows.forEach(row => { if (row.clave) config[row.clave] = row; });
                return config;
            };
        }
        
        // Validar que Sheets esté configurado
        function validarConfiguracion() {
            // Soportar tanto CONFIG.SPREADSHEET_ID como SPREADSHEET_ID directo
            const spreadsheetId = (typeof CONFIG !== 'undefined' && CONFIG.SPREADSHEET_ID) || (typeof SPREADSHEET_ID !== 'undefined' && SPREADSHEET_ID);
            const apiKey = (typeof CONFIG !== 'undefined' && CONFIG.API_KEY) || (typeof API_KEY !== 'undefined' && API_KEY);
            
            const tieneSpreadsheetId = spreadsheetId && spreadsheetId.length > 10;
            const tieneApiKey = apiKey && apiKey.length > 10;
            console.log('🔧 Validando config - SPREADSHEET_ID:', tieneSpreadsheetId, '| API_KEY:', tieneApiKey);
            return tieneSpreadsheetId && tieneApiKey;
        }
        
        // Función para convertir URLs de Drive a formato que funcione
        function convertirUrlDrive(url) {
            if (!url) return '';
            
            // Si ya es lh3.googleusercontent, devolver como está
            if (url.includes('lh3.googleusercontent.com')) return url;
            
            // Extraer ID de diferentes formatos de URL de Drive
            let fileId = null;
            
            // Formato: https://drive.google.com/uc?export=view&id=XXXXX
            const ucMatch = url.match(/[?&]id=([a-zA-Z0-9_-]+)/);
            if (ucMatch) fileId = ucMatch[1];
            
            // Formato: https://drive.google.com/file/d/XXXXX/view
            const fileMatch = url.match(/\/file\/d\/([a-zA-Z0-9_-]+)/);
            if (fileMatch) fileId = fileMatch[1];
            
            // Formato: https://drive.google.com/open?id=XXXXX
            const openMatch = url.match(/open\?id=([a-zA-Z0-9_-]+)/);
            if (openMatch) fileId = openMatch[1];
            
            if (fileId) {
                return `https://lh3.googleusercontent.com/d/${fileId}`;
            }
            
            // Si no se pudo extraer ID, devolver URL original
            return url;
        }
        
        function convertirVehiculoSheets(v) {
            // Mapear subcategorías - ahora usamos el nombre directamente
            const subcategory = (v.subcategoria || '').toLowerCase();
            console.log('🚗 Vehículo:', v.marca, v.modelo, '| subcategoria raw:', v.subcategoria, '| parseada:', subcategory);
            
            // Mapear categorías
            const categoryMap = {
                'Venta': 'venta',
                'venta': 'venta',
                'Alquiler': 'alquiler',
                'alquiler': 'alquiler',
                'Terceros': 'terceros',
                'terceros': 'terceros'
            };
            
            // Parsear filtros_json
            let filtros_json = {};
            if (v.filtros_json) {
                if (typeof v.filtros_json === 'string') {
                    try { filtros_json = JSON.parse(v.filtros_json); } catch(e) {}
                } else {
                    filtros_json = v.filtros_json;
                }
            }
            
            // Parsear caracteristicas_json
            let caracteristicas_json = {};
            if (v.caracteristicas_json) {
                if (typeof v.caracteristicas_json === 'string') {
                    try { caracteristicas_json = JSON.parse(v.caracteristicas_json); } catch(e) {}
                } else {
                    caracteristicas_json = v.caracteristicas_json;
                }
            }
            
            // Categorías múltiples - convertir a array
            const categorias = (v.categoria || '').toLowerCase().split(',').map(c => c.trim()).filter(Boolean);
            const categoriaPrincipal = categorias[0] || '';
            
            // Debug: ver categorías de cada vehículo
            if (categorias.length > 1) {
                console.log('🚗 Vehículo DUAL:', v.marca, v.modelo, '| Categorías raw:', v.categoria, '| Parseadas:', categorias);
            }
            
            return {
                id: parseInt(v.id) || 0,
                images: (Array.isArray(v.imagenes) ? v.imagenes : (v.imagenes ? v.imagenes.split(',') : [])).map(url => convertirUrlDrive((url||'').trim())).filter(Boolean),
                category: categoryMap[categoriaPrincipal] || categoriaPrincipal,
                categories: categorias.map(c => categoryMap[c] || c),
                subcategory: subcategory,
                brand: v.marca || '',
                model: v.modelo || '',
                year: parseInt(v.año) || 0,
                price: parseFloat(v.precio) || 0,
                price_rent: parseFloat(v.precio_alquiler) || 0,
                location: v.ubicacion || '',
                location_en: v.ubicacion_en || v.ubicacion || '',
                description: v.descripcion || '',
                description_en: v.descripcion_en || v.descripcion || '',
                filtros_json: filtros_json,
                caracteristicas_json: caracteristicas_json,
                published: v.estado === 'publicado',
                estado: v.estado || 'oculto'
            };
        }
        
        // Función para cargar datos de Google Sheets
        // Variables globales para datos de Sheets
        // Variables globales para datos de Sheets (accesibles desde ambos scripts)
        window.subcategoriasFromSheets = [];
        window.filtrosFromSheets = [];
        let configFromSheets = {};
        
        async function cargarDatosDeSheets() {
            try {
                console.log('🔄 Intentando cargar datos desde Google Sheets...');
                
                // Validar configuración
                if (!validarConfiguracion()) {
                    console.warn('⚠️ Google Sheets no configurado correctamente');
                    console.warn('📝 Edita google-sheets-api.js y configura API_KEY y SPREADSHEET_ID');
                    return false;
                }
                
                // Cargar todo en paralelo
                const [vehiculosRaw, subcatsRaw, filtrosRaw, configRaw, noticiasRaw] = await Promise.all([
                    loadVehiculos().catch(() => []),
                    readSheetData('subcategorias').catch(() => []),
                    readSheetData('filtros').catch(() => []),
                    loadConfig().catch(() => ({})),
                    loadNoticias().catch(() => [])
                ]);
                
                // Procesar vehículos
                if (vehiculosRaw.length > 0) {
                    vehiculosFromSheets = vehiculosRaw
                        .filter(v => v.estado === 'publicado')
                        .map(convertirVehiculoSheets);
                    
                    console.log('✅ Vehículos procesados:', vehiculosFromSheets.length);
                    
                    sampleProducts.length = 0;
                    sampleProducts.push(...vehiculosFromSheets);
                    useGoogleSheets = true;
                }
                
                // Procesar subcategorías
                window.subcategoriasFromSheets = subcatsRaw.filter(s => s.publicado === true || s.publicado === 'TRUE');
                console.log('✅ Subcategorías cargadas:', window.subcategoriasFromSheets.length);
                
                // Procesar filtros - solo los que tienen estado "publicado" aparecen como filtros en web
                // Función para normalizar estado (acepta abreviaturas)
                const normalizarEstado = (f) => {
                    let estado = (f.estado || '').toLowerCase().trim();
                    // Si no tiene estado, usar campo publicado antiguo
                    if (!estado) {
                        // Si publicado es undefined o vacío, asumir publicado (compatibilidad)
                        if (f.publicado === undefined || f.publicado === '') return 'publicado';
                        return (f.publicado === true || f.publicado === 'TRUE') ? 'publicado' : 'inactivo';
                    }
                    // Normalizar abreviaturas
                    if (estado === 'pub' || estado.startsWith('public')) return 'publicado';
                    if (estado === 'ocul' || estado.startsWith('ocult')) return 'oculto';
                    if (estado === 'inact' || estado.startsWith('inact')) return 'inactivo';
                    return estado;
                };
                
                window.filtrosFromSheets = filtrosRaw.filter(f => {
                    const estado = normalizarEstado(f);
                    return estado === 'publicado';
                });
                
                // Guardar también los filtros "ocultos" para características
                window.filtrosOcultosFromSheets = filtrosRaw.filter(f => {
                    const estado = normalizarEstado(f);
                    return estado === 'oculto';
                });
                console.log('✅ Filtros publicados:', window.filtrosFromSheets.length, '| Filtros ocultos:', window.filtrosOcultosFromSheets.length);
                
                // Renderizar filtros dinámicos
                if (typeof updateAdvancedFilters === 'function') {
                    updateAdvancedFilters();
                }
                
                // Procesar config (banner)
                configFromSheets = configRaw || {};
                console.log('✅ Config cargada:', Object.keys(configFromSheets));
                initBannerDinamico();
                
                // Procesar noticias
                if (noticiasRaw.length > 0) {
                    noticiasFromSheets = noticiasRaw;
                    console.log('📰 Noticias cargadas:', noticiasFromSheets.length);
                }
                
                // Actualizar filtros y re-renderizar catálogo
                updateAdvancedFilters();
                filterAndRenderProducts();
                
                // Renderizar subcategorías DESPUÉS de que los productos estén cargados
                renderSubcategoriasDinamicas();
                
                return true;
                
            } catch (error) {
                console.error('❌ Error cargando datos de Google Sheets:', error);
                console.warn('⚠️ Usando datos de ejemplo locales');
                return false;
            }
        }
        
        // Renderizar subcategorías desde Sheets
        function renderSubcategoriasDinamicas() {
            const container = document.getElementById('subcategoriesContainer');
            console.log('🏷️ Renderizando subcategorías. Total:', window.subcategoriasFromSheets.length);
            console.log('🏷️ sampleProducts.length:', sampleProducts.length);
            
            if (!container) {
                console.error('❌ Contenedor subcategoriesContainer no encontrado');
                return;
            }
            
            if (window.subcategoriasFromSheets.length === 0) {
                console.warn('⚠️ No hay subcategorías cargadas de Sheets');
                return;
            }
            
            // Limpiar contenedor
            container.innerHTML = '';
            
            // Verificar si hay vehículos con subcategoría asignada
            const vehiculosConSubcat = sampleProducts.filter(v => v.subcategory && v.subcategory.trim() !== '').length;
            console.log('🏷️ Vehículos con subcategoría asignada:', vehiculosConSubcat, 'de', sampleProducts.length);
            
            // Si no hay vehículos con subcategoría, NO deshabilitar ningún botón
            const deshabilitarSinStock = vehiculosConSubcat > 0;
            
            // Crear botones para TODAS las subcategorías
            window.subcategoriasFromSheets.forEach(sub => {
                // Contar vehículos en TODAS las categorías activas
                let count = 0;
                const subNombre = (sub.nombre || '').toLowerCase();
                
                // Contar vehículos de esta subcategoría
                if (activeCategories.size === 0) {
                    // Sin filtro de categoría: contar todos los de esta subcategoría
                    count = sampleProducts.filter(v => 
                        v.subcategory && v.subcategory.toLowerCase() === subNombre
                    ).length;
                } else {
                    // Con filtro de categoría: contar solo los que coinciden
                    count = sampleProducts.filter(v => 
                        activeCategories.has(v.category) &&
                        v.subcategory && v.subcategory.toLowerCase() === subNombre
                    ).length;
                }
                
                console.log('🏷️ Subcategoría:', subNombre, '| Count:', count);
                
                const btn = document.createElement('button');
                btn.className = 'subcategory-btn';
                btn.dataset.subcategory = subNombre;
                btn.dataset.es = sub.nombre || '';
                btn.dataset.en = sub.nombre_en || sub.nombre || '';
                
                // Texto según idioma
                const displayName = currentLang === 'en' && sub.nombre_en ? sub.nombre_en : sub.nombre;
                
                // Solo deshabilitar si hay vehículos con subcategoría Y este no tiene stock
                if (deshabilitarSinStock && count === 0) {
                    btn.classList.add('disabled');
                }
                btn.innerHTML = displayName;
                
                // Feedback visual inmediato al presionar
                btn.onmousedown = () => {
                    if (!btn.classList.contains('disabled')) {
                        btn.style.background = 'linear-gradient(135deg, var(--petrol-light) 0%, var(--accent) 100%)';
                        btn.style.color = 'var(--white)';
                    }
                };
                btn.onmouseup = () => {
                    // Siempre resetear, el onclick manejará el estado active
                    btn.style.background = '';
                    btn.style.color = '';
                };
                btn.onmouseleave = () => {
                    // Siempre resetear si no está active
                    if (!btn.classList.contains('active')) {
                        btn.style.background = '';
                        btn.style.color = '';
                    }
                };
                
                btn.onclick = () => {
                    if (btn.classList.contains('disabled')) return;
                    
                    // Resetear estilos inline de todos los botones
                    document.querySelectorAll('.subcategory-btn').forEach(b => {
                        b.style.background = '';
                        b.style.color = '';
                    });
                    
                    if (btn.classList.contains('active')) {
                        btn.classList.remove('active');
                        activeSubcategory = null;
                    } else {
                        document.querySelectorAll('.subcategory-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        activeSubcategory = subNombre;
                    }
                    updateAdvancedFilters();
                    filterAndRenderProducts();
                };
                container.appendChild(btn);
            });
            
            console.log('✅ Subcategorías renderizadas:', window.subcategoriasFromSheets.length);
        }
        
        // Banner dinámico desde config
        function initBannerDinamico() {
            const bannerEl = document.getElementById('announcementBanner');
            if (!bannerEl) return;
            
            const banner = configFromSheets.banner;
            console.log('🔔 Banner config:', banner);
            
            // Verificar si está activo (puede ser true, 'TRUE', 'true', '1', 1)
            const estaActivo = banner && (banner.activo === true || banner.activo === 'TRUE' || banner.activo === 'true' || banner.activo === '1' || banner.activo === 1);
            
            if (!banner || !estaActivo) {
                console.log('🔔 Banner no activo o no existe');
                bannerEl.classList.add('hidden');
                document.body.classList.remove('banner-visible');
                return;
            }
            
            // Verificar fechas (solo si tienen valor válido)
            const now = new Date();
            const fechaInicioStr = banner.extra2 || banner.fecha_inicio || '';
            const fechaFinStr = banner.extra3 || banner.fecha_fin || '';
            
            // Solo verificar fecha inicio si tiene un valor que parece fecha
            if (fechaInicioStr && fechaInicioStr.length > 5) {
                const fechaInicio = new Date(fechaInicioStr);
                if (!isNaN(fechaInicio.getTime()) && fechaInicio > now) {
                    console.log('🔔 Banner aún no activo (fecha inicio futura)');
                    bannerEl.classList.add('hidden');
                    document.body.classList.remove('banner-visible');
                    return;
                }
            }
            
            // Solo verificar fecha fin si tiene un valor que parece fecha
            if (fechaFinStr && fechaFinStr.length > 5) {
                const fechaFin = new Date(fechaFinStr);
                if (!isNaN(fechaFin.getTime()) && fechaFin < now) {
                    console.log('🔔 Banner expirado');
                    bannerEl.classList.add('hidden');
                    document.body.classList.remove('banner-visible');
                    return;
                }
            }
            
            // Mostrar banner
            const texto = currentLang === 'es' ? (banner.valor_es || '') : (banner.valor_en || banner.valor_es || '');
            const url = banner.extra || '';
            
            let html = `<span>${texto}`;
            if (url && url.trim()) {
                const isExternal = url.startsWith('http') && !url.includes(window.location.hostname);
                const target = isExternal ? ' target="_blank"' : '';
                const linkText = currentLang === 'es' ? 'Más información' : 'More info';
                html += ` <a href="${url}"${target} class="banner-link">${linkText}</a>`;
            }
            html += '</span>';
            html += '<button class="announcement-close" onclick="closeBannerDinamico()">×</button>';
            
            bannerEl.innerHTML = html;
            bannerEl.classList.remove('hidden');
            document.body.classList.add('banner-visible');
            console.log('✅ Banner dinámico inicializado');
        }
        
        // Función global para cerrar banner
        window.closeBannerDinamico = function() {
            document.getElementById('announcementBanner').classList.add('hidden');
            document.body.classList.remove('banner-visible');
        };
        // ========== CHAT CON ADMIN ==========
        let chatUsuarioId = null;
        let chatMensajes = [];
        
        async function initChat() {
            // Obtener ID de usuario (del sistema de auth o generar uno)
            chatUsuarioId = localStorage.getItem('chatUserId');
            if (!chatUsuarioId) {
                chatUsuarioId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('chatUserId', chatUsuarioId);
            }
            await cargarMensajesChat();
        }
        
        async function cargarMensajesChat() {
            try {
                // Obtener configuración de Sheets
                const spreadsheetId = (typeof CONFIG !== 'undefined' && CONFIG.SPREADSHEET_ID) || (typeof SPREADSHEET_ID !== 'undefined' && SPREADSHEET_ID);
                const apiKey = (typeof CONFIG !== 'undefined' && CONFIG.API_KEY) || (typeof API_KEY !== 'undefined' && API_KEY);
                
                if (!spreadsheetId || !apiKey) {
                    console.warn('⚠️ Chat: SPREADSHEET_ID o API_KEY no definidos');
                    return;
                }
                
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/chat?key=${apiKey}`;
                const resp = await fetch(url);
                if (!resp.ok) {
                    console.log('Chat: Hoja no encontrada o vacía');
                    return;
                }
                
                const data = await resp.json();
                if (!data.values || data.values.length < 2) {
                    chatMensajes = [];
                    renderChatUsuario();
                    return;
                }
                
                const headers = data.values[0];
                const rows = data.values.slice(1);
                
                // Filtrar mensajes de este usuario
                chatMensajes = rows
                    .map(row => {
                        const obj = {};
                        headers.forEach((h, i) => obj[h] = row[i] || '');
                        return obj;
                    })
                    .filter(msg => msg.usuario_id === chatUsuarioId || msg.tipo === 'admin' && rows.some(r => r[1] === chatUsuarioId));
                
                // Filtrar solo los del usuario actual
                const misMensajes = [];
                let encontrado = false;
                rows.forEach(row => {
                    const obj = {};
                    headers.forEach((h, i) => obj[h] = row[i] || '');
                    if (obj.usuario_id === chatUsuarioId) {
                        encontrado = true;
                        misMensajes.push(obj);
                    } else if (encontrado && obj.tipo === 'admin' && obj.usuario_id === chatUsuarioId) {
                        misMensajes.push(obj);
                    }
                });
                
                // Filtrar por usuario_id
                chatMensajes = rows
                    .map(row => {
                        const obj = {};
                        headers.forEach((h, i) => obj[h] = row[i] || '');
                        return obj;
                    })
                    .filter(msg => msg.usuario_id === chatUsuarioId);
                
                renderChatUsuario();
            } catch(e) {
                console.error('Error cargando chat:', e);
            }
        }
        
        function renderChatUsuario() {
            const container = document.getElementById('chatMessages');
            if (!container) return;
            
            if (chatMensajes.length === 0) {
                container.innerHTML = '<p class="chat-empty">' + (currentLang === 'es' ? 'No hay mensajes todavía. ¡Escríbenos!' : 'No messages yet. Write to us!') + '</p>';
                return;
            }
            
            container.innerHTML = chatMensajes.map(msg => `
                <div class="chat-msg ${msg.tipo === 'admin' ? 'admin' : 'user'}">
                    <div class="bubble">${msg.mensaje}</div>
                    <div class="meta">${msg.fecha}</div>
                </div>
            `).join('');
            
            container.scrollTop = container.scrollHeight;
        }
        
        async function enviarMensajeChat() {
            const input = document.getElementById('chatInput');
            const mensaje = input?.value.trim();
            if (!mensaje) return;
            
            // Asegurar que chatUsuarioId esté inicializado
            if (!chatUsuarioId) {
                chatUsuarioId = localStorage.getItem('chatUserId');
                if (!chatUsuarioId) {
                    chatUsuarioId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                    localStorage.setItem('chatUserId', chatUsuarioId);
                }
            }
            
            // Verificar si usuario está logueado
            const user = window.getCurrentUser?.() || JSON.parse(localStorage.getItem('tank_iberica_user') || 'null');
            const pseudo = user?.pseudonimo || user?.nombre || 'Usuario';
            const email = user?.email || '';
            
            try {
                // Preparar datos
                // Columnas: id | usuario_id | usuario_pseudo | email | mensaje | fecha | leido | tipo
                const newId = Date.now();
                const fecha = new Date().toLocaleString('es-ES');
                
                const formData = new URLSearchParams();
                formData.append('action', 'appendRow');
                formData.append('sheet', 'chat');
                formData.append('data', JSON.stringify([
                    newId,
                    chatUsuarioId,
                    pseudo,
                    email,
                    mensaje,
                    fecha,
                    'FALSE',
                    'user'
                ]));
                
                // Usar el endpoint del AppsScript (AUTH_CONFIG está en auth-system.js)
                const scriptUrl = window.AUTH_CONFIG?.APPS_SCRIPT_URL;
                console.log('📤 Chat - scriptUrl:', scriptUrl);
                console.log('📤 Chat - chatUsuarioId:', chatUsuarioId);
                
                if (!scriptUrl) {
                    throw new Error('No se ha configurado el servidor. Contacta al administrador.');
                }
                
                const resp = await fetch(scriptUrl, {
                    method: 'POST',
                    body: formData
                });
                
                console.log('📤 Chat - Response status:', resp.status);
                const responseText = await resp.text();
                console.log('📤 Chat - Response text:', responseText);
                
                let result;
                try {
                    result = JSON.parse(responseText);
                } catch(parseErr) {
                    console.error('Error parseando respuesta:', parseErr);
                    throw new Error('Respuesta inválida del servidor');
                }
                
                console.log('📤 Chat - Result:', result);
                if (!result.success) throw new Error(result.message || 'Error enviando mensaje');
                
                // Añadir mensaje localmente
                chatMensajes.push({
                    id: newId,
                    usuario_id: chatUsuarioId,
                    usuario_pseudo: pseudo,
                    email: email,
                    mensaje: mensaje,
                    fecha: fecha,
                    leido: 'FALSE',
                    tipo: 'user'
                });
                
                input.value = '';
                renderChatUsuario();
                
                // Mostrar confirmación
                const chatInfo = document.querySelector('.chat-info');
                if (chatInfo) {
                    chatInfo.innerHTML = '<span style="color:#10b981">✓ ' + (currentLang === 'es' ? 'Mensaje enviado' : 'Message sent') + '</span>';
                    setTimeout(() => {
                        chatInfo.innerHTML = currentLang === 'es' ? 
                            'Los mensajes serán respondidos en un máximo de 2 días laborales.' : 
                            'Messages will be answered within 2 business days.';
                    }, 3000);
                }
                
            } catch(e) {
                console.error('Error enviando mensaje:', e);
                const errorMsg = e?.message || e?.toString() || 'Error desconocido';
                alert('Error al enviar: ' + errorMsg);
            }
        }
        
        // Inicializar chat cuando se abre la sección
        function toggleSection(id) {
            const section = document.getElementById('section-' + id);
            if (section) {
                const isHidden = section.style.display === 'none' || !section.style.display;
                section.style.display = isHidden ? 'block' : 'none';
                
                // Si es chat, inicializarlo
                if (id === 'chat' && isHidden) {
                    initChat();
                }
            }
        }

        
        // Detección de idioma por IP
        async function detectLanguageByIP() {
            // Países hispanohablantes
            const paisesEspanol = ['ES', 'MX', 'AR', 'CO', 'PE', 'VE', 'CL', 'EC', 'GT', 'CU', 'BO', 'DO', 'HN', 'PY', 'SV', 'NI', 'CR', 'PA', 'UY', 'PR', 'GQ'];
            
            try {
                const controller = new AbortController();
                setTimeout(() => controller.abort(), 5000);
                const response = await fetch('https://ipapi.co/json/', { signal: controller.signal });
                if (response.ok) {
                    const data = await response.json();
                    if (paisesEspanol.includes(data.country_code)) {
                        console.log('🌍 País hispanohablante detectado:', data.country_code, '→ Español');
                        currentLang = 'es';
                        switchLanguage('es');
                    } else {
                        console.log('🌍 País detectado:', data.country_code, '→ Inglés');
                        // Solo cambiar si no hay preferencia guardada
                        if (!localStorage.getItem('tank_lang')) {
                            currentLang = 'en';
                            switchLanguage('en');
                        }
                    }
                }
            } catch (e) {
                console.warn('⚠️ No se pudo detectar ubicación por IP');
            }
        }
        
        function applyLanguage() {
            switchLanguage(currentLang); // Usar switchLanguage para aplicar todos los cambios
        }
        
        // ============================================
        // FUNCIONES PARA CONTROLES DE CATÁLOGO
        // ============================================
        
        // Toggle visibilidad del menú lateral
        function toggleMenuVisibility() {
            menuVisible = !menuVisible;
            const menuToggleBtn = document.getElementById('menuToggleBtn');
            const eyeOpenIcon = document.getElementById('eyeOpenIcon');
            const eyeClosedIcon = document.getElementById('eyeClosedIcon');
            
            document.body.classList.toggle('menu-hidden', !menuVisible);
            menuToggleBtn.classList.toggle('menu-visible', menuVisible);
            
            if (menuVisible) {
                eyeOpenIcon.style.display = 'block';
                eyeClosedIcon.style.display = 'none';
            } else {
                eyeOpenIcon.style.display = 'none';
                eyeClosedIcon.style.display = 'block';
            }
        }
        
        // Cambiar vista Grid/Tabla
        function changeView(view) {
            currentView = view;
            const viewBtns = document.querySelectorAll('.view-btn');
            viewBtns.forEach(btn => {
                btn.classList.toggle('active', btn.dataset.view === view);
            });
            
            // Cambiar clase del catálogo
            const catalog = document.getElementById('catalog');
            if (catalog) {
                if (view === 'table') {
                    catalog.classList.add('table-view');
                    catalog.classList.remove('grid-view');
                } else {
                    catalog.classList.remove('table-view');
                    catalog.classList.add('grid-view');
                }
            }
            
            // Re-renderizar productos con la nueva vista
            if (typeof filterAndRenderProducts === 'function') {
                filterAndRenderProducts();
            }
            
            console.log('🔄 Vista cambiada a:', view);
        }
        
        // Toggle filtrar por favoritos
        function toggleFavorites() {
            showOnlyFavorites = !showOnlyFavorites;
            const favoritesBtn = document.getElementById('favoritesBtn');
            favoritesBtn.classList.toggle('active', showOnlyFavorites);
            
            if (typeof filterAndRenderProducts === 'function') {
                filterAndRenderProducts();
            }
        }
        
        // Abrir modal de solicitud
        function abrirModalSolicitud() {
            const modal = document.getElementById('solicitudModal');
            if (modal) {
                modal.classList.add('active');
            }
        }
        
        // Exportar funciones necesarias para onclick
        window.enviarMensajeChat = enviarMensajeChat;
        window.toggleSection = toggleSection;
        window.initChat = initChat;
        window.toggleMenuVisibility = toggleMenuVisibility;
        window.changeView = changeView;
        window.toggleFavorites = toggleFavorites;
        window.abrirModalSolicitud = abrirModalSolicitud;
        
        // Cargar datos al iniciar
        window.addEventListener('DOMContentLoaded', async () => {
            // Detectar idioma por IP primero
            await detectLanguageByIP();
            const sheetsLoaded = await cargarDatosDeSheets();
            
            if (sheetsLoaded) {
                console.log('🎉 Sistema funcionando con Google Sheets');
            } else {
                console.log('📝 Sistema funcionando con datos de ejemplo');
            }
            
            // Menús móviles: click para toggle (abrir/cerrar)
            document.querySelectorAll('.mobile-menu-group').forEach(group => {
                const trigger = group.querySelector('.mobile-trigger');
                if (trigger) {
                    trigger.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        // Cerrar otros menús
                        document.querySelectorAll('.mobile-menu-group').forEach(g => {
                            if (g !== group) g.classList.remove('active');
                        });
                        // Toggle este menú
                        group.classList.toggle('active');
                    });
                }
            });
            
            // Selector de idioma móvil - click en opción alternativa cambia idioma
            const mobileLangAlt = document.getElementById('mobileLangAlt');
            if (mobileLangAlt) {
                mobileLangAlt.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const lang = mobileLangAlt.dataset.lang;
                    setLang(lang);
                    document.getElementById('mobileLangMenu')?.classList.remove('active');
                });
            }
            
            // Cerrar menús al click fuera
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.mobile-menu-group')) {
                    document.querySelectorAll('.mobile-menu-group').forEach(g => g.classList.remove('active'));
                }
            });
            
            // Buscador móvil: click en lupa toggle
            const searchWrapper = document.getElementById('searchWrapper');
            const searchBtnIcon = document.getElementById('searchBtnIcon');
            const searchInputMobile = document.getElementById('searchInputMobile');
            
            if (searchBtnIcon && searchWrapper) {
                searchBtnIcon.addEventListener('click', (e) => {
                    e.stopPropagation();
                    searchWrapper.classList.toggle('active');
                    if (searchWrapper.classList.contains('active') && searchInputMobile) {
                        searchInputMobile.focus();
                    }
                });
                
                document.addEventListener('click', (e) => {
                    if (!searchWrapper.contains(e.target)) {
                        searchWrapper.classList.remove('active');
                    }
                });
            }
            
            // Buscador desktop: botón X para limpiar
            const searchInput = document.getElementById('searchInput');
            const searchClearBtn = document.getElementById('searchClearBtn');
            
            if (searchInput && searchClearBtn) {
                // Mostrar/ocultar X según contenido
                searchInput.addEventListener('input', () => {
                    searchClearBtn.style.display = searchInput.value.length > 0 ? 'flex' : 'none';
                    // Sincronizar con móvil
                    if (searchInputMobile) {
                        searchInputMobile.value = searchInput.value;
                    }
                    // Filtrar
                    if (typeof filterAndRenderProducts === 'function') {
                        filterAndRenderProducts();
                    }
                });
                
                // Click en X limpia búsqueda
                searchClearBtn.addEventListener('click', () => {
                    searchInput.value = '';
                    searchClearBtn.style.display = 'none';
                    if (searchInputMobile) {
                        searchInputMobile.value = '';
                    }
                    searchInput.focus();
                    if (typeof filterAndRenderProducts === 'function') {
                        filterAndRenderProducts();
                    }
                });
            }
            
            // Sincronizar input móvil con desktop
            if (searchInputMobile) {
                searchInputMobile.addEventListener('input', () => {
                    if (searchInput) {
                        searchInput.value = searchInputMobile.value;
                        searchClearBtn.style.display = searchInputMobile.value.length > 0 ? 'flex' : 'none';
                    }
                    if (typeof filterAndRenderProducts === 'function') {
                        filterAndRenderProducts();
                    }
                });
            }
            
            // Dropdown de Ordenar
            const sortDropdownWrapper = document.getElementById('sortDropdownWrapper');
            const sortBtn = document.getElementById('sortBtn');
            const sortOptions = document.querySelectorAll('.sort-option');
            
            if (sortBtn && sortDropdownWrapper) {
                sortBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    sortDropdownWrapper.classList.toggle('active');
                });
                
                document.addEventListener('click', (e) => {
                    if (!sortDropdownWrapper.contains(e.target)) {
                        sortDropdownWrapper.classList.remove('active');
                    }
                });
                
                sortOptions.forEach(option => {
                    option.addEventListener('click', () => {
                        sortOptions.forEach(o => o.classList.remove('active'));
                        option.classList.add('active');
                        sortDropdownWrapper.classList.remove('active');
                        const sortValue = option.dataset.sort;
                        // Aplicar ordenación usando currentFilters.sortBy
                        currentFilters.sortBy = sortValue;
                        console.log('🔄 Ordenar por:', sortValue);
                        if (typeof filterAndRenderProducts === 'function') {
                            filterAndRenderProducts();
                        }
                    });
                });
            }
        });
    </script>

    <!-- MODAL DE AUTENTICACIÓN -->
    <div id="authModal" class="auth-modal">
        <!-- Contenido generado dinámicamente por auth-system.js -->
    </div>

    <!-- PANEL DE USUARIO -->
    <!-- PANEL MI CUENTA (slide desde derecha 33%) -->
    <div id="userPanel" class="user-panel">
        <div class="user-panel-overlay" onclick="cerrarPanelUsuario()"></div>
        <div class="user-panel-content">
            <button class="user-panel-close" onclick="cerrarPanelUsuario()">&times;</button>
            
            <!-- Header -->
            <div class="user-panel-header">
                <div class="user-avatar">
                    <span id="userAvatarInitial">U</span>
                </div>
                <div class="user-header-info">
                    <h2 id="userPseudo">Mi cuenta</h2>
                    <p class="user-email" id="userEmail"></p>
                </div>
            </div>
            
            <!-- Menú acordeón -->
            <div class="user-panel-menu">
                
                <!-- PERFIL -->
                <div class="user-panel-section">
                    <button class="section-header" onclick="toggleSection('perfil')">
                        <span>👤 Perfil</span>
                        <span class="section-arrow">▼</span>
                    </button>
                    <div class="section-content" id="section-perfil">
                        <div class="perfil-content">
                            <div class="perfil-field">
                                <label data-es="Pseudónimo" data-en="Username">Pseudónimo</label>
                                <input type="text" id="perfilPseudo" disabled>
                                <small data-es="🔒 No editable directamente" data-en="🔒 Not directly editable">🔒 No editable directamente</small>
                            </div>
                            <div class="perfil-field">
                                <label data-es="Nombre y Apellidos" data-en="Full Name">Nombre y Apellidos</label>
                                <input type="text" id="perfilNombre" disabled>
                                <small data-es="🔒 No editable directamente" data-en="🔒 Not directly editable">🔒 No editable directamente</small>
                            </div>
                            <div class="perfil-field">
                                <label data-es="Teléfono" data-en="Phone">Teléfono</label>
                                <input type="tel" id="perfilTelefono" placeholder="+34 600 000 000">
                            </div>
                            <div class="perfil-field">
                                <label data-es="Email" data-en="Email">Email</label>
                                <input type="email" id="perfilEmail">
                            </div>
                            <button class="btn-primary" onclick="guardarDatosPerfil()" data-es="💾 Guardar cambios" data-en="💾 Save changes">💾 Guardar cambios</button>
                            
                            <hr>
                            
                            <button class="btn-warning" onclick="abrirModalActualizarDatos()" data-es="📝 Solicitar actualización de datos" data-en="📝 Request data update">📝 Solicitar actualización de datos</button>
                            
                            <div id="eliminarCuentaContainer">
                                <button class="btn-danger" id="btnEliminarCuenta" onclick="abrirModalEliminarCuenta()" data-es="🗑️ Eliminar cuenta" data-en="🗑️ Delete account">🗑️ Eliminar cuenta</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- CHAT -->
                <div class="user-panel-section">
                    <button class="section-header" onclick="toggleSection('chat')">
                        <span>💬 Chat</span>
                        <span class="section-arrow">▼</span>
                    </button>
                    <div class="section-content" id="section-chat">
                        <div class="chat-container">
                            <div class="chat-messages" id="chatMessages">
                                <p class="chat-empty" data-es="No hay mensajes todavía" data-en="No messages yet">No hay mensajes todavía</p>
                            </div>
                            <div class="chat-input-container">
                                <textarea id="chatInput" placeholder="Escribe tu mensaje..." rows="3"></textarea>
                                <button class="btn-primary" onclick="enviarMensajeChat()" data-es="Enviar" data-en="Send">Enviar</button>
                            </div>
                            <p class="chat-info" data-es="Los mensajes serán respondidos en un máximo de 2 días laborales." data-en="Messages will be answered within 2 business days.">Los mensajes serán respondidos en un máximo de 2 días laborales.</p>
                        </div>
                    </div>
                </div>
                
                <!-- FAVORITOS -->
                <div class="user-panel-section">
                    <button class="section-header" onclick="toggleSection('favoritos')">
                        <span>⭐ Favoritos</span>
                        <span class="section-arrow">▼</span>
                    </button>
                    <div class="section-content" id="section-favoritos">
                        <div class="favoritos-filtros">
                            <select id="favFilterCategoria" onchange="filtrarFavoritos()">
                                <option value="" data-es="Todas las categorías" data-en="All categories">Todas las categorías</option>
                                <option value="alquiler" data-es="Alquiler" data-en="Rental">Alquiler</option>
                                <option value="venta" data-es="Venta" data-en="Sale">Venta</option>
                                <option value="terceros" data-es="Terceros" data-en="Third party">Terceros</option>
                            </select>
                            <select id="favFilterVehiculo" onchange="filtrarFavoritos()">
                                <option value="" data-es="Todos los vehículos" data-en="All vehicles">Todos los vehículos</option>
                                <option value="Cisternas">Cisternas</option>
                                <option value="Tractoras">Tractoras</option>
                                <option value="Rígidos">Rígidos</option>
                                <option value="Semirremolques">Semirremolques</option>
                                <option value="Remolques">Remolques</option>
                                <option value="Otros">Otros</option>
                            </select>
                            <select id="favFilterOrden" onchange="filtrarFavoritos()">
                                <option value="recomendado" data-es="Recomendado" data-en="Recommended">Recomendado</option>
                                <option value="año_asc" data-es="Año ↑" data-en="Year ↑">Año ↑</option>
                                <option value="año_desc" data-es="Año ↓" data-en="Year ↓">Año ↓</option>
                                <option value="precio_asc" data-es="Precio ↑" data-en="Price ↑">Precio ↑</option>
                                <option value="precio_desc" data-es="Precio ↓" data-en="Price ↓">Precio ↓</option>
                            </select>
                        </div>
                        <div class="favoritos-grid" id="userFavorites">
                            <p class="empty-state" data-es="No tienes favoritos todavía" data-en="No favorites yet">No tienes favoritos todavía</p>
                        </div>
                    </div>
                </div>
                
                <!-- SOLICITUDES -->
                <div class="user-panel-section">
                    <button class="section-header" onclick="toggleSection('solicitudes')">
                        <span>🔍 Solicitudes</span>
                        <span class="section-arrow">▼</span>
                    </button>
                    <div class="section-content" id="section-solicitudes">
                        <p class="solicitudes-info" data-es="Describe el vehículo que buscas y te avisaremos cuando tengamos uno disponible." data-en="Describe the vehicle you're looking for and we'll notify you when one is available.">
                            Describe el vehículo que buscas y te avisaremos cuando tengamos uno disponible.
                        </p>
                        <div id="misSolicitudes">
                            <p class="empty-state" data-es="No tienes solicitudes activas" data-en="No active requests">No tienes solicitudes activas</p>
                        </div>
                        <button class="btn-primary" onclick="abrirModalNuevaSolicitud()" data-es="➕ Nueva solicitud" data-en="➕ New request">➕ Nueva solicitud</button>
                    </div>
                </div>
                
                <!-- ANUNCIOS -->
                <div class="user-panel-section">
                    <button class="section-header" onclick="toggleSection('anuncios')">
                        <span>📢 Mis Anuncios</span>
                        <span class="section-arrow">▼</span>
                    </button>
                    <div class="section-content" id="section-anuncios">
                        <div class="anuncios-content" id="misAnuncios">
                            <p class="empty-state" data-es="No tienes anuncios publicados" data-en="No published ads">No tienes anuncios publicados</p>
                        </div>
                    </div>
                </div>
                
                <!-- FACTURAS -->
                <div class="user-panel-section">
                    <button class="section-header" onclick="toggleSection('facturas')">
                        <span>🧾 Facturas</span>
                        <span class="section-arrow">▼</span>
                    </button>
                    <div class="section-content" id="section-facturas">
                        <div class="facturas-filtros">
                            <select id="facturasFiltroTipo" onchange="filtrarFacturas()">
                                <option value="" data-es="Todas las facturas" data-en="All invoices">Todas las facturas</option>
                                <option value="compra" data-es="Compras" data-en="Purchases">Compras</option>
                                <option value="venta" data-es="Ventas" data-en="Sales">Ventas</option>
                            </select>
                            <select id="facturasFiltroAno" onchange="filtrarFacturas()">
                                <option value="" data-es="Todos los años" data-en="All years">Todos los años</option>
                            </select>
                        </div>
                        <div class="facturas-content" id="misFacturas">
                            <p class="empty-state" data-es="No tienes facturas" data-en="No invoices">No tienes facturas</p>
                        </div>
                        <p class="facturas-info" data-es="Aquí aparecerán las facturas de vehículos comprados o vendidos a/través de Tank Ibérica" data-en="Invoices for vehicles bought or sold to/through Tank Ibérica will appear here">
                            Aquí aparecerán las facturas de vehículos comprados o vendidos a/través de Tank Ibérica
                        </p>
                    </div>
                </div>
                
                <!-- SUSCRIPCIONES -->
                <div class="user-panel-section">
                    <button class="section-header" onclick="toggleSection('suscripciones')">
                        <span>📬 Suscripciones</span>
                        <span class="section-arrow">▼</span>
                    </button>
                    <div class="section-content" id="section-suscripciones">
                        <div class="subs-content">
                            <h4 data-es="Recibir notificaciones de:" data-en="Receive notifications for:">Recibir notificaciones de:</h4>
                            <label class="checkbox-label">
                                <input type="checkbox" id="subsPrensa" onchange="guardarSuscripciones()">
                                <span data-es="📰 Área de Prensa" data-en="📰 Press Area">📰 Área de Prensa</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="subsBoletines" onchange="guardarSuscripciones()">
                                <span data-es="📧 Boletines" data-en="📧 Newsletters">📧 Boletines</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="subsDestacados" onchange="guardarSuscripciones()">
                                <span data-es="⭐ Vehículos Destacados" data-en="⭐ Featured Vehicles">⭐ Vehículos Destacados</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="subsEventos" onchange="guardarSuscripciones()">
                                <span data-es="🎉 Eventos" data-en="🎉 Events">🎉 Eventos</span>
                            </label>
                        </div>
                    </div>
                </div>
                
            </div>
            
            <!-- Footer -->
            <div class="user-panel-footer">
                <button class="btn-logout" id="logoutBtn" onclick="cerrarSesionPanel()">
                    <span data-es="🚪 Cerrar sesión" data-en="🚪 Sign out">🚪 Cerrar sesión</span>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Modal: Actualizar Datos -->
    <div class="modal" id="modalActualizarDatos">
        <div class="modal-overlay" onclick="cerrarModal('modalActualizarDatos')"></div>
        <div class="modal-content" style="max-width:450px">
            <button class="modal-close" onclick="cerrarModal('modalActualizarDatos')">&times;</button>
            <h3 data-es="📝 Solicitud de actualización de datos" data-en="📝 Data update request">📝 Solicitud de actualización de datos</h3>
            <div class="auth-form">
                <div class="form-group">
                    <label data-es="¿Qué desea actualizar?" data-en="What do you want to update?">¿Qué desea actualizar?</label>
                    <select id="actualizarQue" onchange="mostrarCamposActualizar()">
                        <option value="pseudo" data-es="Pseudónimo" data-en="Username">Pseudónimo</option>
                        <option value="nombre" data-es="Nombre y Apellidos" data-en="Full Name">Nombre y Apellidos</option>
                        <option value="ambos" data-es="Ambos" data-en="Both">Ambos</option>
                    </select>
                </div>
                <div class="form-group" id="campoNuevoPseudo">
                    <label data-es="Nuevo pseudónimo" data-en="New username">Nuevo pseudónimo</label>
                    <input type="text" id="nuevoPseudo" placeholder="Nuevo pseudónimo">
                </div>
                <div class="form-group" id="campoNuevoNombre" style="display:none">
                    <label data-es="Nuevo nombre y apellidos" data-en="New full name">Nuevo nombre y apellidos</label>
                    <input type="text" id="nuevoNombre" placeholder="Nombre y Apellidos">
                </div>
                <button class="btn-primary" onclick="enviarSolicitudActualizar()" data-es="Enviar solicitud" data-en="Send request">Enviar solicitud</button>
                <div class="auth-message" id="msgActualizar"></div>
            </div>
        </div>
    </div>
    
    <!-- Modal: Eliminar Cuenta -->
    <div class="modal" id="modalEliminarCuenta">
        <div class="modal-overlay" onclick="cerrarModal('modalEliminarCuenta')"></div>
        <div class="modal-content" style="max-width:450px">
            <button class="modal-close" onclick="cerrarModal('modalEliminarCuenta')">&times;</button>
            <h3 data-es="🗑️ Eliminar cuenta" data-en="🗑️ Delete account">🗑️ Eliminar cuenta</h3>
            <div class="auth-form" id="formEliminarCuenta">
                <p class="auth-error" style="display:block" data-es="Esta acción desactivará tu cuenta. Perderás acceso a tus favoritos, historial y suscripciones." data-en="This action will deactivate your account. You will lose access to your favorites, history and subscriptions.">
                    Esta acción desactivará tu cuenta. Perderás acceso a tus favoritos, historial y suscripciones.
                </p>
                <div class="form-group">
                    <label data-es="Escribe 'Borrar cuenta' para confirmar:" data-en="Type 'Borrar cuenta' to confirm:">Escribe "Borrar cuenta" para confirmar:</label>
                    <input type="text" id="confirmarEliminar" placeholder="Borrar cuenta">
                </div>
                <button class="btn-danger" onclick="confirmarEliminarCuenta()" data-es="Confirmar eliminación" data-en="Confirm deletion">Confirmar eliminación</button>
                <div class="auth-message" id="msgEliminar"></div>
            </div>
            <div class="auth-form" id="formCancelarEliminacion" style="display:none">
                <p class="auth-info" style="display:block" data-es="Tu cuenta está pendiente de eliminación. Puedes cancelar el proceso." data-en="Your account is pending deletion. You can cancel the process.">
                    Tu cuenta está pendiente de eliminación. Puedes cancelar el proceso.
                </p>
                <div class="form-group">
                    <label data-es="Escribe 'Mantener cuenta' para cancelar:" data-en="Type 'Mantener cuenta' to cancel:">Escribe "Mantener cuenta" para cancelar:</label>
                    <input type="text" id="confirmarMantener" placeholder="Mantener cuenta">
                </div>
                <button class="btn-primary" onclick="cancelarEliminacionCuenta()" data-es="Mantener mi cuenta" data-en="Keep my account">Mantener mi cuenta</button>
                <div class="auth-message" id="msgMantener"></div>
            </div>
        </div>
    </div>
    
    <!-- Modal: Nueva Solicitud de Vehículo -->
    <div class="modal" id="modalNuevaSolicitud">
        <div class="modal-overlay" onclick="cerrarModal('modalNuevaSolicitud')"></div>
        <div class="modal-content" style="max-width:500px">
            <button class="modal-close" onclick="cerrarModal('modalNuevaSolicitud')">&times;</button>
            <h3 data-es="🔍 Nueva solicitud de búsqueda" data-en="🔍 New search request">🔍 Nueva solicitud de búsqueda</h3>
            <p data-es="Describe el vehículo que buscas y te avisaremos cuando tengamos uno disponible." data-en="Describe the vehicle you're looking for and we'll notify you when we have one available.">
                Describe el vehículo que buscas y te avisaremos cuando tengamos uno disponible.
            </p>
            <div class="auth-form">
                <div class="form-group">
                    <label data-es="Tipo de vehículo" data-en="Vehicle type">Tipo de vehículo</label>
                    <select id="solicitudTipo">
                        <option value="">Seleccionar...</option>
                        <option value="Cisternas">Cisternas</option>
                        <option value="Tractoras">Tractoras</option>
                        <option value="Rígidos">Rígidos</option>
                        <option value="Semirremolques">Semirremolques</option>
                        <option value="Remolques">Remolques</option>
                        <option value="Otros">Otros</option>
                    </select>
                </div>
                <div class="form-group">
                    <label data-es="Presupuesto máximo (€)" data-en="Maximum budget (€)">Presupuesto máximo (€)</label>
                    <input type="number" id="solicitudPresupuesto" placeholder="50000">
                </div>
                <div class="form-group">
                    <label data-es="Año mínimo" data-en="Minimum year">Año mínimo</label>
                    <input type="number" id="solicitudAno" placeholder="2015">
                </div>
                <div class="form-group">
                    <label data-es="Criterios adicionales" data-en="Additional criteria">Criterios adicionales</label>
                    <textarea id="solicitudCriterios" rows="3" placeholder="ADR, ATP, marca específica, etc."></textarea>
                </div>
                <button class="btn-primary" onclick="enviarSolicitudVehiculo()" data-es="Enviar solicitud" data-en="Send request">Enviar solicitud</button>
                <div class="auth-message" id="msgSolicitud"></div>
            </div>
        </div>
    </div>

    <!-- PWA Service Worker - DESACTIVADO TEMPORALMENTE
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('✅ Service Worker registrado:', registration.scope);
                    })
                                        .catch((error) => {
                                                                                                                    console.log('❌ Error registrando Service Worker:', error);
                    });
            });
        }
    </script>
    -->

</body>
</html>
