# STATUS ‚Äî Tracciona

**√öltima actualizaci√≥n:** 2026-03-10 ‚Äî INSTRUCCIONES-MAESTRAS.md (9.316L) ‚Üí legacy + BACKLOG.md (200L). Total sesi√≥n: ~11.700 l√≠neas eliminadas/movidas a legacy
**Sesiones completadas:** 0‚Äì64 + Iter 1‚Äì16 auditor√≠a + sesiones ad-hoc hasta 08-mar
**Puntuaci√≥n global:** 79/100 (auditor√≠a 26-feb) ¬∑ Historial completo: `git log STATUS.md`

---

## M√©tricas reales del proyecto

| M√≥dulo           | Real (verificado 28-feb)                         |
| ---------------- | ------------------------------------------------ |
| P√°ginas Vue      | 125                                              |
| Componentes Vue  | 418                                              |
| Composables      | 147                                              |
| Endpoints API    | 62                                               |
| Servicios server | 8                                                |
| Migraciones SQL  | 65                                               |
| Tablas BD        | 89                                               |
| Tests totales    | 34 (12 E2E + 5 seg + 11 unit + 3 comp + 3 setup) |
| CI/CD workflows  | 7                                                |

---

## Estado por m√≥dulo

| M√≥dulo                    | Estado         | Notas                                                           |
| ------------------------- | -------------- | --------------------------------------------------------------- |
| Cat√°logo + filtros        | ‚úÖ Completo    | FilterBar refactorizado ‚Äî todos los archivos <500 l√≠neas        |
| Fichas de veh√≠culo        | ‚úÖ Completo    | SEO, JSON-LD, OG, hreflang, breadcrumbs                         |
| Auth + perfiles           | ‚úÖ Completo    | Supabase Auth, Google Login, Turnstile CAPTCHA                  |
| Admin panel               | ‚úÖ Completo    | ~115 strings sin i18n (bajo impacto, solo 2 personas)           |
| Noticias y gu√≠as          | ‚úÖ Completo    |                                                                 |
| Legal / GDPR              | ‚úÖ Completo    | RAT no formalizado                                              |
| Verificaci√≥n veh√≠culos    | ‚úÖ Completo    |                                                                 |
| Subastas                  | ‚úÖ Completo    |                                                                 |
| Publicidad + ads          | ‚úÖ Completo    |                                                                 |
| Pagos Stripe              | ‚úÖ Completo    | Webhooks con firma HMAC                                         |
| PWA + offline             | ‚úÖ Completo    |                                                                 |
| CI/CD                     | ‚úÖ Completo    | lint, typecheck, build, E2E, Lighthouse, DAST, backup           |
| WhatsApp pipeline         | ‚úÖ Completo    |                                                                 |
| Multi-vertical            | ‚úÖ Completo    | Columna `vertical` en tablas clave                              |
| Dashboard dealer          | ‚úÖ Completo    |                                                                 |
| Transparencia DSA         | ‚úÖ Completo    |                                                                 |
| Admin KPI + m√©tricas      | ‚úÖ Completo    |                                                                 |
| Alertas y favoritos       | ‚úÖ Completo    |                                                                 |
| Herramientas dealer       | ‚úÖ Completo    |                                                                 |
| Datos mercado p√∫blico     | ‚úÖ Completo    |                                                                 |
| Infra monitoring          | ‚úÖ Completo    |                                                                 |
| Monetizaci√≥n avanzada     | ‚úÖ Completo    | Trials 14d, dunning, API keys dealers                           |
| Event bus + feature flags | ‚úÖ Completo    |                                                                 |
| SEO avanzado              | ‚úÖ Completo    | Schema.org, hreflang, canonical, sitemap din√°mico               |
| P√°ginas de error          | ‚úÖ Completo    | 404/500/503 con contexto                                        |
| Seguridad                 | ‚ö†Ô∏è Parcial     | Rate limiting **deshabilitado en producci√≥n** ‚Äî requiere CF WAF |
| Landing pages builder     | üîµ Pospuesto   | Solo si dealers lo solicitan activamente                        |
| Prebid demand partners    | üîµ Placeholder | Estructura lista, sin cuentas reales                            |
| API valoraci√≥n (/v1)      | üîµ Pospuesto   | Devuelve 503 hasta ‚â•500 transacciones hist√≥ricas                |

---

## Errores activos

| ID   | Severidad | Problema                                                                                  | Acci√≥n                                |
| ---- | --------- | ----------------------------------------------------------------------------------------- | ------------------------------------- |
| P0-3 | üî¥ P0     | Rate limiting deshabilitado en producci√≥n (in-memory no funciona en CF Workers stateless) | Configurar reglas CF WAF (fundadores) |

> Todos los dem√°s errores (P0-1/2, P1-1/2/3, P2-1/2/3, S-01, S-03) resueltos. Ver `git log STATUS.md`.

---

## Auditor√≠a #7 ‚Äî Archivos >500 l√≠neas

Iter 1‚Äì16 completas ‚úÖ. Todos los archivos >500 l√≠neas resueltos. FilterBarDesktop 560‚Üí443 v√≠a useHorizontalScroll + filter-bar-shared.css.

---

## Pendientes documentaci√≥n y infra

- [ ] `docs/ESTADO-REAL-PRODUCTO.md` eliminado (regenerable con `scripts/generate-estado-real.sh`)
- [ ] RAT (Registro Actividades de Tratamiento) GDPR no formalizado como documento legal
- [ ] **Script infra_metrics:** Crear script manual (nunca cron) que recolecte m√©tricas de Supabase/Cloudflare/Cloudinary e inserte en `infra_metrics`. Llamar peri√≥dicamente (ej: GitHub Actions workflow manual o cron-job.org)

---

## Changelog de sesiones

| Fecha     | Resumen                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| --------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 10-mar    | INSTRUCCIONES-MAESTRAS.md (9.316L) ‚Üí `docs/legacy/` + creado `BACKLOG.md` (200L, 20 items). Eliminados 7 archivos obsoletos (~1.825L) + fusionados 3 READMEs. Total: ~11.700L movidas/eliminadas. Refs actualizadas en CLAUDE.md, README.md, CONTRIBUTING.md, PROYECTO-CONTEXTO.md, 4 commands, 1 script, 10 legacy banners.                                                                                                                                                                                                                                                                                                                                                                                        |
| 10-mar    | Split PROYECTO-CONTEXTO.md: 1597‚Üí495 l√≠neas (~33K‚Üí~12K tokens). Creado `ESTRATEGIA-NEGOCIO.md` (844‚Üí870L) + `IDEAS-A-REVISAR.md` (167L, 92 ideas). 8 ideas nuevas desde 25 anexos.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| 09-mar    | Estrategia marketing: revisi√≥n Anexo J (AdSense + Google Ads). ¬ß3.5 expandido (6 campa√±as, Campa√±a 0 branded, presupuesto progresivo, reglas parada/escalado, GTM). ¬ß3.16 nuevo (AdSense como puente, CPMs conservadores, cu√°ndo activar >100 veh√≠culos, roadmap redes).                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| 09-mar    | Split card UX: hidden vehicles arriba en split, gold variant m√°s llamativa (gradiente √°mbar, badge #f59e0b, borde card, min-height). Pills de nivel dentro del desplegable de ubicaci√≥n (FilterBarLocationPicker, provide/inject). Removida fila standalone de index.vue. Build limpio.                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 09-mar    | PromoCards + early access + dealer portal: `CatalogPromoCard` (formato ficha veh√≠culo, split 2-en-1, 4 variantes color), `useHiddenVehicles` (conteo visible_from>now + horas, dev mock 3/12h), `useSimilarSearches` cascada multinivel (depth 1/2/3, m√°x 8+6+4 splits, location prioritaria), `VehicleGrid` refactorizado (split card pos ~3: demanda+ocultos, cascade al final, 0-results grid promos), dealer portal: card sutil "Descubre m√°s en Tracciona" al final (sin promo invasiva). ¬ß5.1.3/5.1.4 PROYECTO-CONTEXTO documentados. Build limpio.                                                                                                                                                           |
| 09-mar    | Geo-fallback + b√∫squedas similares + demand card: `useGeoFallback` (escalera 8 niveles, pre-fetch count, thresholds), `useSimilarSearches` (relajaci√≥n brand/precio/a√±o, max 3), `CatalogEmptyState` (card demanda + similar searches + expand area, 2 modos), `CatalogLocationLevelPills` (scroll horizontal, patr√≥n CategoryBar), `fetchCount()` en useVehicles (shared applyFilters), migraci√≥n BD `preferred_location_level` en users+profiles, selector en perfil/datos.vue, i18n ES+EN 25 claves nuevas. Build limpio.                                                                                                                                                                                        |
| 08-mar    | Accesibilidad sistema completo: CSS Relative Color Syntax para HC state colors (hue rotation ¬±60/150/210/270 desde --color-primary) + @supports fallback ~8% browsers. Dark mode bg desaturado con color-mix. Global transition ‚Üí selectores espec√≠ficos + prefers-reduced-motion. Fondo #fff‚Üí#faf9f8. Header offset din√°mico (--header-offset/--header-offset-desktop en tokens.css, overrides en themes.css por data-font-size). Logo px fijo (no rem) + line-height:1. 8 componentes height‚Üímin-height (CategoryBar, AppHeader√ó2, api.vue, SubastasDetailError, UserPanel, AdminHeader, AdminNewsSeoPanel). UserPanel.vue + UserPanelSection.vue: todos los colores hardcoded ‚Üí tokens sem√°nticos. Build limpio. |
| 07-mar    | Localizaci√≥n autom√°tica: plugin `locale-by-country.client.ts` (IP‚Üíidioma, prioridad: DB lang > cookie > CF IP > 'es'). Perfil: `preferred_country` en BD + selector con 3 grupos (Principales/Europa/Latam). `getLocaleFallbackForCountry` + `getProfileCountries` en geoData.ts. Footer: eliminados Kit Digital + bot√≥n Admin. CLAUDE.md: principios dise√±o/construcci√≥n. Chat: trigger `trg_seller_response_time` (media de respuesta vendedor), badge "Responde aprox. en ~Xh" visible solo para el comprador en ConversationHeader. Build limpio.                                                                                                                                                               |
| 06-mar    | Cr√©ditos y suscripciones: 3 tiers (Basic gratis/Classic ‚Ç¨19/Premium ‚Ç¨39), tabla funcionalidades por tier, escala cr√©ditos 1-3, 5 packs (1/3/10/25/50) con bonus desde Est√°ndar, Reserva Prioritaria + Anuncio protegido definidos, 10 ideas monetizaci√≥n "A definir". ¬ß2.4.1 reescrito, ¬ß2.8 Sistema Pro eliminado.                                                                                                                                                                                                                                                                                                                                                                                                 |
| 05-mar    | Sistema cr√©ditos: migraci√≥n BD (credit_packs, user_credits, credit_transactions + seed 5 packs), checkout Stripe one-time, webhook handler, secci√≥n UI en /precios#creditos, i18n ES+EN, documentado en PROYECTO-CONTEXTO.md ¬ß2.4.1. Uso de cr√©ditos TBD.                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| 01-mar    | Estrategia datos: ¬ß2.11.6 (12 datos comportamentales), ¬ß2.12 Silent Safety anti-fraude (7 subsecciones), ¬ß3.4.1 gu√≠as compra/venta. 3 features: sale price en SoldModal, zero-result search logging, vehicle duration tracking.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| 05-mar    | Dealer portal + admin branding: SharedImageUploader (Cloudinary, preview, recomendaciones), bg removal (e_background_removal), SharedLogoTextConfig (10 fuentes, peso/espaciado/cursiva/may√∫sculas). favicon_url + logo_text_config en BD (dealers + vertical_config). SoldModal: sale price + sold_at.                                                                                                                                                                                                                                                                                                                                                                                                             |
| 05-mar    | Auditor√≠a #7 iter 16: FilterBarDesktop 560‚Üí443 l√≠neas. useHorizontalScroll composable + filter-bar-shared.css (DRY Desktop/Mobile). Hover ‚Üí @media(hover:hover). Build limpio.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 05-mar    | UX forms & touch: autocomplete en 26 formularios; errores descriptivos por campo con aria; hover CSS ‚Üí @media(hover:hover) en 6 componentes; interactions.css global; fix i18n JSON (llave extra en es.json y en.json). Build limpio.                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| 04-mar    | Chat buyer-seller: bot√≥n "Contactar vendedor" en ficha veh√≠culo ‚Üí modal ‚Üí conversaci√≥n; resuelto `other_party_name` (JOIN users); preview √∫ltimo mensaje; badge unread en header; fix RLS `markAsRead`; 15 keys i18n a√±adidas.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 04-mar    | Fix cr√≠tico RLS: 96 pol√≠ticas admin cambio `FROM auth.users au` ‚Üí `is_admin()` SECURITY DEFINER (causa ra√≠z "permission denied for table users"). Clarificado scraping vs scheduled tasks en PROYECTO-CONTEXTO.md. Pendiente: script infra_metrics.                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| 04-mar    | Alias `curro`: cambio a `--prompt "inicio"` para auto-trigger sin input del usuario                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| 04-mar    | Alias `curro` creado en perfil PowerShell (--model opus + auto-lectura 3 docs); regla PROYECTO-CONTEXTO.md actualizaci√≥n en tiempo real                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 04-mar    | Fix 4 bugs auth: AdminSidebar component names, fetchProfile DB columns (full_name‚Üíname, preferred_locale‚Üílang), plugin timing                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| 04-mar    | UserPanel role-aware: reemplaza dropdown header; nav condicional buyer/dealer/admin; eliminado dropdown + CSS muerto de AppHeader                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| 28-feb    | CLAUDE.md: auditor√≠a (13 debilidades) + 9 mejoras (6 recomendadas + 3 opcionales) + auto-detecci√≥n modelo + reestructura cierre sesi√≥n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| 28-feb    | Doble URL por veh√≠culo: `/vehiculo/[slug]` (marketplace, canonical) + `/[dealer]/[slug]` (portal dealer, branding gratis, noindex)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| 04-mar    | Fix cr√≠tico auth: middlewares usan `getSession()` en vez de `useSupabaseUser()` (bug HS256 en @nuxtjs/supabase ‚â§2.0.3); m√≥dulo ‚Üí 2.0.4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| 03-mar    | CLAUDE.md: 5 reglas no negociables, Stack a√±adido, secciones fusionadas; STATUS.md comprimido 294‚Üí110 l√≠neas; CLAUDE2.md eliminado                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| 03-mar    | Hook condicional: solo mata proceso Node del puerto 3000 si STATUS.md contiene CLOSING_SESSION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 02-mar    | Hook PostToolUse autom√°tico para limpieza Node.js al actualizar STATUS.md                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| 01-mar    | Fix admin: `isAdmin` usa `role='admin'`; refactor ruta dealer `/vendedor/[slug]` ‚Üí `/[slug]`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 28-feb    | Dealer portal completo: cat√°logo filtrado, SEO, working hours, contacto                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 28-feb    | `docs/PROYECTO-CONTEXTO.md` creado (530 l√≠neas, documento maestro de contexto)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 26‚Äì28-feb | Auditor√≠a global 79/100 (P0/P1/P2 resueltos menos P0-3). Auditor√≠a #7 Iter 1‚Äì15: 5 composables refactorizados. Dealer portal, fix auth, fix admin, CLAUDE.md restructura, hooks autom√°ticos.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |

---

## Pr√≥ximas acciones

1. **P0-3:** Configurar Cloudflare WAF ‚Äî activa rate limiting en producci√≥n
2. **DMARC DNS:** Configurar DMARC + SPF + DKIM en Cloudflare para `@tracciona.com` (5 min)
3. **Founding Dealers:** Contactar primeros 10 (tarea de negocio, no c√≥digo)
4. **Pendiente estrat√©gico:** Sesiones dealer acquisition ‚Üí growth loops
5. **Cr√©ditos BD:** Actualizar seed de `credit_packs` con nuevos packs (1/3/10/25/50 + bonus) ‚Äî los actuales en BD son obsoletos
6. **Suscripciones BD:** Crear tablas/l√≥gica para tiers Classic/Premium (Stripe subscriptions)
7. **Early access unlock:** Implementar flujo de desbloqueo ‚Äî deducir 1 cr√©dito ‚Üí insertar en `vehicle_unlocks(user_id, vehicle_id)` ‚Üí `applyFilters` excluye visible_from para vehiculos desbloqueados por ese user
8. **PromoCards densidad:** Decidir si se quiere aumentar o reducir la densidad de sugerencias en split cards (actualmente 2 por card). Conversaci√≥n pendiente con el usuario.

---

CLOSING_SESSION
